{"version":3,"sources":["../moh.js/createWorkbook.js"],"names":["mode","state","modalMode","workbookData","gui","showModalAlert","title","msg","$","find","html","end","modal","unzip","binary","JSON","parse","pako","inflate","to","zip","string","deflate","updateLoadingStatus","text","console","log","document","ready","selectAttributes","selectCategories","ajax","url","type","done","response","success","each","attributes","i","item","append","id","attribute","value","selectpicker","fail","xhr","status","error","responseJSON","message","categories","category","workbookName","val","encodeURIComponent","data","workbook","WorkbookGUI","window","height","setAddSheetCallback","addSheet","load","hide","prop","editSheet","index","modelDisplayIndex","selecte_categories","selecte_attributes","sheetNames","tables","getData","slice","splice","indexOf","attrs","cates","length","push","backdrop","getSelected","selected_categories","selected_attributes","att_id","att","substring","concat","cat_id","cat","Array","join","split","on","click","change","e","files","target","f","formData","FormData","cache","contentType","processData","updateJson","exportToExcel","container","getElementById","previewTable","newSimpleTable","loadData","updateSettings","cells","row","col","cellProperties","readOnly","sheetName","btn","statusText","stringify","oldName","name"],"mappings":"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","sourcesContent":["var mode;\r\nvar state = {\r\n    modalMode: 'none' // none, add, edit\r\n}; // store state\r\nvar workbookData;\r\nlet gui;\r\n\r\nfunction showModalAlert(title, msg) {\r\n    $('#msg-modal').find('h5').html(title).end().find('p').html(msg).end().modal('show');\r\n}\r\n\r\nfunction unzip(binary) {\r\n    return JSON.parse(pako.inflate(binary, {to: 'string'}));\r\n}\r\n\r\nfunction zip(string) {\r\n    return pako.deflate(string, {to: 'string'});\r\n}\r\n\r\n// does not work when loading tables...\r\nfunction updateLoadingStatus(text) {\r\n    console.log('Loading... (' + text + ')');\r\n    $('#loadingText').html('Loading... (' + text + ')')\r\n}\r\n\r\n$(document).ready(function () {\r\n\r\n    // get attributes and categories.\r\n    var selectAttributes = $('#select-attributes');\r\n    var selectCategories = $('#select-categories');\r\n    $.ajax({\r\n        url: '/api/attributes',\r\n        type: 'GET',\r\n    }).done(function (response) {\r\n        if (response.success) {\r\n            $.each(response.attributes, function (i, item) {\r\n                selectAttributes.append($('<option>', {\r\n                    text: '#' + item.id + '  ' + item.attribute,\r\n                    value: item.id + ',' + item.attribute,\r\n                }));\r\n            });\r\n\r\n            selectAttributes.selectpicker('refresh');\r\n        }\r\n    }).fail(function (xhr, status, error) {\r\n        console.log('fail ' + xhr.responseJSON.message);\r\n    });\r\n\r\n    $.ajax({\r\n        url: '/api/categories',\r\n        type: 'GET',\r\n    }).done(function (response) {\r\n        if (response.success) {\r\n            $.each(response.categories, function (i, item) {\r\n                selectCategories.append($('<option>', {\r\n                    text: '#' + item.id + '  ' + item.category,\r\n                    value: item.id + ',' + item.category,\r\n                }));\r\n            });\r\n\r\n            selectCategories.selectpicker('refresh');\r\n        }\r\n    }).fail(function (xhr, status, error) {\r\n        console.log('fail ' + xhr.responseJSON.message);\r\n        //showErrorAlert(xhr.responseJSON.message);\r\n    });\r\n\r\n    // if this page is loaded for edit workbook\r\n    const workbookName = $('#workbookNameInput').val();\r\n    mode = $('#mode').val();\r\n    if (mode === 'edit') {\r\n\r\n        // default url is for fill the workbook first time\r\n        var url = '/api/workbook/' + encodeURIComponent(workbookName);\r\n\r\n        $.ajax({\r\n            url: url,\r\n            type: 'GET',\r\n        }).done(function (response) {\r\n            console.log(response);\r\n            if (response.success) {\r\n                const data = unzip(response.workbook.data);\r\n                console.log(data);\r\n                gui = new WorkbookGUI('edit', workbookName, data, $(window).height() - 390);\r\n                gui.setAddSheetCallback(addSheet);\r\n                gui.load();\r\n\r\n                $('#loading').hide();\r\n            }\r\n        }).fail(function (xhr, status, error) {\r\n            console.log('fail ' + xhr.responseJSON.message);\r\n            //showErrorAlert(xhr.responseJSON.message);\r\n            $('#loading').hide();\r\n        });\r\n    }\r\n    // add mode\r\n    else {\r\n        console.log('add mode');\r\n        $('#import-workbook-btn').prop('disabled', true);\r\n        gui = new WorkbookGUI('edit', workbookName, {}, $(window).height() - 390);\r\n        gui.setAddSheetCallback(addSheet);\r\n\r\n    }\r\n\r\n});\r\n\r\nfunction editSheet(index) {\r\n    state.modalMode = 'edit';\r\n    state.modelDisplayIndex = index;\r\n    var selecte_categories = $('#select-categories');\r\n    var selecte_attributes = $('#select-attributes');\r\n    selecte_categories.selectpicker('deselectAll');\r\n    selecte_attributes.selectpicker('deselectAll');\r\n    $('#sheetNameInput').val(gui.sheetNames[index]);\r\n\r\n\r\n    // get categories and attributes\r\n    var data = gui.tables[index].getData().slice();\r\n    // console.log(data);\r\n    data[0].splice(data[0].indexOf(''), 1);\r\n    var attrs = data[0];\r\n    var cates = [];\r\n    for (var i = 1; i < data.length; i++) {\r\n        if (data[i][0] !== '') cates.push(data[i][0])\r\n    }\r\n\r\n    console.log(attrs, cates);\r\n    selecte_categories.selectpicker('val', cates);\r\n    selecte_attributes.selectpicker('val', attrs);\r\n    $('#add-confirm-btn').html('Modify');\r\n    $('#add-modal').modal({backdrop: 'static'});\r\n}\r\n\r\n\r\n\r\n// get the selected att and cat\r\nfunction getSelected() {\r\n    var selected_categories = $('#select-categories').val();\r\n    var selected_attributes = $('#select-attributes').val();\r\n    var data = [];\r\n    var att_id = [], att = [], i;\r\n    // add first two rows\r\n    for (i = 0; i < selected_attributes.length; i++) {\r\n        att_id.push(selected_attributes[i].substring(0, selected_attributes[i].indexOf(',')))\r\n        att.push(selected_attributes[i].substring(1 + selected_attributes[i].indexOf(',')))\r\n    }\r\n    data.push(['', ''].concat(att_id));\r\n    data.push(['', ''].concat(att));\r\n\r\n    // add columns\r\n    for (i = 0; i < selected_categories.length; i++) {\r\n        var cat_id = selected_categories[i].substring(0, selected_categories[i].indexOf(','));\r\n        var cat = selected_categories[i].substring(1 + selected_categories[i].indexOf(','))\r\n        data.push([cat_id, cat].concat(\r\n            Array(selected_attributes.length).join('.').split('.')));\r\n    }\r\n    return data;\r\n}\r\n\r\n$('#import-workbook-btn').on('click', function () {\r\n    $('#file-import').click();\r\n});\r\n\r\n$('#file-import').change(function (e) {\r\n\r\n    var files = e.target.files, f = files[0];\r\n    var formData = new FormData();\r\n    formData.append('excel', f);\r\n\r\n    $.ajax({\r\n        url: '/api/upload/style/' + encodeURIComponent($('#workbookNameInput').val()),\r\n        type: 'POST',\r\n        data: formData,\r\n        cache: false,\r\n        contentType: false,\r\n        processData: false\r\n    }).done(function (response) {\r\n        if (response.success) {\r\n            const data = unzip(response.workbook.data);\r\n            console.log(data);\r\n            gui.updateJson(data);\r\n            gui.load();\r\n        }\r\n    }).fail(function (xhr, status, error) {\r\n        console.log('fail ' + xhr.responseJSON.message);\r\n\r\n    });\r\n\r\n});\r\n\r\n$('#export-workbook-btn').on('click', function () {\r\n    if (!gui.workbookName)\r\n        gui.workbookName = 'workbook1';\r\n    exportToExcel();\r\n});\r\n\r\n// add sheet modal\r\nfunction addSheet() {\r\n    state.modalMode = 'add';\r\n    $('#sheetNameInput').val('');\r\n    $('#select-categories').selectpicker('deselectAll');\r\n    $('#select-attributes').selectpicker('deselectAll');\r\n    $('#add-confirm-btn').html('Add');\r\n    $('#add-modal').modal({backdrop: 'static'});\r\n}\r\n\r\n// preview the sheet in the modal\r\n$('#preview-btn').click(function () {\r\n    showModalAlert('Error', 'Not yet implemented');\r\n    return;\r\n    $('#preview-grid').html('');\r\n    var container = document.getElementById('preview-grid');\r\n    var previewTable = newSimpleTable(container, 300, true);\r\n    previewTable.loadData(getSelected());\r\n    // lock all cells\r\n    previewTable.updateSettings({\r\n        cells: function (row, col) {\r\n            var cellProperties = {};\r\n            cellProperties.readOnly = true;\r\n            return cellProperties;\r\n        }\r\n    });\r\n});\r\n\r\n// confirm to add sheet to the workbook\r\n// TO-DO check inputs, i.e. duplicates, empty name/row/column...\r\n$(\"#add-confirm-btn\").click(function () {\r\n    var sheetName = $('#sheetNameInput').val();\r\n    if (state.modalMode === 'add') {\r\n        gui.addSheet(sheetName, getSelected());\r\n        console.log(getSelected())\r\n    }\r\n    else if (state.modalMode === 'edit') {\r\n        $('#add-modal').modal('hide');\r\n        showModalAlert('Error', 'Not yet implemented');\r\n        return;\r\n        gui.sheetNames[state.modelDisplayIndex] = sheetName;\r\n        $('#tab-' + state.modelDisplayIndex).html(sheetName\r\n            + '<i onclick=\"editSheet(' + state.modelDisplayIndex + ')\" class=\"fas fa-pen ml-2\"></i>');\r\n        gui.tables[state.modelDisplayIndex].loadData(getSelected());\r\n    }\r\n    $('#add-modal').modal('hide');\r\n});\r\n\r\n$('#save-workbook-btn').on('click', function () {\r\n\r\n    var btn = $(this);\r\n    var statusText = $('#status');\r\n    statusText.html('<i class=\"fas fa-spinner fa-spin\"></i> Saving');\r\n    btn.prop('disabled', true);\r\n    const workbook = zip(JSON.stringify(gui.getData()));\r\n\r\n    $.ajax({\r\n        url: '/api/admin/workbook',\r\n        type: (mode === 'edit' ? 'PUT' : 'POST'),\r\n        contentType: 'application/json',\r\n        data: JSON.stringify({data: workbook, oldName: $('#workbookOldName').val(),name: $('#workbookNameInput').val()}),\r\n    }).done(function (response) {\r\n        if (response.success) {\r\n            // enable import style button once saved\r\n            if (mode !== 'edit') {\r\n                $('#import-workbook-btn').prop('disabled', false);\r\n            }\r\n            statusText.html('<i class=\"fas fa-check\"></i> Saved');\r\n            btn.prop('disabled', false);\r\n        }\r\n    }).fail(function (xhr, status, error) {\r\n        console.log('fail ' + xhr.responseJSON.message);\r\n        statusText.html('<i class=\"fas fa-times\"></i> Failed to create workbook: ' + xhr.responseJSON.message);\r\n        btn.prop('disabled', false);\r\n    });\r\n});\r\n\r\n// edit\r\n\r\n"],"file":"createWorkbook.js"}