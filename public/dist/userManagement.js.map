{"version":3,"sources":["../moh.js/userManagement.js"],"names":["userData","compare","array1","array2","sort","i","length","$","document","ready","ajax","url","type","done","response","success","initDatatable","permissions","fail","xhr","status","error","console","log","responseJSON","message","DataTable","dataSrc","columns","columnDefs","render","data","row","newPer","addClass","attr","username","option","value","text","includes","append","prop","targets","div","label1","label2","clone","opt1","val","opt2","initComplete","settings","json","users","on","selectpicker","click","btn","statusText","html","permission","actives","selected","undefined","push","active","contentType","JSON","stringify","location","reload"],"mappings":"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","sourcesContent":["var userData = [];\r\n\r\n//helpers\r\n// runs into O(nLogn)\r\nfunction compare(array1, array2) {\r\n    array1.sort();\r\n    array2.sort();\r\n    for (var i = 0; i < array1.length; i++) {\r\n        if (array1[i] !== array2[i]) return false;\r\n    }\r\n    return true;\r\n}\r\n\r\n$(document).ready(function () {\r\n\r\n    $.ajax({\r\n        url: '/api/permissions',\r\n        type: 'GET',\r\n    }).done(function (response) {\r\n        if (response.success) {\r\n            // init datatable\r\n            initDatatable(response.permissions);\r\n\r\n        }\r\n    }).fail(function (xhr, status, error) {\r\n        console.log(xhr.responseJSON.message);\r\n    });\r\n});\r\n\r\nfunction initDatatable(permissions) {\r\n    $('#user-table').DataTable({\r\n        ajax: {\r\n            url: '/api/user/details',\r\n            dataSrc: 'users'\r\n        },\r\n        columns: [\r\n            {'data': 'username'},\r\n            {'data': 'groupNumber'},\r\n            {'data': 'validated'},\r\n            {'data': 'email'},\r\n            {'data': 'permissions'},\r\n            {'data': 'active'},\r\n        ],\r\n        columnDefs: [\r\n            {\r\n                render: function (data, type, row) {\r\n                    var newPer = $('<select></select>').addClass('selectpicker')\r\n                        .attr('multiple', 'multiple').attr('id', 'select-' + row.username)\r\n                        .attr('data-style', 'btn-outline-primary')\r\n                        .attr('data-live-search', 'true');\r\n                    for (var i = 0; i < permissions.length; i++) {\r\n                        var option = $('<option>', {\r\n                            value: permissions[i],\r\n                            text: permissions[i],\r\n                        });\r\n                        if (data.includes(permissions[i])) {\r\n                            option.attr('selected', 'selected')\r\n                        }\r\n                        newPer.append(option);\r\n                    }\r\n\r\n                    return newPer.prop('outerHTML');\r\n                },\r\n                targets: 4\r\n            },\r\n            {\r\n                render: function (data, type, row) {\r\n                    var div = $('<div></div>').addClass('btn-group btn-group-toggle').attr('data-toggle', 'buttons')\r\n                        .attr('id', 'radios-' + row.username);\r\n                    var label1 = $('<label></label>').addClass('btn btn-secondary');\r\n                    var label2 = label1.clone();\r\n                    var opt1 = $('<input>').attr('type', 'radio').val('true').attr('autocomplete', 'off');\r\n                    var opt2 = opt1.clone().val('false');\r\n                    if (data) {\r\n                        label1.addClass('active');\r\n                        opt1.attr('checked', true);\r\n                    }\r\n                    else {\r\n                        label2.addClass('active');\r\n                        opt2.attr('checked', true);\r\n                    }\r\n                    div.append(label1.append(opt1).append('on')).append(label2.append(opt2).append('off'));\r\n\r\n                    return div.prop('outerHTML');\r\n                },\r\n\r\n                targets: 5,\r\n            }\r\n\r\n        ],\r\n        initComplete: function (settings, json) {\r\n            // store locally\r\n            userData = json.users;\r\n\r\n        }\r\n    }).on('draw', function () {\r\n        // reload selectpicker\r\n        $('select').selectpicker();\r\n    });\r\n}\r\n\r\n\r\n$('#save-btn').click(function () {\r\n    var btn = $(this);\r\n    var statusText = $('#status');\r\n    statusText.html('<i class=\"fas fa-spinner fa-spin\"></i> Saving');\r\n    btn.prop('disabled', true);\r\n\r\n    // get modified permissions and permissions\r\n    var permission = [], actives = [];\r\n    for (var i = 0; i < userData.length; i++) {\r\n        var selected = $('#select-' + userData[i].username).val();\r\n        if (selected !== undefined && !compare(selected, userData[i].permissions))\r\n            permission.push({permissions: selected, username: userData[i].username});\r\n\r\n        var active = $('input' ,$('.active', '#radios-' + userData[i].username)).val();\r\n        if (active !== undefined && active !== userData[i].active + '')\r\n            actives.push({active: active, username: userData[i].username});\r\n    }\r\n\r\n    console.log(actives);\r\n\r\n    var data = {permission, actives};\r\n    // send to server\r\n    $.ajax({\r\n        url: '/api/user/permission',\r\n        type: 'POST',\r\n        contentType: 'application/json',\r\n        data: JSON.stringify({data: data}),\r\n    }).done(function (response) {\r\n        if (response.success) {\r\n            location.reload();\r\n            statusText.html('<i class=\"fas fa-check\"></i> Saved');\r\n            btn.prop('disabled', false);\r\n\r\n        }\r\n    }).fail(function (xhr, status, error) {\r\n        console.log(xhr.responseJSON.message);\r\n        statusText.html('<i class=\"fas fa-check\"></i> ' + xhr.responseJSON.message);\r\n        btn.prop('disabled', false);\r\n    });\r\n\r\n});\r\n"],"file":"userManagement.js"}