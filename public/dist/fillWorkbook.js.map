{"version":3,"sources":["../moh.js/fillWorkbook.js"],"names":["showModalAlert","title","msg","$","find","html","end","modal","updateLoadingStatus","text","console","log","workbookToJson","workbook","result","SheetNames","forEach","sheetName","roa","XLSX","utils","sheet_to_json","Sheets","header","defval","length","document","ready","workbookName","val","url","encodeURIComponent","ajax","type","done","response","success","workbookData","data","hasOwnProperty","applyJsonWithStyle","applyJsonWithoutStyle","hide","fail","xhr","status","error","responseJSON","message","on","btn","statusText","prop","i","sheets","sheetNames","getData","contentType","JSON","stringify","name","exportToExcel","click","change","e","rABS","files","target","f","reader","FileReader","onload","Uint8Array","read","cellStyles","cellNF","applyJson","readAsBinaryString","readAsArrayBuffer"],"mappings":"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","sourcesContent":["\r\nfunction showModalAlert(title, msg) {\r\n    $('#msg-modal').find('h5').html(title).end().find('p').html(msg).end().modal('show');\r\n}\r\n\r\nfunction updateLoadingStatus(text) {\r\n    console.log('Loading... (' + text + ')');\r\n    $('#loadingText').html('Loading... (' + text + ')');\r\n}\r\n\r\nfunction workbookToJson(workbook) {\r\n    var result = {};\r\n    workbook.SheetNames.forEach(function (sheetName) {\r\n        var roa = XLSX.utils.sheet_to_json(workbook.Sheets[sheetName], {header: 1, defval: ''});\r\n        if (roa.length) result[sheetName] = roa;\r\n    });\r\n    console.log(result);\r\n    return result;\r\n}\r\n\r\n\r\n\r\n$(document).ready(function () {\r\n    workbookName = $('#filled-workbook').val();\r\n    // default url is for fill the workbook first time\r\n    var url = '/api/filled-workbook/' + encodeURIComponent(workbookName);\r\n    $.ajax({\r\n        url: url,\r\n        type: 'GET',\r\n    }).done(function (response) {\r\n        console.log(response);\r\n        if (response.success) {\r\n            workbookData =response.workbook.data;\r\n            // check if it has style\r\n            if (workbookData[0] && workbookData[0].hasOwnProperty('style')) {\r\n                applyJsonWithStyle(workbookData, 'view');\r\n            }\r\n            else {\r\n                applyJsonWithoutStyle(workbookData, 'view');\r\n            }\r\n            $('#loading').hide();\r\n        }\r\n    }).fail(function (xhr, status, error) {\r\n        console.log('fail ' + xhr.responseJSON.message);\r\n        $('#loading').hide();\r\n        //showErrorAlert(xhr.responseJSON.message);\r\n    });\r\n\r\n});\r\n\r\n$('#save-workbook-btn').on('click', function () {\r\n    var btn = $(this);\r\n    var statusText = $('#status');\r\n    statusText.html('<i class=\"fas fa-spinner fa-spin\"></i> Saving');\r\n    btn.prop('disabled', true);\r\n    var workbook = {};\r\n    for (var i = 0; i < sheets.length; i++) {\r\n        workbook[sheetNames[i]] = sheets[i].getData();\r\n    }\r\n\r\n    $.ajax({\r\n        url: '/api/filled-workbook',\r\n        type: 'POST',\r\n        contentType: 'application/json',\r\n        data: JSON.stringify({data: workbook, name: $('#filled-workbook').val()}),\r\n    }).done(function (response) {\r\n        if (response.success) {\r\n            console.log(response);\r\n            statusText.html('<i class=\"fas fa-check\"></i> Saved');\r\n            btn.prop('disabled', false);\r\n        }\r\n    }).fail(function (xhr, status, error) {\r\n        console.log('fail ' + xhr.responseJSON.message);\r\n        statusText.html('<i class=\"fas fa-times\"></i> Failed to save workbook: ' + xhr.responseJSON.message);\r\n        btn.prop('disabled', false);\r\n    });\r\n});\r\n\r\n$('#export-workbook-btn').on('click', function () {\r\n    exportToExcel();\r\n});\r\n\r\n$('#import-workbook-btn').on('click', function () {\r\n    $('#file-import').click();\r\n});\r\n\r\n$('#file-import').change(function (e) {\r\n    var rABS = true; // true: readAsBinaryString ; false: readAsArrayBuffer\r\n    var files = e.target.files, f = files[0];\r\n    var reader = new FileReader();\r\n    reader.onload = function (e) {\r\n        var data = e.target.result;\r\n        if (!rABS) data = new Uint8Array(data);\r\n        var workbook = XLSX.read(data, {type: rABS ? 'binary' : 'array', cellStyles: true, cellNF: true});\r\n\r\n        // To-DO validate the import\r\n        console.log(workbook);\r\n        //workbookData\r\n        applyJson(workbookToJson(workbook))\r\n    };\r\n    if (rABS) reader.readAsBinaryString(f); else reader.readAsArrayBuffer(f);\r\n});\r\n"],"file":"fillWorkbook.js"}