{"version":3,"sources":["../../moh.js/handsontable/workbook-gui.js"],"names":["SCALE","global","workbookData","dataValidation","WorkbookGUI","mode","workbookName","workbookRawData","workbookRawExtra","height","$","window","addSheetTab","sheets","currSheet","sheetNames","sheetNamesWithoutHidden","tables","tabContents","tabs","tabCounter","gridIds","definedNames","_appendAddSheetTab","container","width","data","rowHeights","colWidths","merges","sheetNo","cells","prop","map","x","Math","round","spec","mergeCells","manualColumnResize","manualRowResize","manualColumnMove","manualRowMove","rowHeaders","colHeaders","autoWrapCol","autoWrapRow","autoRowSize","autoColumnSize","contextMenu","renderAllRows","that","createdTable","Handsontable","push","sheetName","tabColor","gridId","tabContentId","tabId","tabContent","newTab","argb","css","argbToRgb","removeClass","i","length","append","insertBefore","cb","on","html","_preProcess","applyJsonWithStyle","timerStart","Date","now","name","hasOwnProperty","state","ws","addTab","applyTabs","dropDownAddresses","dropDownData","key","dataValidations","type","console","error","addresses","split","addressSplited","decoded","colCache","decode","row","top","bottom","col","left","right","encode","formulae","indexOf","slice","dataTrimmed","trim","parsed","parser","parse","result","newArr","concat","getDefinedName","addTable","cellProperties","editor","FormulaEditor","renderer","cellRenderer","table","instance","log","address","includes","source","renderers","AutocompleteRenderer","editors","DropdownEditor","validator","validators","AutocompleteValidator","allowInvalid","style","Object","keys","tab","hideLoadingStatus","event","target","text","cnt","wsData","dimension","rowNumber","colNumber","sheet","definedName","currName","cell","getSheet","orderNo","extra","dictToList","defaultRowHeight","position","model","rowspan","colspan","dict","defVal","ret","undefined","substring","td","value","TextRenderer","apply","arguments","cellMeta","getCellMeta","previousClass","className","alignment","textAlign","horizontal","vertical","setCellMeta","font","color","bold","fontWeight","italic","fontStyle","fill","fgColor","background","border","upper","charAt","toUpperCase","innerHTML","getWorkbook","workbook","XLSX","utils","book_new","ws_data","getData","worksheet","aoa_to_sheet","book_append_sheet","exportToExcel","fileExtension","writeFile","gui","evaluateFormula","getDataAtCell","calculated","formula","setDataAtCell"],"mappings":";;;;;;;;;;AAAA;AAEA,IAAMA,KAAK,GAAG,CAAd,C,CAAiB;;AACjB,IAAIC,MAAM,GAAG;AAACC,EAAAA,YAAY,EAAE,EAAf;AAAmBC,EAAAA,cAAc,EAAE;AAAnC,CAAb;;IAEMC,W;;;AACF,uBAAYC,IAAZ,EAAkBC,YAAlB,EAAgCC,eAAhC,EAAiDC,gBAAjD,EAAsG;AAAA,QAAnCC,MAAmC,uEAA1BC,CAAC,CAACC,MAAD,CAAD,CAAUF,MAAV,KAAqB,GAAK;;AAAA;;AAClG,SAAKA,MAAL,GAAcA,MAAd;AACA,SAAKJ,IAAL,GAAYA,IAAZ,CAFkG,CAEhF;;AAClB,SAAKO,WAAL,GAAmBF,CAAC,CAAC,oGAAD,CAApB;AACA,SAAKJ,YAAL,GAAoBA,YAApB;AACAL,IAAAA,MAAM,CAACM,eAAP,GAAyBA,eAAzB;AACAN,IAAAA,MAAM,CAACO,gBAAP,GAA0BA,gBAA1B;AACAP,IAAAA,MAAM,CAACC,YAAP,GAAsB;AAACW,MAAAA,MAAM,EAAE;AAAT,KAAtB,CAPkG,CAO9D;;AACpC,SAAKC,SAAL,GAAiB,EAAjB;AACA,SAAKC,UAAL,GAAkB,EAAlB;AACA,SAAKC,uBAAL,GAA+B,EAA/B;AACA,SAAKC,MAAL,GAAc,EAAd;AACA,SAAKC,WAAL,GAAmB,EAAnB;AACA,SAAKC,IAAL,GAAY,EAAZ;AACA,SAAKC,UAAL,GAAkB,CAAlB;AACA,SAAKC,OAAL,GAAe,EAAf;AACA,SAAKC,YAAL,GAAoB,EAApB;;AAEA,SAAKC,kBAAL;AACH;AAED;;;;;;;;;;;;;;;;6BAYSC,S,EAAWC,K,EAAOhB,M,EAAQiB,I,EAAMC,U,EAAYC,S,EAAWC,M,EAAQC,O,EAASC,K,EAAO;AACpF,UAAIC,IAAI,GAAG,EAAX;;AACA,UAAI,OAAOL,UAAP,KAAsB,QAA1B,EAAoC;AAChCK,QAAAA,IAAI,CAACL,UAAL,GAAkBA,UAAlB;AACAK,QAAAA,IAAI,CAACJ,SAAL,GAAiBA,SAAjB;AACH,OAHD,MAIK;AACDI,QAAAA,IAAI,CAACL,UAAL,GAAkBA,UAAU,CAACM,GAAX,CAAe,UAAUC,CAAV,EAAa;AAC1C,iBAAOC,IAAI,CAACC,KAAL,CAAWF,CAAC,GAAGlC,KAAJ,GAAY,MAAvB,CAAP;AACH,SAFiB,CAAlB;AAGAgC,QAAAA,IAAI,CAACJ,SAAL,GAAiBA,SAAS,CAACK,GAAV,CAAc,UAAUC,CAAV,EAAa;AACxC,iBAAOC,IAAI,CAACC,KAAL,CAAWF,CAAC,GAAGlC,KAAf,CAAP;AACH,SAFgB,CAAjB;AAGH;;AACD,UAAIqC,IAAI,GAAG;AACPX,QAAAA,IAAI,EAAEA,IADC;AAEPD,QAAAA,KAAK,EAAEA,KAFA;AAGPhB,QAAAA,MAAM,EAAEA,MAHD;AAIPmB,QAAAA,SAAS,EAAEI,IAAI,CAACJ,SAJT;AAKPD,QAAAA,UAAU,EAAEK,IAAI,CAACL,UALV;AAMPW,QAAAA,UAAU,EAAET,MANL;AAOPU,QAAAA,kBAAkB,EAAE,IAPb;AAQPC,QAAAA,eAAe,EAAE,IARV;AASPC,QAAAA,gBAAgB,EAAE,KATX;AAUPC,QAAAA,aAAa,EAAE,KAVR;AAWPC,QAAAA,UAAU,EAAE,IAXL;AAYPC,QAAAA,UAAU,EAAE,IAZL;AAaPC,QAAAA,WAAW,EAAE,KAbN;AAcPC,QAAAA,WAAW,EAAE,KAdN;AAePC,QAAAA,WAAW,EAAE,KAfN;AAgBPC,QAAAA,cAAc,EAAE,KAhBT;AAiBPC,QAAAA,WAAW,EAAE,CAAC,MAAD,CAjBN;AAkBPC,QAAAA,aAAa,EAAE,KAlBR;AAmBPnB,QAAAA,KAAK,EAAEA;AAnBA,OAAX;AAqBA,UAAMoB,IAAI,GAAG,IAAb;AACA,UAAIC,YAAY,GAAG,IAAIC,YAAJ,CAAiB7B,SAAjB,EAA4Ba,IAA5B,CAAnB;AACAe,MAAAA,YAAY,CAACtB,OAAb,GAAuBA,OAAvB;AACAqB,MAAAA,IAAI,CAAClC,MAAL,CAAYqC,IAAZ,CAAiBF,YAAjB;AACA,aAAOA,YAAP;AACH;AAED;;;;;;;;;;;2BAQOG,S,EAAWC,Q,EAAU;AACxB,UAAIC,MAAM,GAAG,UAAU,KAAKrC,UAA5B;AACA,WAAKC,OAAL,CAAaiC,IAAb,CAAkBG,MAAlB;AACA,UAAIC,YAAY,GAAG,iBAAiB,KAAKtC,UAAzC;AACA,UAAIuC,KAAK,GAAG,SAAS,KAAKvC,UAA1B,CAJwB,CAMxB;;AACA,UAAIwC,UAAU,GAAGlD,CAAC,CAAC,cAAcgD,YAAd,GAA6B,2CAA7B,GAA2ED,MAA3E,GAAoF,gBAArF,CAAlB;AACA,WAAKvC,WAAL,CAAiBoC,IAAjB,CAAsBM,UAAtB,EARwB,CAUxB;;AACA,UAAIC,MAAJ,CAXwB,CAYxB;;AACA,UAAI,KAAKxD,IAAL,KAAc,MAAlB,EAA0B;AACtBwD,QAAAA,MAAM,GAAGnD,CAAC,CAAC,YAAYiD,KAAZ,GAAoB,mEAApB,GAA0FD,YAA1F,GAAyG,KAAzG,GAAiHH,SAAjH,GACL,wBADK,GACsB,KAAKnC,UAD3B,GACwC,qCADzC,CAAV;AAEH,OAHD,MAIK;AACDyC,QAAAA,MAAM,GAAGnD,CAAC,CAAC,uEAAuEgD,YAAvE,GAAsF,IAAtF,GAA6FH,SAA7F,GAAyG,MAA1G,CAAV;AACH;;AACD,UAAIC,QAAQ,IAAIA,QAAQ,CAACM,IAAzB,EAA+B;AAC3BD,QAAAA,MAAM,CAACE,GAAP,CAAW,eAAX,EAA4B,gBAAgBC,SAAS,CAACR,QAAQ,CAACM,IAAV,CAArD;AACH;;AACD,WAAK3C,IAAL,CAAUmC,IAAV,CAAeO,MAAf;AAEA,WAAKzC,UAAL;AACA,aAAOqC,MAAP;AACH;;;gCAEW;AACR;AACA/C,MAAAA,CAAC,CAAC,iBAAD,CAAD,CAAqBuD,WAArB,CAAiC,aAAjC;AACAvD,MAAAA,CAAC,CAAC,UAAD,CAAD,CAAcuD,WAAd,CAA0B,aAA1B;AACA,UAAIC,CAAJ;;AACA,WAAKA,CAAC,GAAG,CAAT,EAAYA,CAAC,GAAG,KAAKhD,WAAL,CAAiBiD,MAAjC,EAAyCD,CAAC,EAA1C,EAA8C;AAC1CxD,QAAAA,CAAC,CAAC,iBAAD,CAAD,CAAqB0D,MAArB,CAA4B,KAAKlD,WAAL,CAAiBgD,CAAjB,CAA5B;;AAEA,YAAI,KAAK7D,IAAL,KAAc,MAAlB,EAA0B;AACtB,eAAKc,IAAL,CAAU+C,CAAV,EAAaG,YAAb,CAA0B,8BAA1B;AACH,SAFD,MAGK;AACD3D,UAAAA,CAAC,CAAC,UAAD,CAAD,CAAc0D,MAAd,CAAqB,KAAKjD,IAAL,CAAU+C,CAAV,CAArB;AACH;AACJ;;AACD,WAAK/C,IAAL,GAAY,EAAZ;AACA,WAAKD,WAAL,GAAmB,EAAnB;AACH;;;yCAEoB;AACjBR,MAAAA,CAAC,CAAC,UAAD,CAAD,CAAc0D,MAAd,CAAqB,KAAKxD,WAA1B;AACH;;;wCAEmB0D,E,EAAI;AACpB5D,MAAAA,CAAC,CAAC,gBAAD,CAAD,CAAoB6D,EAApB,CAAuB,OAAvB,EAAgCD,EAAhC;AACH;;;+BAEU/D,e,EAAiBC,gB,EAAkB;AAC1CP,MAAAA,MAAM,CAACM,eAAP,GAAyBA,eAAzB;AACAN,MAAAA,MAAM,CAACO,gBAAP,GAA0BA,gBAA1B;AACA,WAAKO,UAAL,GAAkB,EAAlB;AACA,WAAKE,MAAL,GAAc,EAAd;AACA,WAAKC,WAAL,GAAmB,EAAnB;AACA,WAAKC,IAAL,GAAY,EAAZ;AACA,WAAKC,UAAL,GAAkB,CAAlB;AACA,WAAKC,OAAL,GAAe,EAAf;AACH;;;2BAEM;AACH,WAAKD,UAAL,GAAkB,CAAlB,CADG,CAEH;;AACAV,MAAAA,CAAC,CAAC,UAAD,CAAD,CAAc8D,IAAd,CAAmB,EAAnB;AACA9D,MAAAA,CAAC,CAAC,iBAAD,CAAD,CAAqB8D,IAArB,CAA0B,EAA1B;AAEA,UAAI,KAAKnE,IAAL,KAAc,MAAlB,EACI,KAAKkB,kBAAL;;AAEJ,WAAKkD,WAAL;;AACA,WAAKC,kBAAL;AACH,K,CAED;;;;yCACqB;AACjB,UAAIC,UAAU,GAAGC,IAAI,CAACC,GAAL,EAAjB,CADiB,CAEjB;;AACA,WAAK5D,MAAL,GAAc,EAAd;AACA,WAAKF,UAAL,GAAkB,EAAlB,CAJiB,CAMjB;;AACA,UAAMF,MAAM,GAAGZ,MAAM,CAACC,YAAP,CAAoBW,MAAnC,CAPiB,CAQjB;;AACA,WAAK,IAAIiB,OAAT,IAAoBjB,MAApB,EAA4B;AACxB,aAAKE,UAAL,CAAgBuC,IAAhB,CAAqBzC,MAAM,CAACiB,OAAD,CAAN,CAAgBgD,IAArC;AACH;;AACD,WAAKhE,SAAL,GAAiB,KAAKC,UAAL,CAAgB,CAAhB,CAAjB;;AAEA,WAAK,IAAIe,OAAT,IAAoBjB,MAApB,EAA4B;AACxB,YAAIA,MAAM,CAACkE,cAAP,CAAsBjD,OAAtB,KAAkCjB,MAAM,CAACiB,OAAD,CAAN,CAAgBkD,KAAhB,KAA0B,QAAhE,EAA0E;AACtE,eAAKhE,uBAAL,CAA6BsC,IAA7B,CAAkCzC,MAAM,CAACiB,OAAD,CAAN,CAAgBgD,IAAlD;AACA,cAAIG,EAAE,GAAGpE,MAAM,CAACiB,OAAD,CAAf;AACA,cAAM2B,MAAM,GAAG,KAAKyB,MAAL,CAAYD,EAAE,CAACH,IAAf,EAAqBG,EAAE,CAACzB,QAAxB,CAAf;AACA,eAAK2B,SAAL;AACA,cAAI3D,SAAS,GAAGd,CAAC,CAAC,MAAM+C,MAAP,CAAD,CAAgB,CAAhB,CAAhB;AACA,cAAI/B,IAAI,GAAGb,MAAM,CAACiB,OAAD,CAAN,CAAgBJ,IAA3B,CANsE,CAQtE;;AACA,cAAIG,MAAM,GAAGoD,EAAE,CAACpD,MAAhB,CATsE,CAWtE;;AACA5B,UAAAA,MAAM,CAACE,cAAP,CAAsB2B,OAAtB,IAAiC;AAC7BsD,YAAAA,iBAAiB,EAAE,EADU;AAE7BC,YAAAA,YAAY,EAAE;AAFe,WAAjC;;AAIA,eAAK,IAAIC,GAAT,IAAgBL,EAAE,CAACM,eAAnB,EAAoC;AAChC,gBAAIN,EAAE,CAACM,eAAH,CAAmBR,cAAnB,CAAkCO,GAAlC,CAAJ,EAA4C;AACxC,kBAAMnF,cAAc,GAAG8E,EAAE,CAACM,eAAH,CAAmBD,GAAnB,CAAvB;;AACA,kBAAInF,cAAc,CAACqF,IAAf,KAAwB,MAA5B,EAAoC;AAChCC,gBAAAA,OAAO,CAACC,KAAR,CAAc,uCAAuCvF,cAAc,CAACqF,IAApE;AACA;AACH;;AACD,kBAAMG,SAAS,GAAGL,GAAG,CAACM,KAAJ,CAAU,GAAV,CAAlB;AACA,kBAAIC,cAAc,GAAG,EAArB;;AACA,mBAAK,IAAI3B,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGyB,SAAS,CAACxB,MAA9B,EAAsCD,CAAC,EAAvC,EAA2C;AACvC;AACA,oBAAM4B,OAAO,GAAGC,QAAQ,CAACC,MAAT,CAAgBL,SAAS,CAACzB,CAAD,CAAzB,CAAhB;;AACA,oBAAI,SAAS4B,OAAb,EAAsB;AAClB,uBAAK,IAAIG,GAAG,GAAGH,OAAO,CAACI,GAAvB,EAA4BD,GAAG,GAAGH,OAAO,CAACK,MAAR,GAAiB,CAAnD,EAAsDF,GAAG,EAAzD,EAA6D;AACzD,yBAAK,IAAIG,GAAG,GAAGN,OAAO,CAACO,IAAvB,EAA6BD,GAAG,GAAGN,OAAO,CAACQ,KAAR,GAAgB,CAAnD,EAAsDF,GAAG,EAAzD,EAA6D;AACzDP,sBAAAA,cAAc,CAACvC,IAAf,CAAoByC,QAAQ,CAACQ,MAAT,CAAgBN,GAAhB,EAAqBG,GAArB,CAApB;AACH;AACJ;AACJ,iBAND,CAOA;AAPA,qBAQK,IAAI,SAASN,OAAb,EAAsB;AACvBD,oBAAAA,cAAc,CAACvC,IAAf,CAAoBqC,SAAS,CAACzB,CAAD,CAA7B;AACH;AACJ;;AAED,mBAAK,IAAIA,EAAC,GAAG,CAAb,EAAgBA,EAAC,GAAG2B,cAAc,CAAC1B,MAAnC,EAA2CD,EAAC,EAA5C,EAAgD;AAC5CjE,gBAAAA,MAAM,CAACE,cAAP,CAAsB2B,OAAtB,EAA+BsD,iBAA/B,CAAiD9B,IAAjD,CAAsDuC,cAAc,CAAC3B,EAAD,CAApE,EAD4C,CAG5C;AACA;;AACA,oBAAMsC,QAAQ,GAAGrG,cAAc,CAACqG,QAAf,CAAwB,CAAxB,CAAjB;;AACA,oBAAIA,QAAQ,CAACC,OAAT,CAAiB,GAAjB,IAAwB,CAA5B,EAA+B;AAC3B,sBAAI/E,KAAI,GAAG8E,QAAQ,CAACE,KAAT,CAAe,CAAf,EAAkBF,QAAQ,CAACrC,MAAT,GAAkB,CAApC,EAAuCyB,KAAvC,CAA6C,GAA7C,CAAX;;AACA,sBAAMe,WAAW,GAAGjF,KAAI,CAACO,GAAL,CAAS,UAAAC,CAAC;AAAA,2BAAIA,CAAC,CAAC0E,IAAF,EAAJ;AAAA,mBAAV,CAApB;;AACA3G,kBAAAA,MAAM,CAACE,cAAP,CAAsB2B,OAAtB,EAA+BuD,YAA/B,CAA4CQ,cAAc,CAAC3B,EAAD,CAA1D,IAAiEyC,WAAjE;AACH,iBAJD,CAKA;AALA,qBAMK,IAAIH,QAAQ,CAACC,OAAT,CAAiB,GAAjB,IAAwB,CAA5B,EAA+B;AAChC,wBAAMI,MAAM,GAAGC,MAAM,CAACC,KAAP,CAAaP,QAAb,EAAuBQ,MAAtC,CADgC,CAEhC;;AACA,wBAAIC,MAAM,GAAG,EAAb;;AACA,yBAAK,IAAI/C,GAAC,GAAG,CAAb,EAAgBA,GAAC,GAAG2C,MAAM,CAAC1C,MAA3B,EAAmCD,GAAC,EAApC,EAAwC;AACpC+C,sBAAAA,MAAM,GAAGA,MAAM,CAACC,MAAP,CAAcL,MAAM,CAAC3C,GAAD,CAApB,CAAT;AACH;;AACDjE,oBAAAA,MAAM,CAACE,cAAP,CAAsB2B,OAAtB,EAA+BuD,YAA/B,CAA4CQ,cAAc,CAAC3B,EAAD,CAA1D,IAAiE+C,MAAjE;AACH,mBARI,CASL;AATK,uBAUA,IAAIT,QAAQ,IAAIvG,MAAM,CAACC,YAAP,CAAoBoB,YAApC,EAAkD;AACnDrB,sBAAAA,MAAM,CAACE,cAAP,CAAsB2B,OAAtB,EAA+BuD,YAA/B,CAA4CQ,cAAc,CAAC3B,EAAD,CAA1D,IAAiE,KAAKiD,cAAL,CAAoBX,QAApB,CAAjE;AACH,qBAFI,MAGA;AACDf,sBAAAA,OAAO,CAACC,KAAR,CAAc,gDAAgDc,QAA9D;AACH;AACJ;AACJ;AACJ,WAvEqE,CAyEtE;AACA;;;AACA,cAAI,CAACvB,EAAE,CAACgB,GAAR,EAAa;AACT,iBAAKmB,QAAL,CAAc5F,SAAd,EAAyBd,CAAC,CAAC,UAAD,CAAD,CAAce,KAAd,EAAzB,EAAgD,KAAKhB,MAArD,EAA6DiB,IAA7D,EACI,EADJ,EACQ,EADR,EACY,IADZ,EACkBI,OADlB,EAC2B,UAAUmE,GAAV,EAAeG,GAAf,EAAoB;AACvC,kBAAIiB,cAAc,GAAG,EAArB;AACAA,cAAAA,cAAc,CAACC,MAAf,GAAwBC,aAAxB;AACAF,cAAAA,cAAc,CAACG,QAAf,GAA0BC,YAA1B;AACA,qBAAOJ,cAAP;AACH,aANL;AAOH,WARD,MASK;AACD,gBAAMK,KAAK,GAAG,KAAKN,QAAL,CAAc5F,SAAd,EAAyBd,CAAC,CAAC,UAAD,CAAD,CAAce,KAAd,EAAzB,EAAgD,KAAKhB,MAArD,EAA6DiB,IAA7D,EACVuD,EAAE,CAACgB,GAAH,CAAOxF,MADG,EACKwE,EAAE,CAACmB,GAAH,CAAO3E,KADZ,EACmBI,MADnB,EAC2BC,OAD3B,EACoC,UAAUmE,GAAV,EAAeG,GAAf,EAAoB;AAC9D,kBAAIiB,cAAc,GAAG,EAArB;;AACA,kBAAI,EAAE,aAAa,KAAKM,QAApB,CAAJ,EAAmC;AAC/B,qBAAKA,QAAL,CAAc7F,OAAd,GAAwBA,OAAxB;AACA2D,gBAAAA,OAAO,CAACmC,GAAR,CAAY9F,OAAZ;AACH,eAL6D,CAO9D;AACA;;;AACA,kBAAM+F,OAAO,GAAG9B,QAAQ,CAACQ,MAAT,CAAgBN,GAAG,GAAG,CAAtB,EAAyBG,GAAG,GAAG,CAA/B,CAAhB;AACA,kBAAMjG,cAAc,GAAGF,MAAM,CAACE,cAAP,CAAsB,KAAKwH,QAAL,CAAc7F,OAApC,CAAvB;;AACA,kBAAI3B,cAAc,CAACiF,iBAAf,CAAiC0C,QAAjC,CAA0CD,OAA1C,CAAJ,EAAwD;AACpDR,gBAAAA,cAAc,CAACU,MAAf,GAAwB5H,cAAc,CAACkF,YAAf,CAA4BwC,OAA5B,CAAxB;AACAR,gBAAAA,cAAc,CAACG,QAAf,GAA0BnE,YAAY,CAAC2E,SAAb,CAAuBC,oBAAjD;AACAZ,gBAAAA,cAAc,CAACC,MAAf,GAAwBjE,YAAY,CAAC6E,OAAb,CAAqBC,cAA7C;AACAd,gBAAAA,cAAc,CAACe,SAAf,GAA2B/E,YAAY,CAACgF,UAAb,CAAwBC,qBAAnD;AACAjB,gBAAAA,cAAc,CAACkB,YAAf,GAA8B,KAA9B;AACA,uBAAOlB,cAAP;AACH,eAlB6D,CAoB9D;;;AACA,kBAAIpC,EAAE,GAAGhF,MAAM,CAACC,YAAP,CAAoBW,MAApB,CAA2B,KAAK8G,QAAL,CAAc7F,OAAzC,CAAT;AAEAuF,cAAAA,cAAc,CAACmB,KAAf,GAAuB,IAAvB;;AACA,kBAAIvD,EAAE,CAACuD,KAAH,CAASvC,GAAT,KAAiBhB,EAAE,CAACuD,KAAH,CAASvC,GAAT,EAAcG,GAAd,CAAjB,IAAuCqC,MAAM,CAACC,IAAP,CAAYzD,EAAE,CAACuD,KAAH,CAASvC,GAAT,EAAcG,GAAd,CAAZ,EAAgCjC,MAAhC,KAA2C,CAAtF,EAAyF;AACrFkD,gBAAAA,cAAc,CAACmB,KAAf,GAAuBvD,EAAE,CAACuD,KAAH,CAASvC,GAAT,EAAcG,GAAd,CAAvB;AACH;;AACDiB,cAAAA,cAAc,CAACG,QAAf,GAA0BC,YAA1B;AACAJ,cAAAA,cAAc,CAACC,MAAf,GAAwBC,aAAxB;AACA,qBAAOF,cAAP;AACH,aA/BS,CAAd;AAiCH;AAEJ;AACJ;;AAED3G,MAAAA,CAAC,CAAC,wBAAD,CAAD,CAA4BiI,GAA5B,CAAgC,MAAhC;AAEAC,MAAAA,iBAAiB;AACjB,UAAMzF,IAAI,GAAG,IAAb,CA7IiB,CA8IjB;AACA;AACA;AACA;AACA;;AACAzC,MAAAA,CAAC,CAAC,aAAD,CAAD,CAAiB6D,EAAjB,CAAoB,aAApB,EAAmC,UAAUsE,KAAV,EAAiB;AAChD1F,QAAAA,IAAI,CAACrC,SAAL,GAAiBJ,CAAC,CAACmI,KAAK,CAACC,MAAP,CAAD,CAAgBC,IAAhB,EAAjB,CADgD,CACC;AACjD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACH,OAXD;AAYAtD,MAAAA,OAAO,CAACmC,GAAR,CAAY,iBAAZ,EAA+BhD,IAAI,CAACC,GAAL,KAAaF,UAAb,GAA0B,IAAzD;AACH;;;8BAES;AACN,UAAMjD,IAAI,GAAG,EAAb;AACA,UAAIsH,GAAG,GAAG,CAAV;;AACA,WAAK,IAAIlH,OAAT,IAAoB7B,MAAM,CAACC,YAAP,CAAoBW,MAAxC,EAAgD;AAC5C,YAAIZ,MAAM,CAACC,YAAP,CAAoBW,MAApB,CAA2BkE,cAA3B,CAA0CjD,OAA1C,CAAJ,EAAwD;AACpD,cAAMmH,MAAM,GAAGhJ,MAAM,CAACC,YAAP,CAAoBW,MAApB,CAA2BiB,OAA3B,EAAoCJ,IAAnD;AACAA,UAAAA,IAAI,CAACI,OAAD,CAAJ,GAAgB;AACZgD,YAAAA,IAAI,EAAE,KAAK/D,UAAL,CAAgBiI,GAAhB,CADM;AAEZE,YAAAA,SAAS,EAAE,CAACD,MAAM,CAAC9E,MAAR,EAAgB8E,MAAM,CAAC,CAAD,CAAN,CAAU9E,MAA1B;AAFC,WAAhB;;AAIA,eAAK,IAAIgF,SAAS,GAAG,CAArB,EAAwBA,SAAS,GAAGF,MAAM,CAAC9E,MAA3C,EAAmDgF,SAAS,EAA5D,EAAgE;AAC5DzH,YAAAA,IAAI,CAACI,OAAD,CAAJ,CAAcqH,SAAd,IAA2B,EAA3B;;AACA,iBAAK,IAAIC,SAAS,GAAG,CAArB,EAAwBA,SAAS,GAAGH,MAAM,CAAC,CAAD,CAAN,CAAU9E,MAA9C,EAAsDiF,SAAS,EAA/D,EAAmE;AAC/D,kBAAIH,MAAM,CAACE,SAAD,CAAN,CAAkBC,SAAlB,MAAiC,IAArC,EAA2C;AACvC1H,gBAAAA,IAAI,CAACI,OAAD,CAAJ,CAAcqH,SAAd,EAAyBC,SAAzB,IAAsCH,MAAM,CAACE,SAAD,CAAN,CAAkBC,SAAlB,CAAtC;AACH;AACJ;;AACD,gBAAIX,MAAM,CAACC,IAAP,CAAYhH,IAAI,CAACI,OAAD,CAAJ,CAAcqH,SAAd,CAAZ,EAAsChF,MAAtC,KAAiD,CAArD,EAAwD;AACpD,qBAAOzC,IAAI,CAACI,OAAD,CAAJ,CAAcqH,SAAd,CAAP;AACH;AACJ;AACJ;;AACDH,QAAAA,GAAG;AACN;;AACD,aAAOtH,IAAP;AACH;;;6BAEQ6B,S,EAAW7B,I,EAAM;AACtB,UAAMI,OAAO,GAAG,KAAKf,UAAL,CAAgBoD,MAAhC;AACAlE,MAAAA,MAAM,CAACC,YAAP,CAAoBW,MAApB,CAA2BiB,OAA3B,IAAsC;AAACgD,QAAAA,IAAI,EAAEvB,SAAP;AAAkB7B,QAAAA,IAAI,EAAEA;AAAxB,OAAtC;AACA,WAAKX,UAAL,CAAgBuC,IAAhB,CAAqBC,SAArB;AACA,UAAME,MAAM,GAAG,KAAKyB,MAAL,CAAY3B,SAAZ,CAAf;AACA,WAAK4B,SAAL;AACA,UAAI3D,SAAS,GAAGd,CAAC,CAAC,MAAM+C,MAAP,CAAD,CAAgB,CAAhB,CAAhB;AACA,UAAIiE,KAAK,GAAG,KAAKN,QAAL,CAAc5F,SAAd,EAAyBd,CAAC,CAAC,UAAD,CAAD,CAAce,KAAd,EAAzB,EAAgD,KAAKhB,MAArD,EAA6DiB,IAA7D,EACR,EADQ,EACJ,EADI,EACA,IADA,EACMI,OADN,EACe,UAAUmE,GAAV,EAAeG,GAAf,EAAoB;AACvC,YAAIiB,cAAc,GAAG,EAArB;AACAA,QAAAA,cAAc,CAACC,MAAf,GAAwBC,aAAxB;AACAF,QAAAA,cAAc,CAACG,QAAf,GAA0BC,YAA1B;AACA,eAAOJ,cAAP;AACH,OANO,CAAZ;AAOA,WAAKpG,MAAL,CAAYqC,IAAZ,CAAiBoE,KAAjB;AAEAhH,MAAAA,CAAC,CAAC,wBAAD,CAAD,CAA4BiI,GAA5B,CAAgC,MAAhC;AACA,WAAK7H,SAAL,GAAiB,KAAKC,UAAL,CAAgB,CAAhB,CAAjB,CAjBsB,CAkBtB;;AACAL,MAAAA,CAAC,CAAC,aAAD,CAAD,CAAiB6D,EAAjB,CAAoB,aAApB,EAAmC,UAAUsE,KAAV,EAAiB;AAChD,aAAK/H,SAAL,GAAiBJ,CAAC,CAACmI,KAAK,CAACC,MAAP,CAAD,CAAgBC,IAAhB,EAAjB,CADgD,CACC;AACpD,OAFD;AAGH;;;6BAEQjE,I,EAAM;AACX,aAAO7E,MAAM,CAACC,YAAP,CAAoBW,MAApB,CAA2B,KAAKE,UAAL,CAAgB0F,OAAhB,CAAwB3B,IAAxB,CAA3B,CAAP;AACH;;;0CAEqBuE,K,EAAOpD,G,EAAKG,G,EAAK;AACnC,aAAOnG,MAAM,CAACC,YAAP,CAAoBW,MAApB,CAA2B,KAAKE,UAAL,CAAgB0F,OAAhB,CAAwB4C,KAAxB,CAA3B,EAA2D3H,IAA3D,CAAgEuE,GAAhE,EAAqEG,GAArE,CAAP;AACH;;;6BAEQtB,I,EAAM;AACX,aAAO,KAAK7D,MAAL,CAAY,KAAKF,UAAL,CAAgB0F,OAAhB,CAAwB3B,IAAxB,CAAZ,CAAP;AACH;;;mCAEcwE,W,EAAa;AACxB,UAAMhI,YAAY,GAAGrB,MAAM,CAACC,YAAP,CAAoBoB,YAAzC;;AACA,UAAI,EAAEgI,WAAW,IAAIhI,YAAjB,CAAJ,EAAoC;AAChCmE,QAAAA,OAAO,CAACC,KAAR,CAAc,+BAA+B4D,WAA7C;AACA;AACH;;AACD,UAAMC,QAAQ,GAAGtJ,MAAM,CAACC,YAAP,CAAoBoB,YAApB,CAAiCgI,WAAjC,CAAjB;AACA,UAAItC,MAAM,GAAG,EAAb;;AACA,WAAK,IAAI9C,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGqF,QAAQ,CAACpF,MAA7B,EAAqCD,CAAC,EAAtC,EAA0C;AACtC,YAAMsF,IAAI,GAAG,KAAKC,QAAL,CAAcF,QAAQ,CAACrF,CAAD,CAAR,CAAYX,SAA1B,EAAqC7B,IAArC,CAA0C6H,QAAQ,CAACrF,CAAD,CAAR,CAAY+B,GAAZ,GAAkB,CAA5D,EAA+DsD,QAAQ,CAACrF,CAAD,CAAR,CAAYkC,GAAZ,GAAkB,CAAjF,CAAb;;AACA,YAAIoD,IAAI,KAAK,IAAb,EAAmB,CAClB,CADD,MAEK,IAAI,QAAOA,IAAP,MAAgB,QAAhB,IAA4B,YAAYA,IAA5C,EAAkD;AACnDxC,UAAAA,MAAM,CAAC1D,IAAP,CAAYkG,IAAI,CAACxC,MAAjB;AACH,SAFI,MAGA;AACDA,UAAAA,MAAM,CAAC1D,IAAP,CAAYkG,IAAZ;AACH;AACJ;;AACD,aAAOxC,MAAP;AACH;;;kCAEa;AACV,UAAI/G,MAAM,CAACO,gBAAX,EAA6B;AACzBP,QAAAA,MAAM,CAACC,YAAP,CAAoBoB,YAApB,GAAmCrB,MAAM,CAACO,gBAAP,CAAwBc,YAA3D;AACH;;AACDrB,MAAAA,MAAM,CAACC,YAAP,CAAoBW,MAApB,GAA6B,EAA7B;;AACA,WAAK,IAAI6I,OAAT,IAAoBzJ,MAAM,CAACM,eAA3B,EAA4C;AACxC,YAAM0I,MAAM,GAAGhJ,MAAM,CAACC,YAAP,CAAoBW,MAApB,CAA2B6I,OAA3B,IAAsC,EAArD;AACA,YAAMhI,IAAI,GAAGzB,MAAM,CAACM,eAAP,CAAuBmJ,OAAvB,CAAb;AACAT,QAAAA,MAAM,CAACvH,IAAP,GAAc,EAAd;AACAuH,QAAAA,MAAM,CAACnE,IAAP,GAAcpD,IAAI,CAACoD,IAAnB,CAJwC,CAKxC;;AACA,YAAI7E,MAAM,CAACO,gBAAX,EAA6B;AACzB,cAAMmJ,KAAK,GAAG1J,MAAM,CAACO,gBAAP,CAAwBK,MAAxB,CAA+B6I,OAA/B,CAAd;AACAT,UAAAA,MAAM,CAAC7C,GAAP,GAAa,EAAb;AACA6C,UAAAA,MAAM,CAAC7C,GAAP,CAAW3E,KAAX,GAAmBmI,UAAU,CAACD,KAAK,CAACvD,GAAN,CAAU3E,KAAX,EAAkBC,IAAI,CAACwH,SAAL,CAAe,CAAf,CAAlB,EAAqC,EAArC,CAA7B;AACAD,UAAAA,MAAM,CAAChD,GAAP,GAAa,EAAb;AACAgD,UAAAA,MAAM,CAAChD,GAAP,CAAWxF,MAAX,GAAoBmJ,UAAU,CAACD,KAAK,CAAC1D,GAAN,CAAUxF,MAAX,EAAmBiB,IAAI,CAACwH,SAAL,CAAe,CAAf,CAAnB,EAAsCS,KAAK,CAACE,gBAA5C,CAA9B;AACAZ,UAAAA,MAAM,CAAC1D,eAAP,GAAyBoE,KAAK,CAACpE,eAA/B;AACA0D,UAAAA,MAAM,CAACjE,KAAP,GAAe2E,KAAK,CAAC3E,KAArB;AACAiE,UAAAA,MAAM,CAACzF,QAAP,GAAkBmG,KAAK,CAACnG,QAAxB;AACAyF,UAAAA,MAAM,CAACT,KAAP,GAAemB,KAAK,CAACnB,KAArB,CATyB,CAWzB;;AACA,cAAM3G,MAAM,GAAGoH,MAAM,CAACpH,MAAP,GAAgB,EAA/B;;AACA,eAAK,IAAIiI,QAAT,IAAqBH,KAAK,CAAC9H,MAA3B,EAAmC;AAC/B,gBAAI8H,KAAK,CAAC9H,MAAN,CAAakD,cAAb,CAA4B+E,QAA5B,CAAJ,EAA2C;AACvC,kBAAMC,KAAK,GAAGJ,KAAK,CAAC9H,MAAN,CAAaiI,QAAb,EAAuBC,KAArC;AACAlI,cAAAA,MAAM,CAACyB,IAAP,CAAY;AACR2C,gBAAAA,GAAG,EAAE8D,KAAK,CAAC7D,GAAN,GAAY,CADT;AAERE,gBAAAA,GAAG,EAAE2D,KAAK,CAAC1D,IAAN,GAAa,CAFV;AAGR2D,gBAAAA,OAAO,EAAED,KAAK,CAAC5D,MAAN,GAAe4D,KAAK,CAAC7D,GAArB,GAA2B,CAH5B;AAIR+D,gBAAAA,OAAO,EAAEF,KAAK,CAACzD,KAAN,GAAcyD,KAAK,CAAC1D,IAApB,GAA2B;AAJ5B,eAAZ;AAMH;AACJ;AACJ;;AAED,aAAK,IAAI8C,SAAS,GAAG,CAArB,EAAwBA,SAAS,GAAGzH,IAAI,CAACwH,SAAL,CAAe,CAAf,CAApC,EAAuDC,SAAS,EAAhE,EAAoE;AAChEF,UAAAA,MAAM,CAACvH,IAAP,CAAY4B,IAAZ,CAAiB,EAAjB;;AACA,eAAK,IAAI8F,SAAS,GAAG,CAArB,EAAwBA,SAAS,GAAG1H,IAAI,CAACwH,SAAL,CAAe,CAAf,CAApC,EAAuDE,SAAS,EAAhE,EAAoE;AAChE,gBAAI1H,IAAI,IAAIA,IAAI,CAACyH,SAAD,CAAZ,IAA2BzH,IAAI,CAACyH,SAAD,CAAJ,CAAgBC,SAAhB,CAA/B,EAA2D;AACvDH,cAAAA,MAAM,CAACvH,IAAP,CAAYyH,SAAZ,EAAuB7F,IAAvB,CAA4B5B,IAAI,CAACyH,SAAD,CAAJ,CAAgBC,SAAhB,CAA5B;AACH,aAFD,MAGK;AACDH,cAAAA,MAAM,CAACvH,IAAP,CAAYyH,SAAZ,EAAuB7F,IAAvB,CAA4B,IAA5B;AACH;AACJ;AACJ;AACJ;AACJ;;;;;;AAGL,SAASsG,UAAT,CAAoBM,IAApB,EAA0B/F,MAA1B,EAA+C;AAAA,MAAbgG,MAAa,uEAAN,IAAM;AAC3C,MAAIC,GAAG,GAAG,EAAV;;AACA,OAAK,IAAIlG,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGC,MAApB,EAA4BD,CAAC,EAA7B,EAAiC;AAC7B,QAAIgG,IAAI,CAAChG,CAAD,CAAJ,KAAYmG,SAAhB,EAA2B;AACvBD,MAAAA,GAAG,CAAC9G,IAAJ,CAAS4G,IAAI,CAAChG,CAAD,CAAb;AACH,KAFD,MAGK;AACDkG,MAAAA,GAAG,CAAC9G,IAAJ,CAAS6G,MAAT;AACH;AACJ;;AACD,SAAOC,GAAP;AACH;;AAGD,SAASpG,SAAT,CAAmBF,IAAnB,EAAyB;AACrB,SAAOA,IAAI,CAACwG,SAAL,CAAe,CAAf,CAAP;AACH;;AAED,SAAS7C,YAAT,CAAsBE,QAAtB,EAAgC4C,EAAhC,EAAoCtE,GAApC,EAAyCG,GAAzC,EAA8CpE,IAA9C,EAAoDwI,KAApD,EAA2DnD,cAA3D,EAA2E;AACvEhE,EAAAA,YAAY,CAAC2E,SAAb,CAAuByC,YAAvB,CAAoCC,KAApC,CAA0C,IAA1C,EAAgDC,SAAhD;;AACA,MAAK,WAAWtD,cAAZ,IAA+BA,cAAc,CAACmB,KAAlD,EAAyD;AACrD,QAAIA,KAAK,GAAGnB,cAAc,CAACmB,KAA3B,CADqD,CAErD;;AACA,QAAIoC,QAAQ,GAAGjD,QAAQ,CAACkD,WAAT,CAAqB5E,GAArB,EAA0BG,GAA1B,CAAf;AACA,QAAI0E,aAAa,GAAIF,QAAQ,CAACG,SAAT,KAAuBV,SAAxB,GAAqCO,QAAQ,CAACG,SAA9C,GAA0D,EAA9E;;AAEA,QAAIvC,KAAK,CAACzD,cAAN,CAAqB,WAArB,CAAJ,EAAuC;AACnC,UAAIyD,KAAK,CAACwC,SAAN,CAAgBjG,cAAhB,CAA+B,YAA/B,CAAJ,EAAkD;AAC9CwF,QAAAA,EAAE,CAAC/B,KAAH,CAASyC,SAAT,GAAqBzC,KAAK,CAACwC,SAAN,CAAgBE,UAArC;AACH;;AACD,UAAI1C,KAAK,CAACwC,SAAN,CAAgBjG,cAAhB,CAA+B,UAA/B,CAAJ,EAAgD;AAE5C,gBAAQyD,KAAK,CAACwC,SAAN,CAAgBG,QAAxB;AACI,eAAK,KAAL;AACIxD,YAAAA,QAAQ,CAACyD,WAAT,CAAqBnF,GAArB,EAA0BG,GAA1B,EAA+B,WAA/B,EAA4C0E,aAAa,GAAG,QAA5D;AACA;;AACJ,eAAK,QAAL;AACInD,YAAAA,QAAQ,CAACyD,WAAT,CAAqBnF,GAArB,EAA0BG,GAA1B,EAA+B,WAA/B,EAA4C0E,aAAa,GAAG,WAA5D;AACA;AANR;AAQH;AACJ,KAfD,MAgBK;AACD;AACAnD,MAAAA,QAAQ,CAACyD,WAAT,CAAqBnF,GAArB,EAA0BG,GAA1B,EAA+B,WAA/B,EAA4C0E,aAAa,GAAG,WAA5D;AACH,KAzBoD,CA2BrD;;;AACA,QAAItC,KAAK,CAACzD,cAAN,CAAqB,MAArB,CAAJ,EAAkC;AAC9B,UAAIyD,KAAK,CAAC6C,IAAN,CAAWtG,cAAX,CAA0B,OAA1B,KAAsCyD,KAAK,CAAC6C,IAAN,CAAWC,KAAX,CAAiBvG,cAAjB,CAAgC,MAAhC,CAA1C,EAAmF;AAC/EwF,QAAAA,EAAE,CAAC/B,KAAH,CAAS8C,KAAT,GAAiB,MAAMtH,SAAS,CAACwE,KAAK,CAAC6C,IAAN,CAAWC,KAAX,CAAiBxH,IAAlB,CAAhC;AACH;;AACD,UAAI0E,KAAK,CAAC6C,IAAN,CAAWtG,cAAX,CAA0B,MAA1B,KAAqCyD,KAAK,CAAC6C,IAAN,CAAWE,IAApD,EAA0D;AACtDhB,QAAAA,EAAE,CAAC/B,KAAH,CAASgD,UAAT,GAAsB,MAAtB;AACH;;AACD,UAAIhD,KAAK,CAAC6C,IAAN,CAAWtG,cAAX,CAA0B,QAA1B,KAAuCyD,KAAK,CAAC6C,IAAN,CAAWI,MAAtD,EAA8D;AAC1DlB,QAAAA,EAAE,CAAC/B,KAAH,CAASkD,SAAT,GAAqB,QAArB;AACH;AACJ,KAtCoD,CAwCrD;;;AACA,QAAIlD,KAAK,CAACzD,cAAN,CAAqB,MAArB,CAAJ,EAAkC;AAC9B,UAAIyD,KAAK,CAACmD,IAAN,CAAW5G,cAAX,CAA0B,SAA1B,KAAwCyD,KAAK,CAACmD,IAAN,CAAWC,OAAX,CAAmB7G,cAAnB,CAAkC,MAAlC,CAA5C,EAAuF;AACnFwF,QAAAA,EAAE,CAAC/B,KAAH,CAASqD,UAAT,GAAsB,MAAM7H,SAAS,CAACwE,KAAK,CAACmD,IAAN,CAAWC,OAAX,CAAmB9H,IAApB,CAArC;AACH;AACJ,KA7CoD,CA+CrD;;;AACA,QAAI0E,KAAK,CAACzD,cAAN,CAAqB,QAArB,CAAJ,EAAoC;AAChC,WAAK,IAAIO,GAAT,IAAgBkD,KAAK,CAACsD,MAAtB,EAA8B;AAC1B,YAAItD,KAAK,CAACsD,MAAN,CAAa/G,cAAb,CAA4BO,GAA5B,CAAJ,EAAsC;AAClC,cAAIyG,KAAK,GAAGzG,GAAG,CAAC0G,MAAJ,CAAW,CAAX,EAAcC,WAAd,KAA8B3G,GAAG,CAACoB,KAAJ,CAAU,CAAV,CAA1C;AACA,cAAIoF,MAAM,GAAGtD,KAAK,CAACsD,MAAN,CAAaxG,GAAb,CAAb;;AACA,cAAIwG,MAAM,CAAC/G,cAAP,CAAsB,OAAtB,KAAkC+G,MAAM,CAACR,KAAP,CAAavG,cAAb,CAA4B,MAA5B,CAAtC,EAA2E;AACvEwF,YAAAA,EAAE,CAAC/B,KAAH,CAAS,WAAWuD,KAApB,IAA6B,gBAAgB/H,SAAS,CAAC8H,MAAM,CAACR,KAAP,CAAaxH,IAAd,CAAtD;AACH,WAFD,MAGK;AACD;AACAyG,YAAAA,EAAE,CAAC/B,KAAH,CAAS,WAAWuD,KAApB,IAA6B,gBAA7B;AACH;AACJ;AACJ;AACJ;AACJ,GAjEsE,CAkEvE;;;AACA,MAAIvB,KAAK,IAAI,QAAOA,KAAP,MAAiB,QAA1B,IAAsCA,KAAK,CAACzF,cAAN,CAAqB,SAArB,CAA1C,EAA2E;AACvE,QAAIyF,KAAK,CAACxD,MAAN,IAAgBwD,KAAK,CAACxD,MAAN,CAAatB,KAAjC,EAAwC;AACpC6E,MAAAA,EAAE,CAAC2B,SAAH,GAAe1B,KAAK,CAACxD,MAAN,CAAatB,KAA5B;AACH,KAFD,MAGK;AACD6E,MAAAA,EAAE,CAAC2B,SAAH,GAAe1B,KAAK,CAACxD,MAAN,KAAiBqD,SAAjB,GAA6BG,KAAK,CAACxD,MAAnC,GAA4C,IAA3D;AACH;AACJ,GA1EsE,CA2EvE;;AACH;;AAED,SAASmF,WAAT,CAAqBtL,MAArB,EAA6BE,UAA7B,EAAyC;AACrC;AACA,MAAIqL,QAAQ,GAAGC,IAAI,CAACC,KAAL,CAAWC,QAAX,EAAf;;AACA,OAAK,IAAIrI,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGrD,MAAM,CAACsD,MAA3B,EAAmCD,CAAC,EAApC,EAAwC;AACpC,QAAIsI,OAAO,GAAG3L,MAAM,CAACqD,CAAD,CAAN,CAAUuI,OAAV,EAAd;AACA,QAAIC,SAAS,GAAGL,IAAI,CAACC,KAAL,CAAWK,YAAX,CAAwBH,OAAxB,CAAhB,CAFoC,CAGpC;;AACAH,IAAAA,IAAI,CAACC,KAAL,CAAWM,iBAAX,CAA6BR,QAA7B,EAAuCM,SAAvC,EAAkD3L,UAAU,CAACmD,CAAD,CAA5D;AACH;;AACD,SAAOkI,QAAP;AACH;;AAED,SAASS,aAAT,CAAuBT,QAAvB,EAAiCtH,IAAjC,EAAuC;AACnC,MAAIgI,aAAa,GAAG,OAApB,CADmC,CAEnC;;AACA,MAAI,OAAOV,QAAP,KAAoB,WAAxB,EAAqC;AACjC,WAAOC,IAAI,CAACU,SAAL,CAAeZ,WAAW,CAACa,GAAG,CAAC/L,MAAL,EAAa+L,GAAG,CAACjM,UAAjB,CAA1B,EAAwDiM,GAAG,CAAC1M,YAAJ,GAAmBwM,aAA3E,CAAP;AACH,GAFD,MAGK;AACDT,IAAAA,IAAI,CAACU,SAAL,CAAeX,QAAf,EAAyBtH,IAAI,GAAGgI,aAAhC;AACH;AACJ,C,CAED;;;AACA,SAASG,eAAT,CAAyB1J,SAAzB,EAAoC0C,GAApC,EAAyCG,GAAzC,EAA8C;AAC1C,MAAI,CAACrF,UAAU,CAAC+G,QAAX,CAAoBvE,SAApB,CAAL,EAAqC;AACjCkC,IAAAA,OAAO,CAACmC,GAAR,CAAY,6BAAZ;AACA;AACH;;AACD,MAAIyB,KAAK,GAAGxI,MAAM,CAACE,UAAU,CAAC0F,OAAX,CAAmBlD,SAAnB,CAAD,CAAlB;AACA,MAAI7B,IAAI,GAAG2H,KAAK,CAAC6D,aAAN,CAAoBjH,GAApB,EAAyBG,GAAzB,CAAX;;AACA,MAAI,CAAC1E,IAAI,CAACqD,cAAL,CAAoB,SAApB,CAAL,EAAqC;AACjCU,IAAAA,OAAO,CAACmC,GAAR,CAAY,0DAAZ;AACA;AACH;;AAED,MAAIuF,UAAU,GAAGrG,MAAM,CAACC,KAAP,CAAarF,IAAI,CAAC0L,OAAlB,CAAjB;;AACA,MAAID,UAAU,CAACzH,KAAf,EAAsB;AAClBhE,IAAAA,IAAI,CAACsF,MAAL,GAAcmG,UAAd;AACH,GAFD,MAGK;AACDzL,IAAAA,IAAI,CAACsF,MAAL,GAAcmG,UAAU,CAACnG,MAAzB;AACH;;AAEDqC,EAAAA,KAAK,CAACgE,aAAN,CAAoBpH,GAApB,EAAyBG,GAAzB,EAA8B1E,IAA9B;AACA,SAAOA,IAAP;AACH","sourcesContent":["// Workbook GUI functions...\r\n\r\nconst SCALE = 8; // scale up the column width and row height\r\nlet global = {workbookData: {}, dataValidation: {}};\r\n\r\nclass WorkbookGUI {\r\n    constructor(mode, workbookName, workbookRawData, workbookRawExtra, height = $(window).height() - 360) {\r\n        this.height = height;\r\n        this.mode = mode; // can be 'view' or 'edit'\r\n        this.addSheetTab = $('<a id=\"add-sheet-btn\" class=\"nav-link nav-item\" href=\"#\"><i class=\"fas fa-plus\"></i> Add Sheet</a>');\r\n        this.workbookName = workbookName;\r\n        global.workbookRawData = workbookRawData;\r\n        global.workbookRawExtra = workbookRawExtra;\r\n        global.workbookData = {sheets: {}}; // pre-processed data and extra\r\n        this.currSheet = '';\r\n        this.sheetNames = [];\r\n        this.sheetNamesWithoutHidden = [];\r\n        this.tables = [];\r\n        this.tabContents = [];\r\n        this.tabs = [];\r\n        this.tabCounter = 0;\r\n        this.gridIds = [];\r\n        this.definedNames = {};\r\n\r\n        this._appendAddSheetTab();\r\n    }\r\n\r\n    /**\r\n     * Initialize a styled table\r\n     * @param container\r\n     * @param width\r\n     * @param height\r\n     * @param data\r\n     * @param rowHeights\r\n     * @param colWidths\r\n     * @param merges\r\n     * @param sheetNo\r\n     * @param cells\r\n     */\r\n    addTable(container, width, height, data, rowHeights, colWidths, merges, sheetNo, cells) {\r\n        let prop = {};\r\n        if (typeof rowHeights === 'number') {\r\n            prop.rowHeights = rowHeights;\r\n            prop.colWidths = colWidths;\r\n        }\r\n        else {\r\n            prop.rowHeights = rowHeights.map(function (x) {\r\n                return Math.round(x * SCALE / 5.5385);\r\n            });\r\n            prop.colWidths = colWidths.map(function (x) {\r\n                return Math.round(x * SCALE);\r\n            });\r\n        }\r\n        var spec = {\r\n            data: data,\r\n            width: width,\r\n            height: height,\r\n            colWidths: prop.colWidths,\r\n            rowHeights: prop.rowHeights,\r\n            mergeCells: merges,\r\n            manualColumnResize: true,\r\n            manualRowResize: true,\r\n            manualColumnMove: false,\r\n            manualRowMove: false,\r\n            rowHeaders: true,\r\n            colHeaders: true,\r\n            autoWrapCol: false,\r\n            autoWrapRow: false,\r\n            autoRowSize: false,\r\n            autoColumnSize: false,\r\n            contextMenu: ['copy'],\r\n            renderAllRows: false,\r\n            cells: cells,\r\n        };\r\n        const that = this;\r\n        let createdTable = new Handsontable(container, spec);\r\n        createdTable.sheetNo = sheetNo;\r\n        that.tables.push(createdTable);\r\n        return createdTable;\r\n    }\r\n\r\n    /**\r\n     * Edit mode for create/edit workbook, View mode for user view the workbook\r\n     *\r\n     * @param sheetName\r\n     * @param mode can be either 'edit' or 'view'\r\n     * @param tabColor can be null\r\n     * @return string\r\n     */\r\n    addTab(sheetName, tabColor) {\r\n        var gridId = 'grid-' + this.tabCounter;\r\n        this.gridIds.push(gridId);\r\n        var tabContentId = 'tab-content-' + this.tabCounter;\r\n        var tabId = 'tab-' + this.tabCounter;\r\n\r\n        // add content\r\n        var tabContent = $('<div id=\"' + tabContentId + '\" class=\"tab-pane active show\"> <div id=\"' + gridId + '\"></div></div>');\r\n        this.tabContents.push(tabContent);\r\n\r\n        // add tab\r\n        var newTab;\r\n        // edit mode have edit button in tabs\r\n        if (this.mode === 'edit') {\r\n            newTab = $('<a id=\"' + tabId + '\" class=\"nav-item nav-link active show\" data-toggle=\"tab\" href=\"#' + tabContentId + '\"> ' + sheetName\r\n                + '<i onclick=\"editSheet(' + this.tabCounter + ')\" class=\"fas fa-pen ml-2\"></i></a>');\r\n        }\r\n        else {\r\n            newTab = $('<a class=\"nav-item nav-link active show\" data-toggle=\"tab\" href=\"#' + tabContentId + '\">' + sheetName + '</a>');\r\n        }\r\n        if (tabColor && tabColor.argb) {\r\n            newTab.css('border-bottom', '3px solid #' + argbToRgb(tabColor.argb));\r\n        }\r\n        this.tabs.push(newTab);\r\n\r\n        this.tabCounter++;\r\n        return gridId;\r\n    }\r\n\r\n    applyTabs() {\r\n        // deactivate previous tab and content\r\n        $('div.active.show').removeClass('active show');\r\n        $('a.active').removeClass('active show');\r\n        let i;\r\n        for (i = 0; i < this.tabContents.length; i++) {\r\n            $('#nav-tabContent').append(this.tabContents[i]);\r\n\r\n            if (this.mode === 'edit') {\r\n                this.tabs[i].insertBefore('#nav-tab a:nth-last-child(1)');\r\n            }\r\n            else {\r\n                $('#nav-tab').append(this.tabs[i]);\r\n            }\r\n        }\r\n        this.tabs = [];\r\n        this.tabContents = [];\r\n    }\r\n\r\n    _appendAddSheetTab() {\r\n        $('#nav-tab').append(this.addSheetTab);\r\n    }\r\n\r\n    setAddSheetCallback(cb) {\r\n        $('#add-sheet-btn').on('click', cb);\r\n    }\r\n\r\n    updateJson(workbookRawData, workbookRawExtra) {\r\n        global.workbookRawData = workbookRawData;\r\n        global.workbookRawExtra = workbookRawExtra;\r\n        this.sheetNames = [];\r\n        this.tables = [];\r\n        this.tabContents = [];\r\n        this.tabs = [];\r\n        this.tabCounter = 0;\r\n        this.gridIds = [];\r\n    }\r\n\r\n    load() {\r\n        this.tabCounter = 0;\r\n        // clear tables and tabs\r\n        $('#nav-tab').html('');\r\n        $('#nav-tabContent').html('');\r\n\r\n        if (this.mode === 'edit')\r\n            this._appendAddSheetTab();\r\n\r\n        this._preProcess();\r\n        this.applyJsonWithStyle();\r\n    }\r\n\r\n    // apply json to GUI tables\r\n    applyJsonWithStyle() {\r\n        var timerStart = Date.now();\r\n        // clear global variables\r\n        this.tables = [];\r\n        this.sheetNames = [];\r\n\r\n        // load tabs\r\n        const sheets = global.workbookData.sheets;\r\n        // push sheet names first, since we need it now to call getSheet()\r\n        for (var sheetNo in sheets) {\r\n            this.sheetNames.push(sheets[sheetNo].name);\r\n        }\r\n        this.currSheet = this.sheetNames[0];\r\n\r\n        for (var sheetNo in sheets) {\r\n            if (sheets.hasOwnProperty(sheetNo) && sheets[sheetNo].state !== 'hidden') {\r\n                this.sheetNamesWithoutHidden.push(sheets[sheetNo].name);\r\n                var ws = sheets[sheetNo];\r\n                const gridId = this.addTab(ws.name, ws.tabColor);\r\n                this.applyTabs();\r\n                let container = $('#' + gridId)[0];\r\n                let data = sheets[sheetNo].data;\r\n\r\n                // transform mergeCells\r\n                var merges = ws.merges;\r\n\r\n                // process data validation\r\n                global.dataValidation[sheetNo] = {\r\n                    dropDownAddresses: [],\r\n                    dropDownData: {}\r\n                };\r\n                for (let key in ws.dataValidations) {\r\n                    if (ws.dataValidations.hasOwnProperty(key)) {\r\n                        const dataValidation = ws.dataValidations[key];\r\n                        if (dataValidation.type !== 'list') {\r\n                            console.error('Unsupported data validation type: ' + dataValidation.type);\r\n                            continue;\r\n                        }\r\n                        const addresses = key.split(' ');\r\n                        let addressSplited = [];\r\n                        for (let i = 0; i < addresses.length; i++) {\r\n                            //  {top: 1, left: 1, bottom: 5, right: 1, tl: \"A1\", …}\r\n                            const decoded = colCache.decode(addresses[i]);\r\n                            if ('top' in decoded) {\r\n                                for (let row = decoded.top; row < decoded.bottom + 1; row++) {\r\n                                    for (let col = decoded.left; col < decoded.right + 1; col++) {\r\n                                        addressSplited.push(colCache.encode(row, col));\r\n                                    }\r\n                                }\r\n                            }\r\n                            // {address: \"A1\", col: 1, row: 1, $col$row: \"$A$1\"}\r\n                            else if ('row' in decoded) {\r\n                                addressSplited.push(addresses[i]);\r\n                            }\r\n                        }\r\n\r\n                        for (let i = 0; i < addressSplited.length; i++) {\r\n                            global.dataValidation[sheetNo].dropDownAddresses.push(addressSplited[i]);\r\n\r\n                            // get data\r\n                            // situation 1: e.g. formulae: [\"\"1,2,3,4\"\"]\r\n                            const formulae = dataValidation.formulae[0];\r\n                            if (formulae.indexOf(',') > 0) {\r\n                                let data = formulae.slice(1, formulae.length - 1).split(',');\r\n                                const dataTrimmed = data.map(x => x.trim());\r\n                                global.dataValidation[sheetNo].dropDownData[addressSplited[i]] = dataTrimmed;\r\n                            }\r\n                            // situation 2: e.g. formulae: [\"$B$5:$K$5\"]\r\n                            else if (formulae.indexOf(':') > 0) {\r\n                                const parsed = parser.parse(formulae).result;\r\n                                // concat 2d array to 1d array\r\n                                let newArr = [];\r\n                                for (let i = 0; i < parsed.length; i++) {\r\n                                    newArr = newArr.concat(parsed[i]);\r\n                                }\r\n                                global.dataValidation[sheetNo].dropDownData[addressSplited[i]] = newArr;\r\n                            }\r\n                            // situation 3: e.g. formulae: [\"definedName\"]\r\n                            else if (formulae in global.workbookData.definedNames) {\r\n                                global.dataValidation[sheetNo].dropDownData[addressSplited[i]] = this.getDefinedName(formulae);\r\n                            }\r\n                            else {\r\n                                console.error('Unknown dataValidation formulae situation: ' + formulae);\r\n                            }\r\n                        }\r\n                    }\r\n                }\r\n\r\n                // generate table\r\n                // worksheet has no style\r\n                if (!ws.row) {\r\n                    this.addTable(container, $('#nav-tab').width(), this.height, data,\r\n                        23, 80, true, sheetNo, function (row, col) {\r\n                            let cellProperties = {};\r\n                            cellProperties.editor = FormulaEditor;\r\n                            cellProperties.renderer = cellRenderer;\r\n                            return cellProperties;\r\n                        });\r\n                }\r\n                else {\r\n                    const table = this.addTable(container, $('#nav-tab').width(), this.height, data,\r\n                        ws.row.height, ws.col.width, merges, sheetNo, function (row, col) {\r\n                            let cellProperties = {};\r\n                            if (!('sheetNo' in this.instance)) {\r\n                                this.instance.sheetNo = sheetNo;\r\n                                console.log(sheetNo)\r\n                            }\r\n\r\n                            // dropdown\r\n                            // TO-DO move data validation to ws.style, this should improve the efficient\r\n                            const address = colCache.encode(row + 1, col + 1);\r\n                            const dataValidation = global.dataValidation[this.instance.sheetNo];\r\n                            if (dataValidation.dropDownAddresses.includes(address)) {\r\n                                cellProperties.source = dataValidation.dropDownData[address];\r\n                                cellProperties.renderer = Handsontable.renderers.AutocompleteRenderer;\r\n                                cellProperties.editor = Handsontable.editors.DropdownEditor;\r\n                                cellProperties.validator = Handsontable.validators.AutocompleteValidator;\r\n                                cellProperties.allowInvalid = false;\r\n                                return cellProperties;\r\n                            }\r\n\r\n                            // text or formula\r\n                            var ws = global.workbookData.sheets[this.instance.sheetNo];\r\n\r\n                            cellProperties.style = null;\r\n                            if (ws.style[row] && ws.style[row][col] && Object.keys(ws.style[row][col]).length !== 0) {\r\n                                cellProperties.style = ws.style[row][col];\r\n                            }\r\n                            cellProperties.renderer = cellRenderer;\r\n                            cellProperties.editor = FormulaEditor;\r\n                            return cellProperties;\r\n                        });\r\n\r\n                }\r\n\r\n            }\r\n        }\r\n\r\n        $('#nav-tab a:first-child').tab('show');\r\n\r\n        hideLoadingStatus();\r\n        const that = this;\r\n        // setTimeout(function () {\r\n        //     that.tables[0].render();\r\n        //     hideLoadingStatus();\r\n        // }, 0);\r\n        // add listener to tabs\r\n        $('.nav-tabs a').on('show.bs.tab', function (event) {\r\n            that.currSheet = $(event.target).text();         // active tab\r\n            // if (!that.rendered[that.currSheet]) {\r\n            //     updateStatus('Rendering...');\r\n            //     setTimeout(function () {\r\n            //         const table = that.tables[that.sheetNames.indexOf(that.currSheet)];\r\n            //         table.render();\r\n            //         clearStatus();\r\n            //     }, 10);\r\n            //     that.rendered[that.currSheet] = true;\r\n            // }\r\n        });\r\n        console.log(\"Time consumed: \", Date.now() - timerStart + 'ms');\r\n    }\r\n\r\n    getData() {\r\n        const data = {};\r\n        let cnt = 0;\r\n        for (let sheetNo in global.workbookData.sheets) {\r\n            if (global.workbookData.sheets.hasOwnProperty(sheetNo)) {\r\n                const wsData = global.workbookData.sheets[sheetNo].data;\r\n                data[sheetNo] = {\r\n                    name: this.sheetNames[cnt],\r\n                    dimension: [wsData.length, wsData[0].length]\r\n                };\r\n                for (let rowNumber = 0; rowNumber < wsData.length; rowNumber++) {\r\n                    data[sheetNo][rowNumber] = {};\r\n                    for (let colNumber = 0; colNumber < wsData[0].length; colNumber++) {\r\n                        if (wsData[rowNumber][colNumber] !== null) {\r\n                            data[sheetNo][rowNumber][colNumber] = wsData[rowNumber][colNumber];\r\n                        }\r\n                    }\r\n                    if (Object.keys(data[sheetNo][rowNumber]).length === 0) {\r\n                        delete data[sheetNo][rowNumber];\r\n                    }\r\n                }\r\n            }\r\n            cnt++;\r\n        }\r\n        return data;\r\n    }\r\n\r\n    addSheet(sheetName, data) {\r\n        const sheetNo = this.sheetNames.length;\r\n        global.workbookData.sheets[sheetNo] = {name: sheetName, data: data};\r\n        this.sheetNames.push(sheetName);\r\n        const gridId = this.addTab(sheetName);\r\n        this.applyTabs();\r\n        let container = $('#' + gridId)[0];\r\n        let table = this.addTable(container, $('#nav-tab').width(), this.height, data,\r\n            23, 80, true, sheetNo, function (row, col) {\r\n                let cellProperties = {};\r\n                cellProperties.editor = FormulaEditor;\r\n                cellProperties.renderer = cellRenderer;\r\n                return cellProperties;\r\n            });\r\n        this.tables.push(table);\r\n\r\n        $('#nav-tab a:first-child').tab('show');\r\n        this.currSheet = this.sheetNames[0];\r\n        // add listener to tabs\r\n        $('.nav-tabs a').on('show.bs.tab', function (event) {\r\n            this.currSheet = $(event.target).text();         // active tab\r\n        });\r\n    }\r\n\r\n    getSheet(name) {\r\n        return global.workbookData.sheets[this.sheetNames.indexOf(name)];\r\n    }\r\n\r\n    getDataAtSheetAndCell(sheet, row, col) {\r\n        return global.workbookData.sheets[this.sheetNames.indexOf(sheet)].data[row][col];\r\n    }\r\n\r\n    getTable(name) {\r\n        return this.tables[this.sheetNames.indexOf(name)];\r\n    }\r\n\r\n    getDefinedName(definedName) {\r\n        const definedNames = global.workbookData.definedNames;\r\n        if (!(definedName in definedNames)) {\r\n            console.error('Cannot find defined name: ' + definedName);\r\n            return;\r\n        }\r\n        const currName = global.workbookData.definedNames[definedName];\r\n        let result = [];\r\n        for (let i = 0; i < currName.length; i++) {\r\n            const cell = this.getSheet(currName[i].sheetName).data[currName[i].row - 1][currName[i].col - 1];\r\n            if (cell === null) {\r\n            }\r\n            else if (typeof cell === 'object' && 'result' in cell) {\r\n                result.push(cell.result);\r\n            }\r\n            else {\r\n                result.push(cell);\r\n            }\r\n        }\r\n        return result;\r\n    }\r\n\r\n    _preProcess() {\r\n        if (global.workbookRawExtra) {\r\n            global.workbookData.definedNames = global.workbookRawExtra.definedNames;\r\n        }\r\n        global.workbookData.sheets = {};\r\n        for (let orderNo in global.workbookRawData) {\r\n            const wsData = global.workbookData.sheets[orderNo] = {};\r\n            const data = global.workbookRawData[orderNo];\r\n            wsData.data = [];\r\n            wsData.name = data.name;\r\n            // if has extra\r\n            if (global.workbookRawExtra) {\r\n                const extra = global.workbookRawExtra.sheets[orderNo];\r\n                wsData.col = {};\r\n                wsData.col.width = dictToList(extra.col.width, data.dimension[1], 23);\r\n                wsData.row = {};\r\n                wsData.row.height = dictToList(extra.row.height, data.dimension[0], extra.defaultRowHeight);\r\n                wsData.dataValidations = extra.dataValidations;\r\n                wsData.state = extra.state;\r\n                wsData.tabColor = extra.tabColor;\r\n                wsData.style = extra.style;\r\n\r\n                // transform mergeCells\r\n                const merges = wsData.merges = [];\r\n                for (let position in extra.merges) {\r\n                    if (extra.merges.hasOwnProperty(position)) {\r\n                        const model = extra.merges[position].model;\r\n                        merges.push({\r\n                            row: model.top - 1,\r\n                            col: model.left - 1,\r\n                            rowspan: model.bottom - model.top + 1,\r\n                            colspan: model.right - model.left + 1\r\n                        })\r\n                    }\r\n                }\r\n            }\r\n\r\n            for (let rowNumber = 0; rowNumber < data.dimension[0]; rowNumber++) {\r\n                wsData.data.push([]);\r\n                for (let colNumber = 0; colNumber < data.dimension[1]; colNumber++) {\r\n                    if (data && data[rowNumber] && data[rowNumber][colNumber]) {\r\n                        wsData.data[rowNumber].push(data[rowNumber][colNumber]);\r\n                    }\r\n                    else {\r\n                        wsData.data[rowNumber].push(null);\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\nfunction dictToList(dict, length, defVal=null) {\r\n    let ret = [];\r\n    for (let i = 0; i < length; i++) {\r\n        if (dict[i] !== undefined) {\r\n            ret.push(dict[i]);\r\n        }\r\n        else {\r\n            ret.push(defVal);\r\n        }\r\n    }\r\n    return ret;\r\n}\r\n\r\n\r\nfunction argbToRgb(argb) {\r\n    return argb.substring(2);\r\n}\r\n\r\nfunction cellRenderer(instance, td, row, col, prop, value, cellProperties) {\r\n    Handsontable.renderers.TextRenderer.apply(this, arguments);\r\n    if (('style' in cellProperties) && cellProperties.style) {\r\n        var style = cellProperties.style;\r\n        // alignment\r\n        var cellMeta = instance.getCellMeta(row, col);\r\n        var previousClass = (cellMeta.className !== undefined) ? cellMeta.className : '';\r\n\r\n        if (style.hasOwnProperty('alignment')) {\r\n            if (style.alignment.hasOwnProperty('horizontal')) {\r\n                td.style.textAlign = style.alignment.horizontal;\r\n            }\r\n            if (style.alignment.hasOwnProperty('vertical')) {\r\n\r\n                switch (style.alignment.vertical) {\r\n                    case 'top':\r\n                        instance.setCellMeta(row, col, 'className', previousClass + ' htTop');\r\n                        break;\r\n                    case 'middle':\r\n                        instance.setCellMeta(row, col, 'className', previousClass + ' htMiddle');\r\n                        break;\r\n                }\r\n            }\r\n        }\r\n        else {\r\n            // default bottom\r\n            instance.setCellMeta(row, col, 'className', previousClass + ' htBottom');\r\n        }\r\n\r\n        // font\r\n        if (style.hasOwnProperty('font')) {\r\n            if (style.font.hasOwnProperty('color') && style.font.color.hasOwnProperty('argb')) {\r\n                td.style.color = '#' + argbToRgb(style.font.color.argb);\r\n            }\r\n            if (style.font.hasOwnProperty('bold') && style.font.bold) {\r\n                td.style.fontWeight = 'bold';\r\n            }\r\n            if (style.font.hasOwnProperty('italic') && style.font.italic) {\r\n                td.style.fontStyle = 'italic';\r\n            }\r\n        }\r\n\r\n        // background\r\n        if (style.hasOwnProperty('fill')) {\r\n            if (style.fill.hasOwnProperty('fgColor') && style.fill.fgColor.hasOwnProperty('argb')) {\r\n                td.style.background = '#' + argbToRgb(style.fill.fgColor.argb);\r\n            }\r\n        }\r\n\r\n        // borders\r\n        if (style.hasOwnProperty('border')) {\r\n            for (var key in style.border) {\r\n                if (style.border.hasOwnProperty(key)) {\r\n                    var upper = key.charAt(0).toUpperCase() + key.slice(1);\r\n                    var border = style.border[key];\r\n                    if (border.hasOwnProperty('color') && border.color.hasOwnProperty('argb')) {\r\n                        td.style['border' + upper] = '1px solid #' + argbToRgb(border.color.argb);\r\n                    }\r\n                    else {\r\n                        // black color\r\n                        td.style['border' + upper] = '1px solid #000';\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    }\r\n    // render formula\r\n    if (value && typeof value === 'object' && value.hasOwnProperty('formula')) {\r\n        if (value.result && value.result.error) {\r\n            td.innerHTML = value.result.error;\r\n        }\r\n        else {\r\n            td.innerHTML = value.result !== undefined ? value.result : null;\r\n        }\r\n    }\r\n    // render dropdown\r\n}\r\n\r\nfunction getWorkbook(sheets, sheetNames) {\r\n    // create a workbook\r\n    var workbook = XLSX.utils.book_new();\r\n    for (var i = 0; i < sheets.length; i++) {\r\n        var ws_data = sheets[i].getData();\r\n        var worksheet = XLSX.utils.aoa_to_sheet(ws_data);\r\n        // Add the worksheet to the workbook\r\n        XLSX.utils.book_append_sheet(workbook, worksheet, sheetNames[i]);\r\n    }\r\n    return workbook;\r\n}\r\n\r\nfunction exportToExcel(workbook, name) {\r\n    var fileExtension = '.xlsx';\r\n    // empty params\r\n    if (typeof workbook === 'undefined') {\r\n        return XLSX.writeFile(getWorkbook(gui.tables, gui.sheetNames), gui.workbookName + fileExtension);\r\n    }\r\n    else {\r\n        XLSX.writeFile(workbook, name + fileExtension);\r\n    }\r\n}\r\n\r\n// re-evaluate formula\r\nfunction evaluateFormula(sheetName, row, col) {\r\n    if (!sheetNames.includes(sheetName)) {\r\n        console.log('Error: sheetName not found.');\r\n        return\r\n    }\r\n    var sheet = sheets[sheetNames.indexOf(sheetName)];\r\n    var data = sheet.getDataAtCell(row, col);\r\n    if (!data.hasOwnProperty('formula')) {\r\n        console.log('Error: evaluateFormula(): cell provided is not a formula');\r\n        return\r\n    }\r\n\r\n    var calculated = parser.parse(data.formula);\r\n    if (calculated.error) {\r\n        data.result = calculated;\r\n    }\r\n    else {\r\n        data.result = calculated.result;\r\n    }\r\n\r\n    sheet.setDataAtCell(row, col, data);\r\n    return data;\r\n}\r\n\r\n\r\n\r\n"],"file":"workbook-gui.js"}