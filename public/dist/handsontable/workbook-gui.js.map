{"version":3,"sources":["../../moh.js/handsontable/workbook-gui.js"],"names":["SCALE","global","workbookData","WorkbookGUI","mode","workbookName","height","$","window","addSheetTab","currSheet","sheetNames","tables","tabContents","tabs","tabCounter","gridIds","_appendAddSheetTab","container","width","data","rowHeights","colWidths","merges","sheetNo","cells","prop","map","x","Math","round","spec","mergeCells","manualColumnResize","manualRowResize","manualColumnMove","manualRowMove","rowHeaders","colHeaders","autoWrapCol","autoWrapRow","autoRowSize","autoColumnSize","contextMenu","renderAllRows","createdTable","Handsontable","push","sheetName","tabColor","gridId","tabContentId","tabId","tabContent","newTab","argb","css","argbToRgb","removeClass","i","length","append","insertBefore","cb","on","html","applyJsonWithStyle","timerStart","Date","now","sheets","hasOwnProperty","ws","name","addTab","applyTabs","position","model","row","top","col","left","rowspan","bottom","colspan","right","table","addTable","cellProperties","editor","FormulaEditor","renderer","cellRenderer","instance","console","log","style","Object","keys","tab","event","target","text","cnt","getData","substring","td","value","renderers","TextRenderer","apply","arguments","cellMeta","getCellMeta","previousClass","className","undefined","alignment","textAlign","horizontal","vertical","setCellMeta","font","color","bold","fontWeight","italic","fontStyle","fill","fgColor","background","key","border","upper","charAt","toUpperCase","slice","result","error","innerHTML","applyJsonWithoutStyle","workBookJson","document","getElementById","addedTable","newSimpleTable","loadData","updateSettings","readOnly","getWorkbook","workbook","XLSX","utils","book_new","ws_data","worksheet","aoa_to_sheet","book_append_sheet","exportToExcel","fileExtension","writeFile","gui","evaluateFormula","includes","sheet","indexOf","getDataAtCell","calculated","parser","parse","formula","setDataAtCell"],"mappings":";;;;;;;;;;AAAA;AAEA,IAAMA,KAAK,GAAG,CAAd,C,CAAiB;;AACjB,IAAIC,MAAM,GAAG;AAACC,EAAAA,YAAY,EAAE;AAAf,CAAb;;IAEMC,W;;;AACF,uBAAYC,IAAZ,EAAkBC,YAAlB,EAAgCH,YAAhC,EAAiF;AAAA,QAAnCI,MAAmC,uEAA1BC,CAAC,CAACC,MAAD,CAAD,CAAUF,MAAV,KAAqB,GAAK;;AAAA;;AAC7E,SAAKA,MAAL,GAAcA,MAAd;AACA,SAAKF,IAAL,GAAYA,IAAZ,CAF6E,CAE3D;;AAClB,SAAKK,WAAL,GAAmBF,CAAC,CAAC,oGAAD,CAApB;AACA,SAAKF,YAAL,GAAoBA,YAApB;AACAJ,IAAAA,MAAM,CAACC,YAAP,GAAsBA,YAAtB;AACA,SAAKQ,SAAL,GAAiB,EAAjB;AACA,SAAKC,UAAL,GAAkB,EAAlB;AACA,SAAKC,MAAL,GAAc,EAAd;AACA,SAAKC,WAAL,GAAmB,EAAnB;AACA,SAAKC,IAAL,GAAY,EAAZ;AACA,SAAKC,UAAL,GAAkB,CAAlB;AACA,SAAKC,OAAL,GAAe,EAAf;;AACA,SAAKC,kBAAL;AACH;AAED;;;;;;;;;;;;;6BASSC,S,EAAWC,K,EAAOb,M,EAAQc,I,EAAMC,U,EAAYC,S,EAAWC,M,EAAQC,O,EAASC,K,EAAO;AACpF,UAAIC,IAAI,GAAG,EAAX;;AACA,UAAI,OAAOL,UAAP,KAAsB,QAA1B,EAAoC;AAChCK,QAAAA,IAAI,CAACL,UAAL,GAAkBA,UAAlB;AACAK,QAAAA,IAAI,CAACJ,SAAL,GAAiBA,SAAjB;AACH,OAHD,MAIK;AACDI,QAAAA,IAAI,CAACL,UAAL,GAAkBA,UAAU,CAACM,GAAX,CAAe,UAAUC,CAAV,EAAa;AAC1C,iBAAOC,IAAI,CAACC,KAAL,CAAWF,CAAC,GAAG5B,KAAJ,GAAY,MAAvB,CAAP;AACH,SAFiB,CAAlB;AAGA0B,QAAAA,IAAI,CAACJ,SAAL,GAAiBA,SAAS,CAACK,GAAV,CAAc,UAAUC,CAAV,EAAa;AACxC,iBAAOC,IAAI,CAACC,KAAL,CAAWF,CAAC,GAAG5B,KAAf,CAAP;AACH,SAFgB,CAAjB;AAGH;;AACD,UAAI+B,IAAI,GAAG;AACPX,QAAAA,IAAI,EAAEA,IADC;AAEPD,QAAAA,KAAK,EAAEA,KAFA;AAGPb,QAAAA,MAAM,EAAEA,MAHD;AAIPgB,QAAAA,SAAS,EAAEI,IAAI,CAACJ,SAJT;AAKPD,QAAAA,UAAU,EAAEK,IAAI,CAACL,UALV;AAMPW,QAAAA,UAAU,EAAET,MANL;AAOPU,QAAAA,kBAAkB,EAAE,IAPb;AAQPC,QAAAA,eAAe,EAAE,IARV;AASPC,QAAAA,gBAAgB,EAAE,KATX;AAUPC,QAAAA,aAAa,EAAE,KAVR;AAWPC,QAAAA,UAAU,EAAE,IAXL;AAYPC,QAAAA,UAAU,EAAE,IAZL;AAaPC,QAAAA,WAAW,EAAE,KAbN;AAcPC,QAAAA,WAAW,EAAE,KAdN;AAePC,QAAAA,WAAW,EAAE,KAfN;AAgBPC,QAAAA,cAAc,EAAE,KAhBT;AAiBPC,QAAAA,WAAW,EAAE,CAAC,MAAD,CAjBN;AAkBPC,QAAAA,aAAa,EAAE,KAlBR;AAmBPnB,QAAAA,KAAK,EAAEA;AAnBA,OAAX;AAsBA,UAAIoB,YAAY,GAAG,IAAIC,YAAJ,CAAiB5B,SAAjB,EAA4Ba,IAA5B,CAAnB;AACA,WAAKnB,MAAL,CAAYmC,IAAZ,CAAiBF,YAAjB;AACA,aAAOA,YAAP;AACH;AAED;;;;;;;;;;;2BAQOG,S,EAAWC,Q,EAAU;AACxB,UAAIC,MAAM,GAAG,UAAU,KAAKnC,UAA5B;AACA,WAAKC,OAAL,CAAa+B,IAAb,CAAkBG,MAAlB;AACA,UAAIC,YAAY,GAAG,iBAAiB,KAAKpC,UAAzC;AACA,UAAIqC,KAAK,GAAG,SAAS,KAAKrC,UAA1B,CAJwB,CAMxB;;AACA,UAAIsC,UAAU,GAAG9C,CAAC,CAAC,cAAc4C,YAAd,GAA6B,2CAA7B,GAA2ED,MAA3E,GAAoF,gBAArF,CAAlB;AACA,WAAKrC,WAAL,CAAiBkC,IAAjB,CAAsBM,UAAtB,EARwB,CAUxB;;AACA,UAAIC,MAAJ,CAXwB,CAYxB;;AACA,UAAI,KAAKlD,IAAL,KAAc,MAAlB,EAA0B;AACtBkD,QAAAA,MAAM,GAAG/C,CAAC,CAAC,YAAY6C,KAAZ,GAAoB,mEAApB,GAA0FD,YAA1F,GAAyG,KAAzG,GAAiHH,SAAjH,GACL,wBADK,GACsB,KAAKjC,UAD3B,GACwC,qCADzC,CAAV;AAEH,OAHD,MAIK;AACDuC,QAAAA,MAAM,GAAG/C,CAAC,CAAC,uEAAuE4C,YAAvE,GAAsF,IAAtF,GAA6FH,SAA7F,GAAyG,MAA1G,CAAV;AACH;;AACD,UAAIC,QAAQ,IAAIA,QAAQ,CAACM,IAAzB,EAA+B;AAC3BD,QAAAA,MAAM,CAACE,GAAP,CAAW,eAAX,EAA4B,gBAAgBC,SAAS,CAACR,QAAQ,CAACM,IAAV,CAArD;AACH;;AACD,WAAKzC,IAAL,CAAUiC,IAAV,CAAeO,MAAf;AAEA,WAAKvC,UAAL;AACA,aAAOmC,MAAP;AACH;;;gCAEW;AACR;AACA3C,MAAAA,CAAC,CAAC,iBAAD,CAAD,CAAqBmD,WAArB,CAAiC,aAAjC;AACAnD,MAAAA,CAAC,CAAC,UAAD,CAAD,CAAcmD,WAAd,CAA0B,aAA1B;AACA,UAAIC,CAAJ;;AACA,WAAKA,CAAC,GAAG,CAAT,EAAYA,CAAC,GAAG,KAAK9C,WAAL,CAAiB+C,MAAjC,EAAyCD,CAAC,EAA1C,EAA8C;AAC1CpD,QAAAA,CAAC,CAAC,iBAAD,CAAD,CAAqBsD,MAArB,CAA4B,KAAKhD,WAAL,CAAiB8C,CAAjB,CAA5B;;AAEA,YAAI,KAAKvD,IAAL,KAAc,MAAlB,EAA0B;AACtB,eAAKU,IAAL,CAAU6C,CAAV,EAAaG,YAAb,CAA0B,8BAA1B;AACH,SAFD,MAGK;AACDvD,UAAAA,CAAC,CAAC,UAAD,CAAD,CAAcsD,MAAd,CAAqB,KAAK/C,IAAL,CAAU6C,CAAV,CAArB;AACH;AACJ;;AACD,WAAK7C,IAAL,GAAY,EAAZ;AACA,WAAKD,WAAL,GAAmB,EAAnB;AACH;;;yCAEoB;AACjBN,MAAAA,CAAC,CAAC,UAAD,CAAD,CAAcsD,MAAd,CAAqB,KAAKpD,WAA1B;AACH;;;wCAEmBsD,E,EAAI;AACpBxD,MAAAA,CAAC,CAAC,gBAAD,CAAD,CAAoByD,EAApB,CAAuB,OAAvB,EAAgCD,EAAhC;AACH;;;+BAEU7D,Y,EAAc;AACrBD,MAAAA,MAAM,CAACC,YAAP,GAAsBA,YAAtB;AACH;;;2BAEM;AACH,WAAKa,UAAL,GAAkB,CAAlB,CADG,CAEH;;AACAR,MAAAA,CAAC,CAAC,UAAD,CAAD,CAAc0D,IAAd,CAAmB,EAAnB;AACA1D,MAAAA,CAAC,CAAC,iBAAD,CAAD,CAAqB0D,IAArB,CAA0B,EAA1B;AAEA,UAAI,KAAK7D,IAAL,KAAc,MAAlB,EACI,KAAKa,kBAAL;AAEJ,WAAKiD,kBAAL;AACH,K,CAED;;;;yCACqB;AACjB,UAAIC,UAAU,GAAGC,IAAI,CAACC,GAAL,EAAjB,CADiB,CAEjB;;AACA,WAAKC,MAAL,GAAc,EAAd;AACA,WAAK3D,UAAL,GAAkB,EAAlB,CAJiB,CAMjB;;AACA,WAAK,IAAIa,OAAT,IAAoBvB,MAAM,CAACC,YAA3B,EAAyC;AACrC,YAAID,MAAM,CAACC,YAAP,CAAoBqE,cAApB,CAAmC/C,OAAnC,CAAJ,EAAiD;AAC7C,cAAIgD,EAAE,GAAGvE,MAAM,CAACC,YAAP,CAAoBsB,OAApB,CAAT;AACA,eAAKb,UAAL,CAAgBoC,IAAhB,CAAqByB,EAAE,CAACC,IAAxB;AACA,cAAMvB,MAAM,GAAG,KAAKwB,MAAL,CAAYF,EAAE,CAACC,IAAf,EAAqBD,EAAE,CAACvB,QAAxB,CAAf;AACA,eAAK0B,SAAL;AACA,cAAIzD,SAAS,GAAGX,CAAC,CAAC,MAAM2C,MAAP,CAAD,CAAgB,CAAhB,CAAhB;AACA,cAAI9B,IAAI,GAAGoD,EAAE,CAACpD,IAAd,CAN6C,CAQ7C;;AACA,cAAIG,MAAM,GAAG,EAAb;;AACA,eAAK,IAAIqD,QAAT,IAAqBJ,EAAE,CAACjD,MAAxB,EAAgC;AAC5B,gBAAIiD,EAAE,CAACjD,MAAH,CAAUgD,cAAV,CAAyBK,QAAzB,CAAJ,EAAwC;AACpC,kBAAIC,KAAK,GAAGL,EAAE,CAACjD,MAAH,CAAUqD,QAAV,EAAoBC,KAAhC;AACAtD,cAAAA,MAAM,CAACwB,IAAP,CAAY;AACR+B,gBAAAA,GAAG,EAAED,KAAK,CAACE,GAAN,GAAY,CADT;AAERC,gBAAAA,GAAG,EAAEH,KAAK,CAACI,IAAN,GAAa,CAFV;AAGRC,gBAAAA,OAAO,EAAEL,KAAK,CAACM,MAAN,GAAeN,KAAK,CAACE,GAArB,GAA2B,CAH5B;AAIRK,gBAAAA,OAAO,EAAEP,KAAK,CAACQ,KAAN,GAAcR,KAAK,CAACI,IAApB,GAA2B;AAJ5B,eAAZ;AAMH;AACJ,WApB4C,CAqB7C;AACA;;;AACA,cAAIK,KAAK,SAAT;;AACA,cAAI,CAACd,EAAE,CAACM,GAAR,EAAa;AACTQ,YAAAA,KAAK,GAAG,KAAKC,QAAL,CAAcrE,SAAd,EAAyBX,CAAC,CAAC,UAAD,CAAD,CAAcY,KAAd,EAAzB,EAAgD,KAAKb,MAArD,EAA6Dc,IAA7D,EACJ,EADI,EACA,EADA,EACI,IADJ,EACUI,OADV,EACmB,UAAUsD,GAAV,EAAeE,GAAf,EAAoB;AACvC,kBAAIQ,cAAc,GAAG,EAArB;AACAA,cAAAA,cAAc,CAACC,MAAf,GAAwBC,aAAxB;AACAF,cAAAA,cAAc,CAACG,QAAf,GAA0BC,YAA1B;AACA,qBAAOJ,cAAP;AACH,aANG,CAAR;AAOH,WARD,MASK;AACDF,YAAAA,KAAK,GAAG,KAAKC,QAAL,CAAcrE,SAAd,EAAyBX,CAAC,CAAC,UAAD,CAAD,CAAcY,KAAd,EAAzB,EAAgD,KAAKb,MAArD,EAA6Dc,IAA7D,EACJoD,EAAE,CAACM,GAAH,CAAOxE,MADH,EACWkE,EAAE,CAACQ,GAAH,CAAO7D,KADlB,EACyBI,MADzB,EACiCC,OADjC,EAC0C,UAAUsD,GAAV,EAAeE,GAAf,EAAoB;AAC9D,kBAAI,EAAE,aAAa,KAAKa,QAApB,CAAJ,EAAmC;AAC/B,qBAAKA,QAAL,CAAcrE,OAAd,GAAwBA,OAAxB;AACAsE,gBAAAA,OAAO,CAACC,GAAR,CAAY,aAAavE,OAAzB;AACH;;AACD,kBAAIgD,EAAE,GAAGvE,MAAM,CAACC,YAAP,CAAoB,KAAK2F,QAAL,CAAcrE,OAAlC,CAAT;AACA,kBAAIgE,cAAc,GAAG,EAArB;AACAA,cAAAA,cAAc,CAACQ,KAAf,GAAuB,IAAvB;;AACA,kBAAIxB,EAAE,CAACwB,KAAH,CAASpC,MAAT,GAAkB,CAAlB,IAAuBY,EAAE,CAACwB,KAAH,CAASlB,GAAT,EAAclB,MAAd,GAAuBoB,GAA9C,IAAqDR,EAAE,CAACwB,KAAH,CAASlB,GAAT,EAAcE,GAAd,CAArD,IAA2EiB,MAAM,CAACC,IAAP,CAAY1B,EAAE,CAACwB,KAAH,CAASlB,GAAT,EAAcE,GAAd,CAAZ,EAAgCpB,MAAhC,KAA2C,CAA1H,EAA6H;AACzH4B,gBAAAA,cAAc,CAACQ,KAAf,GAAuBxB,EAAE,CAACwB,KAAH,CAASlB,GAAT,EAAcE,GAAd,CAAvB;AACH;;AACDQ,cAAAA,cAAc,CAACG,QAAf,GAA0BC,YAA1B;AACAJ,cAAAA,cAAc,CAACC,MAAf,GAAwBC,aAAxB;AAEA,qBAAOF,cAAP;AACH,aAhBG,CAAR;AAiBH;;AAEDF,UAAAA,KAAK,CAAC9D,OAAN,GAAgBA,OAAhB;AACH;AACJ;;AAEDjB,MAAAA,CAAC,CAAC,wBAAD,CAAD,CAA4B4F,GAA5B,CAAgC,MAAhC;AACA,WAAKzF,SAAL,GAAiB,KAAKC,UAAL,CAAgB,CAAhB,CAAjB,CAlEiB,CAmEjB;;AACAJ,MAAAA,CAAC,CAAC,aAAD,CAAD,CAAiByD,EAAjB,CAAoB,aAApB,EAAmC,UAAUoC,KAAV,EAAiB;AAChD,aAAK1F,SAAL,GAAiBH,CAAC,CAAC6F,KAAK,CAACC,MAAP,CAAD,CAAgBC,IAAhB,EAAjB,CADgD,CACC;AACpD,OAFD;AAGAR,MAAAA,OAAO,CAACC,GAAR,CAAY,iBAAZ,EAA+B3B,IAAI,CAACC,GAAL,KAAaF,UAAb,GAA0B,IAAzD;AACH;;;8BAES;AACN,UAAIoC,GAAG,GAAG,CAAV;;AACA,WAAK,IAAI/E,OAAT,IAAoBvB,MAAM,CAACC,YAA3B,EAAyC;AACrC,YAAID,MAAM,CAACC,YAAP,CAAoBqE,cAApB,CAAmC/C,OAAnC,CAAJ,EAAiD;AAC7C,cAAIgD,EAAE,GAAGvE,MAAM,CAACC,YAAP,CAAoBsB,OAApB,CAAT;AACAgD,UAAAA,EAAE,CAACC,IAAH,GAAU,KAAK9D,UAAL,CAAgB4F,GAAhB,CAAV;AACA/B,UAAAA,EAAE,CAACpD,IAAH,GAAU,KAAKR,MAAL,CAAY2F,GAAZ,EAAiBC,OAAjB,EAAV;AACH;;AACDD,QAAAA,GAAG;AACN;;AACD,aAAOtG,MAAM,CAACC,YAAd;AACH;;;6BAEQ8C,S,EAAW5B,I,EAAM;AACtB,UAAMI,OAAO,GAAG,KAAKb,UAAL,CAAgBiD,MAAhC;AACA3D,MAAAA,MAAM,CAACC,YAAP,CAAoBsB,OAApB,IAA+B;AAACiD,QAAAA,IAAI,EAAEzB,SAAP;AAAkB5B,QAAAA,IAAI,EAAEA;AAAxB,OAA/B;AACA,WAAKT,UAAL,CAAgBoC,IAAhB,CAAqBC,SAArB;AACA,UAAME,MAAM,GAAG,KAAKwB,MAAL,CAAY1B,SAAZ,CAAf;AACA,WAAK2B,SAAL;AACA,UAAIzD,SAAS,GAAGX,CAAC,CAAC,MAAM2C,MAAP,CAAD,CAAgB,CAAhB,CAAhB;AACA,UAAIoC,KAAK,GAAG,KAAKC,QAAL,CAAcrE,SAAd,EAAyBX,CAAC,CAAC,UAAD,CAAD,CAAcY,KAAd,EAAzB,EAAgD,KAAKb,MAArD,EAA6Dc,IAA7D,EACR,EADQ,EACJ,EADI,EACA,IADA,EACMI,OADN,EACe,UAAUsD,GAAV,EAAeE,GAAf,EAAoB;AACvC,YAAIQ,cAAc,GAAG,EAArB;AACAA,QAAAA,cAAc,CAACC,MAAf,GAAwBC,aAAxB;AACAF,QAAAA,cAAc,CAACG,QAAf,GAA0BC,YAA1B;AACA,eAAOJ,cAAP;AACH,OANO,CAAZ;AAOA,WAAK5E,MAAL,CAAYmC,IAAZ,CAAiBuC,KAAjB;AAEA/E,MAAAA,CAAC,CAAC,wBAAD,CAAD,CAA4B4F,GAA5B,CAAgC,MAAhC;AACA,WAAKzF,SAAL,GAAiB,KAAKC,UAAL,CAAgB,CAAhB,CAAjB,CAjBsB,CAkBtB;;AACAJ,MAAAA,CAAC,CAAC,aAAD,CAAD,CAAiByD,EAAjB,CAAoB,aAApB,EAAmC,UAAUoC,KAAV,EAAiB;AAChD,aAAK1F,SAAL,GAAiBH,CAAC,CAAC6F,KAAK,CAACC,MAAP,CAAD,CAAgBC,IAAhB,EAAjB,CADgD,CACC;AACpD,OAFD;AAGH;;;;;;AAGL,SAAS7C,SAAT,CAAmBF,IAAnB,EAAyB;AACrB,SAAOA,IAAI,CAACkD,SAAL,CAAe,CAAf,CAAP;AACH;;AAED,SAASb,YAAT,CAAsBC,QAAtB,EAAgCa,EAAhC,EAAoC5B,GAApC,EAAyCE,GAAzC,EAA8CtD,IAA9C,EAAoDiF,KAApD,EAA2DnB,cAA3D,EAA2E;AACvE1C,EAAAA,YAAY,CAAC8D,SAAb,CAAuBC,YAAvB,CAAoCC,KAApC,CAA0C,IAA1C,EAAgDC,SAAhD;;AACA,MAAK,WAAWvB,cAAZ,IAA+BA,cAAc,CAACQ,KAAlD,EAAyD;AACrD,QAAIA,KAAK,GAAGR,cAAc,CAACQ,KAA3B,CADqD,CAErD;;AACA,QAAIgB,QAAQ,GAAGnB,QAAQ,CAACoB,WAAT,CAAqBnC,GAArB,EAA0BE,GAA1B,CAAf;AACA,QAAIkC,aAAa,GAAIF,QAAQ,CAACG,SAAT,KAAuBC,SAAxB,GAAqCJ,QAAQ,CAACG,SAA9C,GAA0D,EAA9E;;AAEA,QAAInB,KAAK,CAACzB,cAAN,CAAqB,WAArB,CAAJ,EAAuC;AACnC,UAAIyB,KAAK,CAACqB,SAAN,CAAgB9C,cAAhB,CAA+B,YAA/B,CAAJ,EAAkD;AAC9CmC,QAAAA,EAAE,CAACV,KAAH,CAASsB,SAAT,GAAqBtB,KAAK,CAACqB,SAAN,CAAgBE,UAArC;AACH;;AACD,UAAIvB,KAAK,CAACqB,SAAN,CAAgB9C,cAAhB,CAA+B,UAA/B,CAAJ,EAAgD;AAE5C,gBAAQyB,KAAK,CAACqB,SAAN,CAAgBG,QAAxB;AACI,eAAK,KAAL;AACI3B,YAAAA,QAAQ,CAAC4B,WAAT,CAAqB3C,GAArB,EAA0BE,GAA1B,EAA+B,WAA/B,EAA4CkC,aAAa,GAAG,QAA5D;AACA;;AACJ,eAAK,QAAL;AACIrB,YAAAA,QAAQ,CAAC4B,WAAT,CAAqB3C,GAArB,EAA0BE,GAA1B,EAA+B,WAA/B,EAA4CkC,aAAa,GAAG,WAA5D;AACA;AANR;AAQH;AACJ,KAfD,MAgBK;AACD;AACArB,MAAAA,QAAQ,CAAC4B,WAAT,CAAqB3C,GAArB,EAA0BE,GAA1B,EAA+B,WAA/B,EAA4CkC,aAAa,GAAG,WAA5D;AACH,KAzBoD,CA2BrD;;;AACA,QAAIlB,KAAK,CAACzB,cAAN,CAAqB,MAArB,CAAJ,EAAkC;AAC9B,UAAIyB,KAAK,CAAC0B,IAAN,CAAWnD,cAAX,CAA0B,OAA1B,KAAsCyB,KAAK,CAAC0B,IAAN,CAAWC,KAAX,CAAiBpD,cAAjB,CAAgC,MAAhC,CAA1C,EAAmF;AAC/EmC,QAAAA,EAAE,CAACV,KAAH,CAAS2B,KAAT,GAAiB,MAAMlE,SAAS,CAACuC,KAAK,CAAC0B,IAAN,CAAWC,KAAX,CAAiBpE,IAAlB,CAAhC;AACH;;AACD,UAAIyC,KAAK,CAAC0B,IAAN,CAAWnD,cAAX,CAA0B,MAA1B,KAAqCyB,KAAK,CAAC0B,IAAN,CAAWE,IAApD,EAA0D;AACtDlB,QAAAA,EAAE,CAACV,KAAH,CAAS6B,UAAT,GAAsB,MAAtB;AACH;;AACD,UAAI7B,KAAK,CAAC0B,IAAN,CAAWnD,cAAX,CAA0B,QAA1B,KAAuCyB,KAAK,CAAC0B,IAAN,CAAWI,MAAtD,EAA8D;AAC1DpB,QAAAA,EAAE,CAACV,KAAH,CAAS+B,SAAT,GAAqB,QAArB;AACH;AACJ,KAtCoD,CAwCrD;;;AACA,QAAI/B,KAAK,CAACzB,cAAN,CAAqB,MAArB,CAAJ,EAAkC;AAC9B,UAAIyB,KAAK,CAACgC,IAAN,CAAWzD,cAAX,CAA0B,SAA1B,KAAwCyB,KAAK,CAACgC,IAAN,CAAWC,OAAX,CAAmB1D,cAAnB,CAAkC,MAAlC,CAA5C,EAAuF;AACnFmC,QAAAA,EAAE,CAACV,KAAH,CAASkC,UAAT,GAAsB,MAAMzE,SAAS,CAACuC,KAAK,CAACgC,IAAN,CAAWC,OAAX,CAAmB1E,IAApB,CAArC;AACH;AACJ,KA7CoD,CA+CrD;;;AACA,QAAIyC,KAAK,CAACzB,cAAN,CAAqB,QAArB,CAAJ,EAAoC;AAChC,WAAK,IAAI4D,GAAT,IAAgBnC,KAAK,CAACoC,MAAtB,EAA8B;AAC1B,YAAIpC,KAAK,CAACoC,MAAN,CAAa7D,cAAb,CAA4B4D,GAA5B,CAAJ,EAAsC;AAClC,cAAIE,KAAK,GAAGF,GAAG,CAACG,MAAJ,CAAW,CAAX,EAAcC,WAAd,KAA8BJ,GAAG,CAACK,KAAJ,CAAU,CAAV,CAA1C;AACA,cAAIJ,MAAM,GAAGpC,KAAK,CAACoC,MAAN,CAAaD,GAAb,CAAb;;AACA,cAAIC,MAAM,CAAC7D,cAAP,CAAsB,OAAtB,KAAkC6D,MAAM,CAACT,KAAP,CAAapD,cAAb,CAA4B,MAA5B,CAAtC,EAA2E;AACvEmC,YAAAA,EAAE,CAACV,KAAH,CAAS,WAAWqC,KAApB,IAA6B,gBAAgB5E,SAAS,CAAC2E,MAAM,CAACT,KAAP,CAAapE,IAAd,CAAtD;AACH,WAFD,MAGK;AACD;AACAmD,YAAAA,EAAE,CAACV,KAAH,CAAS,WAAWqC,KAApB,IAA6B,gBAA7B;AACH;AACJ;AACJ;AACJ;AACJ,GAjEsE,CAkEvE;;;AACA,MAAI1B,KAAK,IAAI,QAAOA,KAAP,MAAiB,QAA1B,IAAsCA,KAAK,CAACpC,cAAN,CAAqB,SAArB,CAA1C,EAA2E;AACvE,QAAIoC,KAAK,CAAC8B,MAAN,IAAgB9B,KAAK,CAAC8B,MAAN,CAAaC,KAAjC,EAAwC;AACpChC,MAAAA,EAAE,CAACiC,SAAH,GAAehC,KAAK,CAAC8B,MAAN,CAAaC,KAA5B;AACH,KAFD,MAGK;AACDhC,MAAAA,EAAE,CAACiC,SAAH,GAAehC,KAAK,CAAC8B,MAAN,KAAiBrB,SAAjB,GAA6BT,KAAK,CAAC8B,MAAnC,GAA4C,IAA3D;AACH;AACJ,GA1EsE,CA2EvE;;AACH,C,CAGD;;;AACA,SAASG,qBAAT,CAA+BC,YAA/B,EAA6CzI,IAA7C,EAAmD;AAC/C,MAAIA,IAAI,KAAK,MAAb,EACIG,CAAC,CAAC,UAAD,CAAD,CAAc0D,IAAd,CAAmB,EAAnB;AACJ1D,EAAAA,CAAC,CAAC,iBAAD,CAAD,CAAqB0D,IAArB,CAA0B,EAA1B,EAH+C,CAI/C;;AACA,OAAK,IAAIzC,OAAT,IAAoBqH,YAApB,EAAkC;AAC9B,QAAIA,YAAY,CAACtE,cAAb,CAA4B/C,OAA5B,CAAJ,EAA0C;AACtC,UAAIgD,EAAE,GAAGqE,YAAY,CAACrH,OAAD,CAArB;AACAb,MAAAA,UAAU,CAACoC,IAAX,CAAgByB,EAAE,CAACC,IAAnB;AACA,UAAIrD,IAAI,GAAGoD,EAAE,CAACpD,IAAd;AACA,UAAI8B,MAAM,GAAGwB,MAAM,CAACF,EAAE,CAACC,IAAJ,EAAU,MAAV,CAAnB,CAJsC,CAMtC;;AACA,UAAIvD,SAAS,GAAG4H,QAAQ,CAACC,cAAT,CAAwB7F,MAAxB,CAAhB;AACA,UAAI8F,UAAU,GAAGC,cAAc,CAAC/H,SAAD,EAAYX,CAAC,CAACC,MAAD,CAAD,CAAUF,MAAV,KAAqB,GAAjC,EAAsC,KAAtC,CAA/B;AACA0I,MAAAA,UAAU,CAACE,QAAX,CAAoB9H,IAApB,EATsC,CAUtC;;AACA4H,MAAAA,UAAU,CAACG,cAAX,CAA0B;AACtB1H,QAAAA,KAAK,EAAE,eAAUqD,GAAV,EAAeE,GAAf,EAAoB;AACvB,cAAIQ,cAAc,GAAG,EAArB;;AACA,cAAIV,GAAG,KAAK,CAAR,IAAaE,GAAG,KAAK,CAAzB,EAA4B;AACxBQ,YAAAA,cAAc,CAAC4D,QAAf,GAA0B,IAA1B;AACH;;AACD,iBAAO5D,cAAP;AACH;AAPqB,OAA1B;AASH;AACJ;;AACDM,EAAAA,OAAO,CAACC,GAAR,CAAYzB,MAAZ;AACA/D,EAAAA,CAAC,CAAC,wBAAD,CAAD,CAA4B4F,GAA5B,CAAgC,MAAhC;AACH;;AAGD,SAASkD,WAAT,CAAqB/E,MAArB,EAA6B3D,UAA7B,EAAyC;AACrC;AACA,MAAI2I,QAAQ,GAAGC,IAAI,CAACC,KAAL,CAAWC,QAAX,EAAf;;AACA,OAAK,IAAI9F,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGW,MAAM,CAACV,MAA3B,EAAmCD,CAAC,EAApC,EAAwC;AACpC,QAAI+F,OAAO,GAAGpF,MAAM,CAACX,CAAD,CAAN,CAAU6C,OAAV,EAAd;AACA,QAAImD,SAAS,GAAGJ,IAAI,CAACC,KAAL,CAAWI,YAAX,CAAwBF,OAAxB,CAAhB,CAFoC,CAGpC;;AACAH,IAAAA,IAAI,CAACC,KAAL,CAAWK,iBAAX,CAA6BP,QAA7B,EAAuCK,SAAvC,EAAkDhJ,UAAU,CAACgD,CAAD,CAA5D;AACH;;AACD,SAAO2F,QAAP;AACH;;AAED,SAASQ,aAAT,CAAuBR,QAAvB,EAAiC7E,IAAjC,EAAuC;AACnC,MAAIsF,aAAa,GAAG,OAApB,CADmC,CAEnC;;AACA,MAAI,OAAOT,QAAP,KAAoB,WAAxB,EAAqC;AACjC,WAAOC,IAAI,CAACS,SAAL,CAAeX,WAAW,CAACY,GAAG,CAACrJ,MAAL,EAAaqJ,GAAG,CAACtJ,UAAjB,CAA1B,EAAwDsJ,GAAG,CAAC5J,YAAJ,GAAmB0J,aAA3E,CAAP;AACH,GAFD,MAGK;AACDR,IAAAA,IAAI,CAACS,SAAL,CAAeV,QAAf,EAAyB7E,IAAI,GAAGsF,aAAhC;AACH;AACJ,C,CAED;;;AACA,SAASG,eAAT,CAAyBlH,SAAzB,EAAoC8B,GAApC,EAAyCE,GAAzC,EAA8C;AAC1C,MAAI,CAACrE,UAAU,CAACwJ,QAAX,CAAoBnH,SAApB,CAAL,EAAqC;AACjC8C,IAAAA,OAAO,CAACC,GAAR,CAAY,6BAAZ;AACA;AACH;;AACD,MAAIqE,KAAK,GAAG9F,MAAM,CAAC3D,UAAU,CAAC0J,OAAX,CAAmBrH,SAAnB,CAAD,CAAlB;AACA,MAAI5B,IAAI,GAAGgJ,KAAK,CAACE,aAAN,CAAoBxF,GAApB,EAAyBE,GAAzB,CAAX;;AACA,MAAI,CAAC5D,IAAI,CAACmD,cAAL,CAAoB,SAApB,CAAL,EAAqC;AACjCuB,IAAAA,OAAO,CAACC,GAAR,CAAY,0DAAZ;AACA;AACH;;AAED,MAAIwE,UAAU,GAAGC,MAAM,CAACC,KAAP,CAAarJ,IAAI,CAACsJ,OAAlB,CAAjB;;AACA,MAAIH,UAAU,CAAC7B,KAAf,EAAsB;AAClBtH,IAAAA,IAAI,CAACqH,MAAL,GAAc8B,UAAd;AACH,GAFD,MAGK;AACDnJ,IAAAA,IAAI,CAACqH,MAAL,GAAc8B,UAAU,CAAC9B,MAAzB;AACH;;AAED2B,EAAAA,KAAK,CAACO,aAAN,CAAoB7F,GAApB,EAAyBE,GAAzB,EAA8B5D,IAA9B;AACA,SAAOA,IAAP;AACH","sourcesContent":["// Workbook GUI functions...\r\n\r\nconst SCALE = 8; // scale up the column width and row height\r\nlet global = {workbookData: {}};\r\n\r\nclass WorkbookGUI {\r\n    constructor(mode, workbookName, workbookData, height = $(window).height() - 360) {\r\n        this.height = height;\r\n        this.mode = mode; // can be 'view' or 'edit'\r\n        this.addSheetTab = $('<a id=\"add-sheet-btn\" class=\"nav-link nav-item\" href=\"#\"><i class=\"fas fa-plus\"></i> Add Sheet</a>');\r\n        this.workbookName = workbookName;\r\n        global.workbookData = workbookData;\r\n        this.currSheet = '';\r\n        this.sheetNames = [];\r\n        this.tables = [];\r\n        this.tabContents = [];\r\n        this.tabs = [];\r\n        this.tabCounter = 0;\r\n        this.gridIds = [];\r\n        this._appendAddSheetTab();\r\n    }\r\n\r\n    /**\r\n     * Initialize a styled table\r\n     * @param container\r\n     * @param height\r\n     * @param data\r\n     * @param rowHeights\r\n     * @param colWidths\r\n     * @param merges\r\n     */\r\n    addTable(container, width, height, data, rowHeights, colWidths, merges, sheetNo, cells) {\r\n        let prop = {};\r\n        if (typeof rowHeights === 'number') {\r\n            prop.rowHeights = rowHeights;\r\n            prop.colWidths = colWidths;\r\n        }\r\n        else {\r\n            prop.rowHeights = rowHeights.map(function (x) {\r\n                return Math.round(x * SCALE / 5.5385);\r\n            })\r\n            prop.colWidths = colWidths.map(function (x) {\r\n                return Math.round(x * SCALE);\r\n            })\r\n        }\r\n        var spec = {\r\n            data: data,\r\n            width: width,\r\n            height: height,\r\n            colWidths: prop.colWidths,\r\n            rowHeights: prop.rowHeights,\r\n            mergeCells: merges,\r\n            manualColumnResize: true,\r\n            manualRowResize: true,\r\n            manualColumnMove: false,\r\n            manualRowMove: false,\r\n            rowHeaders: true,\r\n            colHeaders: true,\r\n            autoWrapCol: false,\r\n            autoWrapRow: false,\r\n            autoRowSize: false,\r\n            autoColumnSize: false,\r\n            contextMenu: ['copy'],\r\n            renderAllRows: false,\r\n            cells: cells,\r\n        };\r\n\r\n        var createdTable = new Handsontable(container, spec);\r\n        this.tables.push(createdTable);\r\n        return createdTable;\r\n    }\r\n\r\n    /**\r\n     * Edit mode for create/edit workbook, View mode for user view the workbook\r\n     *\r\n     * @param sheetName\r\n     * @param mode can be either 'edit' or 'view'\r\n     * @param tabColor can be null\r\n     * @return string\r\n     */\r\n    addTab(sheetName, tabColor) {\r\n        var gridId = 'grid-' + this.tabCounter;\r\n        this.gridIds.push(gridId);\r\n        var tabContentId = 'tab-content-' + this.tabCounter;\r\n        var tabId = 'tab-' + this.tabCounter;\r\n\r\n        // add content\r\n        var tabContent = $('<div id=\"' + tabContentId + '\" class=\"tab-pane active show\"> <div id=\"' + gridId + '\"></div></div>');\r\n        this.tabContents.push(tabContent);\r\n\r\n        // add tab\r\n        var newTab;\r\n        // edit mode have edit button in tabs\r\n        if (this.mode === 'edit') {\r\n            newTab = $('<a id=\"' + tabId + '\" class=\"nav-item nav-link active show\" data-toggle=\"tab\" href=\"#' + tabContentId + '\"> ' + sheetName\r\n                + '<i onclick=\"editSheet(' + this.tabCounter + ')\" class=\"fas fa-pen ml-2\"></i></a>');\r\n        }\r\n        else {\r\n            newTab = $('<a class=\"nav-item nav-link active show\" data-toggle=\"tab\" href=\"#' + tabContentId + '\">' + sheetName + '</a>');\r\n        }\r\n        if (tabColor && tabColor.argb) {\r\n            newTab.css('border-bottom', '3px solid #' + argbToRgb(tabColor.argb));\r\n        }\r\n        this.tabs.push(newTab);\r\n\r\n        this.tabCounter++;\r\n        return gridId;\r\n    }\r\n\r\n    applyTabs() {\r\n        // deactivate previous tab and content\r\n        $('div.active.show').removeClass('active show');\r\n        $('a.active').removeClass('active show');\r\n        let i;\r\n        for (i = 0; i < this.tabContents.length; i++) {\r\n            $('#nav-tabContent').append(this.tabContents[i]);\r\n\r\n            if (this.mode === 'edit') {\r\n                this.tabs[i].insertBefore('#nav-tab a:nth-last-child(1)');\r\n            }\r\n            else {\r\n                $('#nav-tab').append(this.tabs[i]);\r\n            }\r\n        }\r\n        this.tabs = [];\r\n        this.tabContents = [];\r\n    }\r\n\r\n    _appendAddSheetTab() {\r\n        $('#nav-tab').append(this.addSheetTab);\r\n    }\r\n\r\n    setAddSheetCallback(cb) {\r\n        $('#add-sheet-btn').on('click', cb);\r\n    }\r\n\r\n    updateJson(workbookData) {\r\n        global.workbookData = workbookData;\r\n    }\r\n\r\n    load() {\r\n        this.tabCounter = 0;\r\n        // clear tables and tabs\r\n        $('#nav-tab').html('');\r\n        $('#nav-tabContent').html('');\r\n\r\n        if (this.mode === 'edit')\r\n            this._appendAddSheetTab();\r\n\r\n        this.applyJsonWithStyle();\r\n    }\r\n\r\n    // apply json to GUI tables\r\n    applyJsonWithStyle() {\r\n        var timerStart = Date.now();\r\n        // clear global variables\r\n        this.sheets = [];\r\n        this.sheetNames = [];\r\n\r\n        // load tabs\r\n        for (var sheetNo in global.workbookData) {\r\n            if (global.workbookData.hasOwnProperty(sheetNo)) {\r\n                var ws = global.workbookData[sheetNo];\r\n                this.sheetNames.push(ws.name);\r\n                const gridId = this.addTab(ws.name, ws.tabColor);\r\n                this.applyTabs();\r\n                let container = $('#' + gridId)[0];\r\n                let data = ws.data;\r\n\r\n                // transform mergeCells\r\n                var merges = [];\r\n                for (var position in ws.merges) {\r\n                    if (ws.merges.hasOwnProperty(position)) {\r\n                        var model = ws.merges[position].model;\r\n                        merges.push({\r\n                            row: model.top - 1,\r\n                            col: model.left - 1,\r\n                            rowspan: model.bottom - model.top + 1,\r\n                            colspan: model.right - model.left + 1\r\n                        })\r\n                    }\r\n                }\r\n                // generate table\r\n                // worksheet has no style\r\n                let table;\r\n                if (!ws.row) {\r\n                    table = this.addTable(container, $('#nav-tab').width(), this.height, data,\r\n                        23, 80, true, sheetNo, function (row, col) {\r\n                            let cellProperties = {};\r\n                            cellProperties.editor = FormulaEditor;\r\n                            cellProperties.renderer = cellRenderer;\r\n                            return cellProperties;\r\n                        });\r\n                }\r\n                else {\r\n                    table = this.addTable(container, $('#nav-tab').width(), this.height, data,\r\n                        ws.row.height, ws.col.width, merges, sheetNo, function (row, col) {\r\n                            if (!('sheetNo' in this.instance)) {\r\n                                this.instance.sheetNo = sheetNo;\r\n                                console.log('loading ' + sheetNo)\r\n                            }\r\n                            var ws = global.workbookData[this.instance.sheetNo];\r\n                            var cellProperties = {};\r\n                            cellProperties.style = null;\r\n                            if (ws.style.length > 0 && ws.style[row].length > col && ws.style[row][col] && Object.keys(ws.style[row][col]).length !== 0) {\r\n                                cellProperties.style = ws.style[row][col];\r\n                            }\r\n                            cellProperties.renderer = cellRenderer;\r\n                            cellProperties.editor = FormulaEditor;\r\n\r\n                            return cellProperties;\r\n                        });\r\n                }\r\n\r\n                table.sheetNo = sheetNo;\r\n            }\r\n        }\r\n\r\n        $('#nav-tab a:first-child').tab('show');\r\n        this.currSheet = this.sheetNames[0];\r\n        // add listener to tabs\r\n        $('.nav-tabs a').on('show.bs.tab', function (event) {\r\n            this.currSheet = $(event.target).text();         // active tab\r\n        });\r\n        console.log(\"Time consumed: \", Date.now() - timerStart + 'ms');\r\n    }\r\n\r\n    getData() {\r\n        let cnt = 0;\r\n        for (let sheetNo in global.workbookData) {\r\n            if (global.workbookData.hasOwnProperty(sheetNo)) {\r\n                let ws = global.workbookData[sheetNo];\r\n                ws.name = this.sheetNames[cnt];\r\n                ws.data = this.tables[cnt].getData();\r\n            }\r\n            cnt++;\r\n        }\r\n        return global.workbookData;\r\n    }\r\n\r\n    addSheet(sheetName, data) {\r\n        const sheetNo = this.sheetNames.length;\r\n        global.workbookData[sheetNo] = {name: sheetName, data: data};\r\n        this.sheetNames.push(sheetName);\r\n        const gridId = this.addTab(sheetName);\r\n        this.applyTabs();\r\n        let container = $('#' + gridId)[0];\r\n        let table = this.addTable(container, $('#nav-tab').width(), this.height, data,\r\n            23, 80, true, sheetNo, function (row, col) {\r\n                let cellProperties = {};\r\n                cellProperties.editor = FormulaEditor;\r\n                cellProperties.renderer = cellRenderer;\r\n                return cellProperties;\r\n            });\r\n        this.tables.push(table);\r\n\r\n        $('#nav-tab a:first-child').tab('show');\r\n        this.currSheet = this.sheetNames[0];\r\n        // add listener to tabs\r\n        $('.nav-tabs a').on('show.bs.tab', function (event) {\r\n            this.currSheet = $(event.target).text();         // active tab\r\n        });\r\n    }\r\n}\r\n\r\nfunction argbToRgb(argb) {\r\n    return argb.substring(2);\r\n}\r\n\r\nfunction cellRenderer(instance, td, row, col, prop, value, cellProperties) {\r\n    Handsontable.renderers.TextRenderer.apply(this, arguments);\r\n    if (('style' in cellProperties) && cellProperties.style) {\r\n        var style = cellProperties.style;\r\n        // alignment\r\n        var cellMeta = instance.getCellMeta(row, col);\r\n        var previousClass = (cellMeta.className !== undefined) ? cellMeta.className : '';\r\n\r\n        if (style.hasOwnProperty('alignment')) {\r\n            if (style.alignment.hasOwnProperty('horizontal')) {\r\n                td.style.textAlign = style.alignment.horizontal;\r\n            }\r\n            if (style.alignment.hasOwnProperty('vertical')) {\r\n\r\n                switch (style.alignment.vertical) {\r\n                    case 'top':\r\n                        instance.setCellMeta(row, col, 'className', previousClass + ' htTop');\r\n                        break;\r\n                    case 'middle':\r\n                        instance.setCellMeta(row, col, 'className', previousClass + ' htMiddle');\r\n                        break;\r\n                }\r\n            }\r\n        }\r\n        else {\r\n            // default bottom\r\n            instance.setCellMeta(row, col, 'className', previousClass + ' htBottom');\r\n        }\r\n\r\n        // font\r\n        if (style.hasOwnProperty('font')) {\r\n            if (style.font.hasOwnProperty('color') && style.font.color.hasOwnProperty('argb')) {\r\n                td.style.color = '#' + argbToRgb(style.font.color.argb);\r\n            }\r\n            if (style.font.hasOwnProperty('bold') && style.font.bold) {\r\n                td.style.fontWeight = 'bold';\r\n            }\r\n            if (style.font.hasOwnProperty('italic') && style.font.italic) {\r\n                td.style.fontStyle = 'italic';\r\n            }\r\n        }\r\n\r\n        // background\r\n        if (style.hasOwnProperty('fill')) {\r\n            if (style.fill.hasOwnProperty('fgColor') && style.fill.fgColor.hasOwnProperty('argb')) {\r\n                td.style.background = '#' + argbToRgb(style.fill.fgColor.argb);\r\n            }\r\n        }\r\n\r\n        // borders\r\n        if (style.hasOwnProperty('border')) {\r\n            for (var key in style.border) {\r\n                if (style.border.hasOwnProperty(key)) {\r\n                    var upper = key.charAt(0).toUpperCase() + key.slice(1);\r\n                    var border = style.border[key];\r\n                    if (border.hasOwnProperty('color') && border.color.hasOwnProperty('argb')) {\r\n                        td.style['border' + upper] = '1px solid #' + argbToRgb(border.color.argb);\r\n                    }\r\n                    else {\r\n                        // black color\r\n                        td.style['border' + upper] = '1px solid #000';\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    }\r\n    // render formula\r\n    if (value && typeof value === 'object' && value.hasOwnProperty('formula')) {\r\n        if (value.result && value.result.error) {\r\n            td.innerHTML = value.result.error;\r\n        }\r\n        else {\r\n            td.innerHTML = value.result !== undefined ? value.result : null;\r\n        }\r\n    }\r\n    // render dropdown\r\n}\r\n\r\n\r\n// apply json to GUI tables\r\nfunction applyJsonWithoutStyle(workBookJson, mode) {\r\n    if (mode !== 'edit')\r\n        $('#nav-tab').html('');\r\n    $('#nav-tabContent').html('');\r\n    // load to front-end\r\n    for (var sheetNo in workBookJson) {\r\n        if (workBookJson.hasOwnProperty(sheetNo)) {\r\n            var ws = workBookJson[sheetNo];\r\n            sheetNames.push(ws.name);\r\n            var data = ws.data;\r\n            var gridId = addTab(ws.name, 'edit');\r\n\r\n            // generate table\r\n            var container = document.getElementById(gridId);\r\n            var addedTable = newSimpleTable(container, $(window).height() - 500, false);\r\n            addedTable.loadData(data);\r\n            // lock cells\r\n            addedTable.updateSettings({\r\n                cells: function (row, col) {\r\n                    var cellProperties = {};\r\n                    if (row === 0 || col === 0) {\r\n                        cellProperties.readOnly = true;\r\n                    }\r\n                    return cellProperties;\r\n                }\r\n            });\r\n        }\r\n    }\r\n    console.log(sheets);\r\n    $('#nav-tab a:first-child').tab('show');\r\n}\r\n\r\n\r\nfunction getWorkbook(sheets, sheetNames) {\r\n    // create a workbook\r\n    var workbook = XLSX.utils.book_new();\r\n    for (var i = 0; i < sheets.length; i++) {\r\n        var ws_data = sheets[i].getData();\r\n        var worksheet = XLSX.utils.aoa_to_sheet(ws_data);\r\n        // Add the worksheet to the workbook\r\n        XLSX.utils.book_append_sheet(workbook, worksheet, sheetNames[i]);\r\n    }\r\n    return workbook;\r\n}\r\n\r\nfunction exportToExcel(workbook, name) {\r\n    var fileExtension = '.xlsx';\r\n    // empty params\r\n    if (typeof workbook === 'undefined') {\r\n        return XLSX.writeFile(getWorkbook(gui.tables, gui.sheetNames), gui.workbookName + fileExtension);\r\n    }\r\n    else {\r\n        XLSX.writeFile(workbook, name + fileExtension);\r\n    }\r\n}\r\n\r\n// re-evaluate formula\r\nfunction evaluateFormula(sheetName, row, col) {\r\n    if (!sheetNames.includes(sheetName)) {\r\n        console.log('Error: sheetName not found.');\r\n        return\r\n    }\r\n    var sheet = sheets[sheetNames.indexOf(sheetName)];\r\n    var data = sheet.getDataAtCell(row, col);\r\n    if (!data.hasOwnProperty('formula')) {\r\n        console.log('Error: evaluateFormula(): cell provided is not a formula');\r\n        return\r\n    }\r\n\r\n    var calculated = parser.parse(data.formula);\r\n    if (calculated.error) {\r\n        data.result = calculated;\r\n    }\r\n    else {\r\n        data.result = calculated.result;\r\n    }\r\n\r\n    sheet.setDataAtCell(row, col, data);\r\n    return data;\r\n}\r\n"],"file":"workbook-gui.js"}