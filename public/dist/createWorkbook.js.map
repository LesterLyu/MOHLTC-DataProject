{"version":3,"sources":["../moh.js/createWorkbook.js"],"names":["mode","state","modalMode","workbookData","gui","showModalAlert","title","msg","$","find","html","end","modal","unzip","binary","JSON","parse","pako","inflate","to","zip","string","deflate","updateLoadingStatus","text","console","log","hideLoadingStatus","hide","document","ready","selectAttributes","selectCategories","ajax","url","type","done","response","success","each","attributes","i","item","append","id","attribute","value","selectpicker","fail","xhr","status","error","responseJSON","message","categories","category","workbookName","val","encodeURIComponent","start","Date","extra","workbook","undefined","data","WorkbookGUI","window","height","setAddSheetCallback","addSheet","load","prop","editSheet","index","modelDisplayIndex","selecte_categories","selecte_attributes","sheetNames","tables","getData","slice","splice","indexOf","attrs","cates","length","push","backdrop","getSelected","selected_categories","selected_attributes","att_id","att","substring","concat","cat_id","cat","Array","join","split","on","click","change","e","files","target","f","formData","FormData","name","cache","contentType","processData","updateJson","open","container","getElementById","previewTable","newSimpleTable","loadData","updateSettings","cells","row","col","cellProperties","readOnly","sheetName","btn","statusText","stringify","oldName"],"mappings":"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","sourcesContent":["var mode;\r\nvar state = {\r\n    modalMode: 'none' // none, add, edit\r\n}; // store state\r\nvar workbookData;\r\nlet gui;\r\n\r\nfunction showModalAlert(title, msg) {\r\n    $('#msg-modal').find('h5').html(title).end().find('p').html(msg).end().modal('show');\r\n}\r\n\r\nfunction unzip(binary) {\r\n    return JSON.parse(pako.inflate(binary, {to: 'string'}));\r\n}\r\n\r\nfunction zip(string) {\r\n    return pako.deflate(string, {to: 'string'});\r\n}\r\n\r\n// does not work when loading tables...\r\nfunction updateLoadingStatus(text) {\r\n    console.log('Loading... (' + text + ')');\r\n    $('#loadingText').html('Loading... (' + text + ')')\r\n}\r\n\r\nfunction hideLoadingStatus() {\r\n    $('#loading').hide();\r\n}\r\n\r\n$(document).ready(function () {\r\n\r\n    // get attributes and categories.\r\n    var selectAttributes = $('#select-attributes');\r\n    var selectCategories = $('#select-categories');\r\n    $.ajax({\r\n        url: '/api/attributes',\r\n        type: 'GET',\r\n    }).done(function (response) {\r\n        if (response.success) {\r\n            $.each(response.attributes, function (i, item) {\r\n                selectAttributes.append($('<option>', {\r\n                    text: '#' + item.id + '  ' + item.attribute,\r\n                    value: item.id + ',' + item.attribute,\r\n                }));\r\n            });\r\n\r\n            selectAttributes.selectpicker('refresh');\r\n        }\r\n    }).fail(function (xhr, status, error) {\r\n        console.log('fail ' + xhr.responseJSON.message);\r\n    });\r\n\r\n    $.ajax({\r\n        url: '/api/categories',\r\n        type: 'GET',\r\n    }).done(function (response) {\r\n        if (response.success) {\r\n            $.each(response.categories, function (i, item) {\r\n                selectCategories.append($('<option>', {\r\n                    text: '#' + item.id + '  ' + item.category,\r\n                    value: item.id + ',' + item.category,\r\n                }));\r\n            });\r\n\r\n            selectCategories.selectpicker('refresh');\r\n        }\r\n    }).fail(function (xhr, status, error) {\r\n        console.log('fail ' + xhr.responseJSON.message);\r\n        //showErrorAlert(xhr.responseJSON.message);\r\n    });\r\n\r\n    // if this page is loaded for edit workbook\r\n    const workbookName = $('#workbookNameInput').val();\r\n    mode = $('#mode').val();\r\n    if (mode === 'edit') {\r\n\r\n        // default url is for fill the workbook first time\r\n        var url = '/api/workbook/' + encodeURIComponent(workbookName);\r\n\r\n        $.ajax({\r\n            url: url,\r\n            type: 'GET',\r\n        }).done(function (response) {\r\n            console.log(response);\r\n            if (response.success) {\r\n                let start = new Date();\r\n                const extra = (response.workbook.extra === undefined ? null: unzip(response.workbook.extra));\r\n                const data = response.workbook.data;\r\n                console.log('unzipping takes: ' + (new Date() - start) + 'ms');\r\n                gui = new WorkbookGUI('edit', workbookName, data, extra, $(window).height() - 350);\r\n                gui.setAddSheetCallback(addSheet);\r\n                gui.load();\r\n\r\n                $('#loading').hide();\r\n            }\r\n        }).fail(function (xhr, status, error) {\r\n            console.log('fail ' + xhr.responseJSON.message);\r\n            //showErrorAlert(xhr.responseJSON.message);\r\n            $('#loading').hide();\r\n        });\r\n    }\r\n    // add mode\r\n    else {\r\n        console.log('add mode');\r\n        $('#import-workbook-btn').prop('disabled', true);\r\n        gui = new WorkbookGUI('edit', workbookName, {}, $(window).height() - 350);\r\n        gui.setAddSheetCallback(addSheet);\r\n\r\n    }\r\n\r\n});\r\n\r\nfunction editSheet(index) {\r\n    state.modalMode = 'edit';\r\n    state.modelDisplayIndex = index;\r\n    var selecte_categories = $('#select-categories');\r\n    var selecte_attributes = $('#select-attributes');\r\n    selecte_categories.selectpicker('deselectAll');\r\n    selecte_attributes.selectpicker('deselectAll');\r\n    $('#sheetNameInput').val(gui.sheetNames[index]);\r\n\r\n\r\n    // get categories and attributes\r\n    var data = gui.tables[index].getData().slice();\r\n    // console.log(data);\r\n    data[0].splice(data[0].indexOf(''), 1);\r\n    var attrs = data[0];\r\n    var cates = [];\r\n    for (var i = 1; i < data.length; i++) {\r\n        if (data[i][0] !== '') cates.push(data[i][0])\r\n    }\r\n\r\n    console.log(attrs, cates);\r\n    selecte_categories.selectpicker('val', cates);\r\n    selecte_attributes.selectpicker('val', attrs);\r\n    $('#add-confirm-btn').html('Modify');\r\n    $('#add-modal').modal({backdrop: 'static'});\r\n}\r\n\r\n\r\n\r\n// get the selected att and cat\r\nfunction getSelected() {\r\n    var selected_categories = $('#select-categories').val();\r\n    var selected_attributes = $('#select-attributes').val();\r\n    var data = [];\r\n    var att_id = [], att = [], i;\r\n    // add first two rows\r\n    for (i = 0; i < selected_attributes.length; i++) {\r\n        att_id.push(selected_attributes[i].substring(0, selected_attributes[i].indexOf(',')))\r\n        att.push(selected_attributes[i].substring(1 + selected_attributes[i].indexOf(',')))\r\n    }\r\n    data.push(['', ''].concat(att_id));\r\n    data.push(['', ''].concat(att));\r\n\r\n    // add columns\r\n    for (i = 0; i < selected_categories.length; i++) {\r\n        var cat_id = selected_categories[i].substring(0, selected_categories[i].indexOf(','));\r\n        var cat = selected_categories[i].substring(1 + selected_categories[i].indexOf(','))\r\n        data.push([cat_id, cat].concat(\r\n            Array(selected_attributes.length).join('.').split('.')));\r\n    }\r\n    return data;\r\n}\r\n\r\n$('#import-workbook-btn').on('click', function () {\r\n    $('#file-import').click();\r\n});\r\n\r\n$('#file-import').change(function (e) {\r\n\r\n    var files = e.target.files, f = files[0];\r\n    var formData = new FormData();\r\n    formData.append('excel', f);\r\n\r\n    $.ajax({\r\n        url: '/api/upload/style/' + encodeURIComponent($('#workbookNameInput').val()) + '/' + encodeURIComponent(f.name),\r\n        type: 'POST',\r\n        data: formData,\r\n        cache: false,\r\n        contentType: false,\r\n        processData: false\r\n    }).done(function (response) {\r\n        if (response.success) {\r\n            const extra = unzip(response.workbook.extra);\r\n            const data = response.workbook.data;\r\n            console.log(data);\r\n            gui.updateJson(data, extra);\r\n            gui.load();\r\n        }\r\n    }).fail(function (xhr, status, error) {\r\n        console.log('fail ' + xhr.responseJSON.message);\r\n\r\n    });\r\n\r\n});\r\n\r\n$('#export-workbook-btn').on('click', function () {\r\n    // if (!gui.workbookName)\r\n    //     gui.workbookName = 'workbook1';\r\n    // exportToExcel();\r\n    window.open('/api/admin/workbook/' + encodeURIComponent($('#workbookNameInput').val()) + '/download')\r\n\r\n});\r\n\r\n// add sheet modal\r\nfunction addSheet() {\r\n    state.modalMode = 'add';\r\n    $('#sheetNameInput').val('');\r\n    $('#select-categories').selectpicker('deselectAll');\r\n    $('#select-attributes').selectpicker('deselectAll');\r\n    $('#add-confirm-btn').html('Add');\r\n    $('#add-modal').modal({backdrop: 'static'});\r\n}\r\n\r\n// preview the sheet in the modal\r\n$('#preview-btn').click(function () {\r\n    showModalAlert('Error', 'Not yet implemented');\r\n    return;\r\n    $('#preview-grid').html('');\r\n    var container = document.getElementById('preview-grid');\r\n    var previewTable = newSimpleTable(container, 300, true);\r\n    previewTable.loadData(getSelected());\r\n    // lock all cells\r\n    previewTable.updateSettings({\r\n        cells: function (row, col) {\r\n            var cellProperties = {};\r\n            cellProperties.readOnly = true;\r\n            return cellProperties;\r\n        }\r\n    });\r\n});\r\n\r\n// confirm to add sheet to the workbook\r\n// TO-DO check inputs, i.e. duplicates, empty name/row/column...\r\n$(\"#add-confirm-btn\").click(function () {\r\n    var sheetName = $('#sheetNameInput').val();\r\n    if (state.modalMode === 'add') {\r\n        gui.addSheet(sheetName, getSelected());\r\n        console.log(getSelected())\r\n    }\r\n    else if (state.modalMode === 'edit') {\r\n        $('#add-modal').modal('hide');\r\n        showModalAlert('Error', 'Not yet implemented');\r\n        return;\r\n        gui.sheetNames[state.modelDisplayIndex] = sheetName;\r\n        $('#tab-' + state.modelDisplayIndex).html(sheetName\r\n            + '<i onclick=\"editSheet(' + state.modelDisplayIndex + ')\" class=\"fas fa-pen ml-2\"></i>');\r\n        gui.tables[state.modelDisplayIndex].loadData(getSelected());\r\n    }\r\n    $('#add-modal').modal('hide');\r\n});\r\n\r\n$('#save-workbook-btn').on('click', function () {\r\n\r\n    var btn = $(this);\r\n    var statusText = $('#status');\r\n    statusText.html('<i class=\"fas fa-spinner fa-spin\"></i> Saving');\r\n    btn.prop('disabled', true);\r\n    const data = gui.getData();\r\n\r\n    $.ajax({\r\n        url: '/api/admin/workbook',\r\n        type: (mode === 'edit' ? 'PUT' : 'POST'),\r\n        contentType: 'application/json',\r\n        data: JSON.stringify({data: data, oldName: $('#workbookOldName').val(),name: $('#workbookNameInput').val()}),\r\n    }).done(function (response) {\r\n        if (response.success) {\r\n            // enable import style button once saved\r\n            if (mode !== 'edit') {\r\n                $('#import-workbook-btn').prop('disabled', false);\r\n            }\r\n            statusText.html('<i class=\"fas fa-check\"></i> Saved');\r\n            btn.prop('disabled', false);\r\n        }\r\n    }).fail(function (xhr, status, error) {\r\n        console.log('fail ' + xhr.responseJSON.message);\r\n        statusText.html('<i class=\"fas fa-times\"></i> Failed to create workbook: ' + xhr.responseJSON.message);\r\n        btn.prop('disabled', false);\r\n    });\r\n});\r\n\r\n// edit\r\n\r\n"],"file":"createWorkbook.js"}