{"version":3,"sources":["../../moh.js/handsontable/workbook-gui.js"],"names":["SCALE","global","workbookData","dataValidation","WorkbookGUI","mode","workbookName","height","$","window","addSheetTab","currSheet","sheetNames","tables","tabContents","tabs","tabCounter","gridIds","definedNames","_appendAddSheetTab","container","width","data","rowHeights","colWidths","merges","sheetNo","cells","prop","map","x","Math","round","spec","mergeCells","manualColumnResize","manualRowResize","manualColumnMove","manualRowMove","rowHeaders","colHeaders","autoWrapCol","autoWrapRow","autoRowSize","autoColumnSize","contextMenu","renderAllRows","that","createdTable","Handsontable","push","sheetName","tabColor","gridId","tabContentId","tabId","tabContent","newTab","argb","css","argbToRgb","removeClass","i","length","append","insertBefore","cb","on","html","applyJsonWithStyle","timerStart","Date","now","sheets","name","hasOwnProperty","ws","addTab","applyTabs","position","model","row","top","col","left","rowspan","bottom","colspan","right","dropDownAddresses","dropDownData","key","dataValidations","type","console","error","addresses","split","addressSplited","decoded","colCache","decode","encode","formulae","indexOf","slice","dataTrimmed","trim","parsed","parser","parse","result","newArr","concat","getDefinedName","addTable","cellProperties","editor","FormulaEditor","renderer","cellRenderer","table","instance","log","address","includes","source","renderers","AutocompleteRenderer","editors","DropdownEditor","validator","validators","AutocompleteValidator","allowInvalid","style","Object","keys","tab","hideLoadingStatus","event","target","text","cnt","getData","sheet","definedName","currName","cell","getSheet","substring","td","value","TextRenderer","apply","arguments","cellMeta","getCellMeta","previousClass","className","undefined","alignment","textAlign","horizontal","vertical","setCellMeta","font","color","bold","fontWeight","italic","fontStyle","fill","fgColor","background","border","upper","charAt","toUpperCase","innerHTML","getWorkbook","workbook","XLSX","utils","book_new","ws_data","worksheet","aoa_to_sheet","book_append_sheet","exportToExcel","fileExtension","writeFile","gui","evaluateFormula","getDataAtCell","calculated","formula","setDataAtCell"],"mappings":"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","sourcesContent":["// Workbook GUI functions...\r\n\r\nconst SCALE = 8; // scale up the column width and row height\r\nlet global = {workbookData: {}, dataValidation: {}};\r\n\r\nclass WorkbookGUI {\r\n    constructor(mode, workbookName, workbookData, height = $(window).height() - 360) {\r\n        this.height = height;\r\n        this.mode = mode; // can be 'view' or 'edit'\r\n        this.addSheetTab = $('<a id=\"add-sheet-btn\" class=\"nav-link nav-item\" href=\"#\"><i class=\"fas fa-plus\"></i> Add Sheet</a>');\r\n        this.workbookName = workbookName;\r\n        global.workbookData = workbookData;\r\n        this.currSheet = '';\r\n        this.sheetNames = [];\r\n        this.tables = [];\r\n        this.tabContents = [];\r\n        this.tabs = [];\r\n        this.tabCounter = 0;\r\n        this.gridIds = [];\r\n        this.definedNames = {};\r\n\r\n        this._appendAddSheetTab();\r\n    }\r\n\r\n    /**\r\n     * Initialize a styled table\r\n     * @param container\r\n     * @param width\r\n     * @param height\r\n     * @param data\r\n     * @param rowHeights\r\n     * @param colWidths\r\n     * @param merges\r\n     * @param sheetNo\r\n     * @param cells\r\n     */\r\n    addTable(container, width, height, data, rowHeights, colWidths, merges, sheetNo, cells) {\r\n        let prop = {};\r\n        if (typeof rowHeights === 'number') {\r\n            prop.rowHeights = rowHeights;\r\n            prop.colWidths = colWidths;\r\n        }\r\n        else {\r\n            prop.rowHeights = rowHeights.map(function (x) {\r\n                return Math.round(x * SCALE / 5.5385);\r\n            });\r\n            prop.colWidths = colWidths.map(function (x) {\r\n                return Math.round(x * SCALE);\r\n            });\r\n        }\r\n        var spec = {\r\n            data: data,\r\n            width: width,\r\n            height: height,\r\n            colWidths: prop.colWidths,\r\n            rowHeights: prop.rowHeights,\r\n            mergeCells: merges,\r\n            manualColumnResize: true,\r\n            manualRowResize: true,\r\n            manualColumnMove: false,\r\n            manualRowMove: false,\r\n            rowHeaders: true,\r\n            colHeaders: true,\r\n            autoWrapCol: false,\r\n            autoWrapRow: false,\r\n            autoRowSize: false,\r\n            autoColumnSize: false,\r\n            contextMenu: ['copy'],\r\n            renderAllRows: false,\r\n            cells: cells,\r\n        };\r\n        const that = this;\r\n        let createdTable = new Handsontable(container, spec);\r\n        createdTable.sheetNo = sheetNo;\r\n        that.tables.push(createdTable);\r\n        return createdTable;\r\n    }\r\n\r\n    /**\r\n     * Edit mode for create/edit workbook, View mode for user view the workbook\r\n     *\r\n     * @param sheetName\r\n     * @param mode can be either 'edit' or 'view'\r\n     * @param tabColor can be null\r\n     * @return string\r\n     */\r\n    addTab(sheetName, tabColor) {\r\n        var gridId = 'grid-' + this.tabCounter;\r\n        this.gridIds.push(gridId);\r\n        var tabContentId = 'tab-content-' + this.tabCounter;\r\n        var tabId = 'tab-' + this.tabCounter;\r\n\r\n        // add content\r\n        var tabContent = $('<div id=\"' + tabContentId + '\" class=\"tab-pane active show\"> <div id=\"' + gridId + '\"></div></div>');\r\n        this.tabContents.push(tabContent);\r\n\r\n        // add tab\r\n        var newTab;\r\n        // edit mode have edit button in tabs\r\n        if (this.mode === 'edit') {\r\n            newTab = $('<a id=\"' + tabId + '\" class=\"nav-item nav-link active show\" data-toggle=\"tab\" href=\"#' + tabContentId + '\"> ' + sheetName\r\n                + '<i onclick=\"editSheet(' + this.tabCounter + ')\" class=\"fas fa-pen ml-2\"></i></a>');\r\n        }\r\n        else {\r\n            newTab = $('<a class=\"nav-item nav-link active show\" data-toggle=\"tab\" href=\"#' + tabContentId + '\">' + sheetName + '</a>');\r\n        }\r\n        if (tabColor && tabColor.argb) {\r\n            newTab.css('border-bottom', '3px solid #' + argbToRgb(tabColor.argb));\r\n        }\r\n        this.tabs.push(newTab);\r\n\r\n        this.tabCounter++;\r\n        return gridId;\r\n    }\r\n\r\n    applyTabs() {\r\n        // deactivate previous tab and content\r\n        $('div.active.show').removeClass('active show');\r\n        $('a.active').removeClass('active show');\r\n        let i;\r\n        for (i = 0; i < this.tabContents.length; i++) {\r\n            $('#nav-tabContent').append(this.tabContents[i]);\r\n\r\n            if (this.mode === 'edit') {\r\n                this.tabs[i].insertBefore('#nav-tab a:nth-last-child(1)');\r\n            }\r\n            else {\r\n                $('#nav-tab').append(this.tabs[i]);\r\n            }\r\n        }\r\n        this.tabs = [];\r\n        this.tabContents = [];\r\n    }\r\n\r\n    _appendAddSheetTab() {\r\n        $('#nav-tab').append(this.addSheetTab);\r\n    }\r\n\r\n    setAddSheetCallback(cb) {\r\n        $('#add-sheet-btn').on('click', cb);\r\n    }\r\n\r\n    updateJson(workbookData) {\r\n        global.workbookData = workbookData;\r\n        this.sheetNames = [];\r\n        this.tables = [];\r\n        this.tabContents = [];\r\n        this.tabs = [];\r\n        this.tabCounter = 0;\r\n        this.gridIds = [];\r\n    }\r\n\r\n    load() {\r\n        this.tabCounter = 0;\r\n        // clear tables and tabs\r\n        $('#nav-tab').html('');\r\n        $('#nav-tabContent').html('');\r\n\r\n        if (this.mode === 'edit')\r\n            this._appendAddSheetTab();\r\n\r\n        this.applyJsonWithStyle();\r\n    }\r\n\r\n    // apply json to GUI tables\r\n    applyJsonWithStyle() {\r\n        var timerStart = Date.now();\r\n        // clear global variables\r\n        this.tables = [];\r\n        this.sheetNames = [];\r\n\r\n        // load tabs\r\n        const sheets = global.workbookData.sheets;\r\n        // push sheet names first, since we need it now to call getSheet()\r\n        for (var sheetNo in sheets) {\r\n            this.sheetNames.push(sheets[sheetNo].name);\r\n        }\r\n        this.currSheet = this.sheetNames[0];\r\n\r\n        for (var sheetNo in sheets) {\r\n            if (sheets.hasOwnProperty(sheetNo)) {\r\n                var ws = sheets[sheetNo];\r\n                const gridId = this.addTab(ws.name, ws.tabColor);\r\n                this.applyTabs();\r\n                let container = $('#' + gridId)[0];\r\n                let data = ws.data;\r\n\r\n                // transform mergeCells\r\n                var merges = [];\r\n                for (var position in ws.merges) {\r\n                    if (ws.merges.hasOwnProperty(position)) {\r\n                        var model = ws.merges[position].model;\r\n                        merges.push({\r\n                            row: model.top - 1,\r\n                            col: model.left - 1,\r\n                            rowspan: model.bottom - model.top + 1,\r\n                            colspan: model.right - model.left + 1\r\n                        })\r\n                    }\r\n                }\r\n\r\n                // process data validation\r\n                global.dataValidation[sheetNo] = {\r\n                    dropDownAddresses: [],\r\n                    dropDownData: {}\r\n                };\r\n                for (let key in ws.dataValidations) {\r\n                    if (ws.dataValidations.hasOwnProperty(key)) {\r\n                        const dataValidation = ws.dataValidations[key];\r\n                        if (dataValidation.type !== 'list') {\r\n                            console.error('Unsupported data validation type: ' + dataValidation.type);\r\n                            continue;\r\n                        }\r\n                        const addresses = key.split(' ');\r\n                        let addressSplited = [];\r\n                        for (let i = 0; i < addresses.length; i++) {\r\n                            //  {top: 1, left: 1, bottom: 5, right: 1, tl: \"A1\", …}\r\n                            const decoded = colCache.decode(addresses[i]);\r\n                            if ('top' in decoded) {\r\n                                for (let row = decoded.top; row < decoded.bottom + 1; row++) {\r\n                                    for (let col = decoded.left; col < decoded.right + 1; col++) {\r\n                                        addressSplited.push(colCache.encode(row, col));\r\n                                    }\r\n                                }\r\n                            }\r\n                            // {address: \"A1\", col: 1, row: 1, $col$row: \"$A$1\"}\r\n                            else if ('row' in decoded) {\r\n                                addressSplited.push(addresses[i]);\r\n                            }\r\n                        }\r\n\r\n                        for (let i = 0; i < addressSplited.length; i++) {\r\n                            global.dataValidation[sheetNo].dropDownAddresses.push(addressSplited[i]);\r\n\r\n                            // get data\r\n                            // situation 1: e.g. formulae: [\"\"1,2,3,4\"\"]\r\n                            const formulae = dataValidation.formulae[0];\r\n                            if (formulae.indexOf(',') > 0) {\r\n                                let data = formulae.slice(1, formulae.length - 1).split(',');\r\n                                const dataTrimmed = data.map(x => x.trim());\r\n                                global.dataValidation[sheetNo].dropDownData[addressSplited[i]] = dataTrimmed;\r\n                            }\r\n                            // situation 2: e.g. formulae: [\"$B$5:$K$5\"]\r\n                            else if (formulae.indexOf(':') > 0) {\r\n                                const parsed = parser.parse(formulae).result;\r\n                                // concat 2d array to 1d array\r\n                                let newArr = [];\r\n                                for (let i = 0; i < parsed.length; i++) {\r\n                                    newArr = newArr.concat(parsed[i]);\r\n                                }\r\n                                global.dataValidation[sheetNo].dropDownData[addressSplited[i]] = newArr;\r\n                            }\r\n                            // situation 3: e.g. formulae: [\"definedName\"]\r\n                            else if (formulae in global.workbookData.definedNames) {\r\n                                global.dataValidation[sheetNo].dropDownData[addressSplited[i]] = this.getDefinedName(formulae);\r\n                            }\r\n                            else {\r\n                                console.error('Unknown dataValidation formulae situation: ' + formulae);\r\n                            }\r\n                        }\r\n                    }\r\n                }\r\n\r\n                // generate table\r\n                // worksheet has no style\r\n                if (!ws.row) {\r\n                    this.addTable(container, $('#nav-tab').width(), this.height, data,\r\n                        23, 80, true, sheetNo, function (row, col) {\r\n                            let cellProperties = {};\r\n                            cellProperties.editor = FormulaEditor;\r\n                            cellProperties.renderer = cellRenderer;\r\n                            return cellProperties;\r\n                        });\r\n                }\r\n                else {\r\n                    const table = this.addTable(container, $('#nav-tab').width(), this.height, data,\r\n                        ws.row.height, ws.col.width, merges, sheetNo, function (row, col) {\r\n                            let cellProperties = {};\r\n                            if (!('sheetNo' in this.instance)) {\r\n                                this.instance.sheetNo = sheetNo;\r\n                                console.log(sheetNo)\r\n                            }\r\n\r\n                            // dropdown\r\n                            // TO-DO move data validation to ws.style, this should improve the efficient\r\n                            const address = colCache.encode(row + 1, col + 1);\r\n                            const dataValidation = global.dataValidation[this.instance.sheetNo];\r\n                            if (dataValidation.dropDownAddresses.includes(address)) {\r\n                                cellProperties.source = dataValidation.dropDownData[address];\r\n                                cellProperties.renderer = Handsontable.renderers.AutocompleteRenderer;\r\n                                cellProperties.editor =  Handsontable.editors.DropdownEditor;\r\n                                cellProperties.validator = Handsontable.validators.AutocompleteValidator;\r\n                                cellProperties.allowInvalid = false;\r\n                                return cellProperties;\r\n                            }\r\n\r\n                            // text or formula\r\n                            var ws = global.workbookData.sheets[this.instance.sheetNo];\r\n\r\n                            cellProperties.style = null;\r\n                            if (ws.style.length > 0 && ws.style[row] && ws.style[row].length > col && ws.style[row][col] && Object.keys(ws.style[row][col]).length !== 0) {\r\n                                cellProperties.style = ws.style[row][col];\r\n                            }\r\n                            cellProperties.renderer = cellRenderer;\r\n                            cellProperties.editor = FormulaEditor;\r\n                            return cellProperties;\r\n                        });\r\n\r\n                }\r\n\r\n            }\r\n        }\r\n\r\n        $('#nav-tab a:first-child').tab('show');\r\n\r\n        hideLoadingStatus();\r\n        const that = this;\r\n        // setTimeout(function () {\r\n        //     that.tables[0].render();\r\n        //     hideLoadingStatus();\r\n        // }, 0);\r\n        // add listener to tabs\r\n        $('.nav-tabs a').on('show.bs.tab', function (event) {\r\n            that.currSheet = $(event.target).text();         // active tab\r\n            // if (!that.rendered[that.currSheet]) {\r\n            //     updateStatus('Rendering...');\r\n            //     setTimeout(function () {\r\n            //         const table = that.tables[that.sheetNames.indexOf(that.currSheet)];\r\n            //         table.render();\r\n            //         clearStatus();\r\n            //     }, 10);\r\n            //     that.rendered[that.currSheet] = true;\r\n            // }\r\n        });\r\n        console.log(\"Time consumed: \", Date.now() - timerStart + 'ms');\r\n    }\r\n\r\n    getData() {\r\n        let cnt = 0;\r\n\r\n        for (let sheetNo in global.workbookData.sheets) {\r\n            if (global.workbookData.sheets.hasOwnProperty(sheetNo)) {\r\n                let ws = global.workbookData.sheets[sheetNo];\r\n                ws.name = this.sheetNames[cnt];\r\n                ws.data = this.tables[cnt].getData();\r\n            }\r\n            cnt++;\r\n        }\r\n        return global.workbookData;\r\n    }\r\n\r\n    addSheet(sheetName, data) {\r\n        const sheetNo = this.sheetNames.length;\r\n        global.workbookData.sheets[sheetNo] = {name: sheetName, data: data};\r\n        this.sheetNames.push(sheetName);\r\n        const gridId = this.addTab(sheetName);\r\n        this.applyTabs();\r\n        let container = $('#' + gridId)[0];\r\n        let table = this.addTable(container, $('#nav-tab').width(), this.height, data,\r\n            23, 80, true, sheetNo, function (row, col) {\r\n                let cellProperties = {};\r\n                cellProperties.editor = FormulaEditor;\r\n                cellProperties.renderer = cellRenderer;\r\n                return cellProperties;\r\n            });\r\n        this.tables.push(table);\r\n\r\n        $('#nav-tab a:first-child').tab('show');\r\n        this.currSheet = this.sheetNames[0];\r\n        // add listener to tabs\r\n        $('.nav-tabs a').on('show.bs.tab', function (event) {\r\n            this.currSheet = $(event.target).text();         // active tab\r\n        });\r\n    }\r\n\r\n    getSheet(name) {\r\n        return global.workbookData.sheets[this.sheetNames.indexOf(name)];\r\n    }\r\n\r\n    getDataAtSheetAndCell(sheet, row, col) {\r\n        return global.workbookData.sheets[this.sheetNames.indexOf(sheet)].data[row][col];\r\n    }\r\n\r\n    getTable(name) {\r\n        return this.tables[this.sheetNames.indexOf(name)];\r\n    }\r\n\r\n    getDefinedName(definedName) {\r\n        const definedNames = global.workbookData.definedNames;\r\n        if (!(definedName in definedNames)) {\r\n            console.error('Cannot find defined name: ' + definedName);\r\n            return;\r\n        }\r\n        const currName = global.workbookData.definedNames[definedName];\r\n        let result = [];\r\n        for (let i = 0; i < currName.length; i++) {\r\n            const cell = this.getSheet(currName[i].sheetName).data[currName[i].row - 1][currName[i].col - 1];\r\n            if (cell === null) {\r\n            }\r\n            else if (typeof cell === 'object' && 'result' in cell) {\r\n                result.push(cell.result);\r\n            }\r\n            else {\r\n                result.push(cell);\r\n            }\r\n        }\r\n        return result;\r\n    }\r\n\r\n}\r\n\r\nfunction argbToRgb(argb) {\r\n    return argb.substring(2);\r\n}\r\n\r\nfunction cellRenderer(instance, td, row, col, prop, value, cellProperties) {\r\n    Handsontable.renderers.TextRenderer.apply(this, arguments);\r\n    if (('style' in cellProperties) && cellProperties.style) {\r\n        var style = cellProperties.style;\r\n        // alignment\r\n        var cellMeta = instance.getCellMeta(row, col);\r\n        var previousClass = (cellMeta.className !== undefined) ? cellMeta.className : '';\r\n\r\n        if (style.hasOwnProperty('alignment')) {\r\n            if (style.alignment.hasOwnProperty('horizontal')) {\r\n                td.style.textAlign = style.alignment.horizontal;\r\n            }\r\n            if (style.alignment.hasOwnProperty('vertical')) {\r\n\r\n                switch (style.alignment.vertical) {\r\n                    case 'top':\r\n                        instance.setCellMeta(row, col, 'className', previousClass + ' htTop');\r\n                        break;\r\n                    case 'middle':\r\n                        instance.setCellMeta(row, col, 'className', previousClass + ' htMiddle');\r\n                        break;\r\n                }\r\n            }\r\n        }\r\n        else {\r\n            // default bottom\r\n            instance.setCellMeta(row, col, 'className', previousClass + ' htBottom');\r\n        }\r\n\r\n        // font\r\n        if (style.hasOwnProperty('font')) {\r\n            if (style.font.hasOwnProperty('color') && style.font.color.hasOwnProperty('argb')) {\r\n                td.style.color = '#' + argbToRgb(style.font.color.argb);\r\n            }\r\n            if (style.font.hasOwnProperty('bold') && style.font.bold) {\r\n                td.style.fontWeight = 'bold';\r\n            }\r\n            if (style.font.hasOwnProperty('italic') && style.font.italic) {\r\n                td.style.fontStyle = 'italic';\r\n            }\r\n        }\r\n\r\n        // background\r\n        if (style.hasOwnProperty('fill')) {\r\n            if (style.fill.hasOwnProperty('fgColor') && style.fill.fgColor.hasOwnProperty('argb')) {\r\n                td.style.background = '#' + argbToRgb(style.fill.fgColor.argb);\r\n            }\r\n        }\r\n\r\n        // borders\r\n        if (style.hasOwnProperty('border')) {\r\n            for (var key in style.border) {\r\n                if (style.border.hasOwnProperty(key)) {\r\n                    var upper = key.charAt(0).toUpperCase() + key.slice(1);\r\n                    var border = style.border[key];\r\n                    if (border.hasOwnProperty('color') && border.color.hasOwnProperty('argb')) {\r\n                        td.style['border' + upper] = '1px solid #' + argbToRgb(border.color.argb);\r\n                    }\r\n                    else {\r\n                        // black color\r\n                        td.style['border' + upper] = '1px solid #000';\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    }\r\n    // render formula\r\n    if (value && typeof value === 'object' && value.hasOwnProperty('formula')) {\r\n        if (value.result && value.result.error) {\r\n            td.innerHTML = value.result.error;\r\n        }\r\n        else {\r\n            td.innerHTML = value.result !== undefined ? value.result : null;\r\n        }\r\n    }\r\n    // render dropdown\r\n}\r\n\r\nfunction getWorkbook(sheets, sheetNames) {\r\n    // create a workbook\r\n    var workbook = XLSX.utils.book_new();\r\n    for (var i = 0; i < sheets.length; i++) {\r\n        var ws_data = sheets[i].getData();\r\n        var worksheet = XLSX.utils.aoa_to_sheet(ws_data);\r\n        // Add the worksheet to the workbook\r\n        XLSX.utils.book_append_sheet(workbook, worksheet, sheetNames[i]);\r\n    }\r\n    return workbook;\r\n}\r\n\r\nfunction exportToExcel(workbook, name) {\r\n    var fileExtension = '.xlsx';\r\n    // empty params\r\n    if (typeof workbook === 'undefined') {\r\n        return XLSX.writeFile(getWorkbook(gui.tables, gui.sheetNames), gui.workbookName + fileExtension);\r\n    }\r\n    else {\r\n        XLSX.writeFile(workbook, name + fileExtension);\r\n    }\r\n}\r\n\r\n// re-evaluate formula\r\nfunction evaluateFormula(sheetName, row, col) {\r\n    if (!sheetNames.includes(sheetName)) {\r\n        console.log('Error: sheetName not found.');\r\n        return\r\n    }\r\n    var sheet = sheets[sheetNames.indexOf(sheetName)];\r\n    var data = sheet.getDataAtCell(row, col);\r\n    if (!data.hasOwnProperty('formula')) {\r\n        console.log('Error: evaluateFormula(): cell provided is not a formula');\r\n        return\r\n    }\r\n\r\n    var calculated = parser.parse(data.formula);\r\n    if (calculated.error) {\r\n        data.result = calculated;\r\n    }\r\n    else {\r\n        data.result = calculated.result;\r\n    }\r\n\r\n    sheet.setDataAtCell(row, col, data);\r\n    return data;\r\n}\r\n"],"file":"workbook-gui.js"}