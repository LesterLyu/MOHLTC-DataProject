{"version":3,"sources":["../moh.js/fillWorkbook.js"],"names":["gui","showModalAlert","title","msg","$","find","html","end","modal","unzip","binary","JSON","parse","pako","inflate","to","zip","string","deflate","updateLoadingStatus","text","console","log","workbookToJson","workbook","result","SheetNames","forEach","sheetName","roa","XLSX","utils","sheet_to_json","Sheets","header","defval","length","document","ready","workbookName","val","url","encodeURIComponent","ajax","type","done","response","success","start","Date","data","WorkbookGUI","load","hide","fail","xhr","status","error","responseJSON","message","on","btn","statusText","prop","stringify","getData","contentType","name","exportToExcel","click","change","e","files","target","f","formData","FormData","append","cache","processData","updateJson"],"mappings":"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","sourcesContent":["let gui;\r\n\r\nfunction showModalAlert(title, msg) {\r\n    $('#msg-modal').find('h5').html(title).end().find('p').html(msg).end().modal('show');\r\n}\r\n\r\nfunction unzip(binary) {\r\n    return JSON.parse(pako.inflate(binary, {to: 'string'}));\r\n}\r\n\r\nfunction zip(string) {\r\n    return pako.deflate(string, {to: 'string'});\r\n}\r\n\r\nfunction updateLoadingStatus(text) {\r\n    console.log('Loading... (' + text + ')');\r\n    $('#loadingText').html('Loading... (' + text + ')');\r\n}\r\n\r\nfunction workbookToJson(workbook) {\r\n    var result = {};\r\n    workbook.SheetNames.forEach(function (sheetName) {\r\n        var roa = XLSX.utils.sheet_to_json(workbook.Sheets[sheetName], {header: 1, defval: ''});\r\n        if (roa.length) result[sheetName] = roa;\r\n    });\r\n    console.log(result);\r\n    return result;\r\n}\r\n\r\n\r\n$(document).ready(function () {\r\n    const workbookName = $('#filled-workbook').val();\r\n    // default url is for fill the workbook first time\r\n    var url = '/api/filled-workbook/' + encodeURIComponent(workbookName);\r\n    $.ajax({\r\n        url: url,\r\n        type: 'GET',\r\n    }).done(function (response) {\r\n        console.log(response);\r\n        if (response.success) {\r\n            let start = new Date();\r\n            const data = unzip(response.workbook.data);\r\n            console.log('parse data takes: ' + (new Date() - start) + 'ms');\r\n            console.log(data);\r\n            gui = new WorkbookGUI('view', workbookName, data);\r\n            gui.load();\r\n            $('#loading').hide();\r\n        }\r\n    }).fail(function (xhr, status, error) {\r\n        console.log('fail ' + xhr.responseJSON.message);\r\n        $('#loading').hide();\r\n        //showErrorAlert(xhr.responseJSON.message);\r\n    });\r\n\r\n});\r\n\r\n$('#save-workbook-btn').on('click', function () {\r\n    var btn = $(this);\r\n    var statusText = $('#status');\r\n    statusText.html('<i class=\"fas fa-spinner fa-spin\"></i> Saving');\r\n    btn.prop('disabled', true);\r\n    const workbook = zip(JSON.stringify(gui.getData()));\r\n\r\n    $.ajax({\r\n        url: '/api/filled-workbook',\r\n        type: 'POST',\r\n        contentType: 'application/json',\r\n        data: JSON.stringify({data: workbook, name: $('#filled-workbook').val()}),\r\n    }).done(function (response) {\r\n        if (response.success) {\r\n            console.log(response);\r\n            statusText.html('<i class=\"fas fa-check\"></i> Saved');\r\n            btn.prop('disabled', false);\r\n        }\r\n    }).fail(function (xhr, status, error) {\r\n        console.log('fail ' + xhr.responseJSON.message);\r\n        statusText.html('<i class=\"fas fa-times\"></i> Failed to save workbook: ' + xhr.responseJSON.message);\r\n        btn.prop('disabled', false);\r\n    });\r\n});\r\n\r\n$('#export-workbook-btn').on('click', function () {\r\n    exportToExcel();\r\n});\r\n\r\n$('#import-workbook-btn').on('click', function () {\r\n    $('#file-import').click();\r\n});\r\n\r\n$('#file-import').change(function (e) {\r\n    var files = e.target.files, f = files[0];\r\n    var formData = new FormData();\r\n    formData.append('excel', f);\r\n\r\n    $.ajax({\r\n        url: '/api/upload/workbook/' + encodeURIComponent($('#filled-workbook').val()),\r\n        type: 'POST',\r\n        data: formData,\r\n        cache: false,\r\n        contentType: false,\r\n        processData: false\r\n    }).done(function (response) {\r\n        if (response.success) {\r\n            const data = unzip(response.workbook.data);\r\n            console.log(data);\r\n            gui.updateJson(data);\r\n            gui.load();\r\n        }\r\n    }).fail(function (xhr, status, error) {\r\n        console.log('fail ' + xhr.responseJSON.message);\r\n\r\n    });\r\n});\r\n"],"file":"fillWorkbook.js"}