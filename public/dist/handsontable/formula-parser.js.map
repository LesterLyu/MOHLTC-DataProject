{"version":3,"sources":["../../moh.js/handsontable/formula-parser.js"],"names":["parser","formulaParser","Parser","on","cellCoord","done","sheet","hasOwnProperty","gui","sheetNames","includes","console","error","currSheet","data","getDataAtSheetAndCell","row","index","column","result","startCellCoord","endCellCoord","log","label","fragment","colFragment","col","push"],"mappings":";;AAAA,IAAIA,MAAM,GAAG,IAAIC,aAAa,CAACC,MAAlB,EAAb;AAEA;;;;;;;;;AAQAF,MAAM,CAACG,EAAP,CAAU,eAAV,EAA2B,UAAUC,SAAV,EAAqBC,IAArB,EAA2B;AAClD;AACA,MAAIC,KAAJ;;AACA,MAAIF,SAAS,CAACG,cAAV,CAAyB,OAAzB,CAAJ,EAAuC;AACnC,QAAI,CAACC,GAAG,CAACC,UAAJ,CAAeC,QAAf,CAAwBN,SAAS,CAACE,KAAlC,CAAL,EAA+C;AAC3CK,MAAAA,OAAO,CAACC,KAAR,CAAc,gCAAgCR,SAAS,CAACE,KAAxD;AACH;;AACDA,IAAAA,KAAK,GAAGF,SAAS,CAACE,KAAlB;AACH,GALD,MAMK;AACDA,IAAAA,KAAK,GAAGE,GAAG,CAACK,SAAZ;AACH;;AACD,MAAIC,IAAI,GAAGN,GAAG,CAACO,qBAAJ,CAA0BT,KAA1B,EAAiCF,SAAS,CAACY,GAAV,CAAcC,KAA/C,EAAsDb,SAAS,CAACc,MAAV,CAAiBD,KAAvE,CAAX;;AACA,MAAIH,IAAI,KAAK,IAAb,EAAmB;AACfT,IAAAA,IAAI,CAAC,EAAD,CAAJ;AACH,GAFD,MAGK,IAAIS,IAAI,CAACP,cAAL,CAAoB,QAApB,CAAJ,EAAmC;AACpCF,IAAAA,IAAI,CAACS,IAAI,CAACK,MAAN,CAAJ;AACH,GAFI,MAGA;AACDd,IAAAA,IAAI,CAACS,IAAD,CAAJ;AACH;AACJ,CAtBD;AAyBAd,MAAM,CAACG,EAAP,CAAU,gBAAV,EAA4B,UAAUiB,cAAV,EAA0BC,YAA1B,EAAwChB,IAAxC,EAA8C;AACtEM,EAAAA,OAAO,CAACW,GAAR,CAAY,eAAeF,cAAc,CAACG,KAA9B,GAAsC,MAAtC,GAA+CF,YAAY,CAACE,KAAxE;AACA,MAAIC,QAAQ,GAAG,EAAf,CAFsE,CAItE;;AACA,MAAIlB,KAAJ;;AACA,MAAIc,cAAc,CAACb,cAAf,CAA8B,OAA9B,CAAJ,EAA4C;AACxC,QAAI,CAACC,GAAG,CAACC,UAAJ,CAAeC,QAAf,CAAwBU,cAAc,CAACd,KAAvC,CAAL,EAAoD;AAChDK,MAAAA,OAAO,CAACC,KAAR,CAAc,gCAAgCQ,cAAc,CAACd,KAA7D;AACH;;AACDA,IAAAA,KAAK,GAAGc,cAAc,CAACd,KAAvB;AACH,GALD,MAMK;AACDA,IAAAA,KAAK,GAAGE,GAAG,CAACK,SAAZ;AACH,GAdqE,CAgBtE;;;AACA,OAAK,IAAIG,GAAG,GAAGI,cAAc,CAACJ,GAAf,CAAmBC,KAAlC,EAAyCD,GAAG,IAAIK,YAAY,CAACL,GAAb,CAAiBC,KAAjE,EAAwED,GAAG,EAA3E,EAA+E;AAC3E,QAAIS,WAAW,GAAG,EAAlB;;AAEA,SAAK,IAAIC,GAAG,GAAGN,cAAc,CAACF,MAAf,CAAsBD,KAArC,EAA4CS,GAAG,IAAIL,YAAY,CAACH,MAAb,CAAoBD,KAAvE,EAA8ES,GAAG,EAAjF,EAAqF;AACjF,UAAIZ,IAAI,GAAIN,GAAG,CAACO,qBAAJ,CAA0BT,KAA1B,EAAiCU,GAAjC,EAAsCU,GAAtC,CAAZ,CADiF,CAEjF;;AACA,UAAIZ,IAAI,KAAK,IAAb,EAAmB;AACfW,QAAAA,WAAW,CAACE,IAAZ,CAAiB,EAAjB;AACH,OAFD,MAGK,IAAIb,IAAI,CAACP,cAAL,CAAoB,QAApB,CAAJ,EAAmC;AACpCkB,QAAAA,WAAW,CAACE,IAAZ,CAAiBb,IAAI,CAACK,MAAtB;AACH,OAFI,MAGA;AACDM,QAAAA,WAAW,CAACE,IAAZ,CAAiBb,IAAjB;AACH;AACJ;;AACDU,IAAAA,QAAQ,CAACG,IAAT,CAAcF,WAAd;AACH;;AACDpB,EAAAA,IAAI,CAACmB,QAAD,CAAJ;AACH,CApCD","sourcesContent":["var parser = new formulaParser.Parser();\r\n\r\n/**\r\n * cellCoord: {\r\n *     label: '',\r\n *     row: {index: Number, label: '', isAbsolute: Boolean},\r\n *     column: {index: Number, label: '', isAbsolute: Boolean},\r\n *     sheet: 'sheetName'  // if available\r\n * }\r\n */\r\nparser.on('callCellValue', function (cellCoord, done) {\r\n    //console.log('get ' + cellCoord.label);\r\n    let sheet;\r\n    if (cellCoord.hasOwnProperty('sheet')) {\r\n        if (!gui.sheetNames.includes(cellCoord.sheet)) {\r\n            console.error('Sheet name does not exist: ' + cellCoord.sheet);\r\n        }\r\n        sheet = cellCoord.sheet;\r\n    }\r\n    else {\r\n        sheet = gui.currSheet;\r\n    }\r\n    var data = gui.getDataAtSheetAndCell(sheet, cellCoord.row.index, cellCoord.column.index);\r\n    if (data === null) {\r\n        done('')\r\n    }\r\n    else if (data.hasOwnProperty('result')) {\r\n        done(data.result);\r\n    }\r\n    else {\r\n        done(data);\r\n    }\r\n});\r\n\r\n\r\nparser.on('callRangeValue', function (startCellCoord, endCellCoord, done) {\r\n    console.log('get range ' + startCellCoord.label + ' to ' + endCellCoord.label);\r\n    var fragment = [];\r\n\r\n    // find sheet\r\n    let sheet;\r\n    if (startCellCoord.hasOwnProperty('sheet')) {\r\n        if (!gui.sheetNames.includes(startCellCoord.sheet)) {\r\n            console.error('Sheet name does not exist: ' + startCellCoord.sheet);\r\n        }\r\n        sheet = startCellCoord.sheet;\r\n    }\r\n    else {\r\n        sheet = gui.currSheet;\r\n    }\r\n\r\n    // find data\r\n    for (var row = startCellCoord.row.index; row <= endCellCoord.row.index; row++) {\r\n        var colFragment = [];\r\n\r\n        for (var col = startCellCoord.column.index; col <= endCellCoord.column.index; col++) {\r\n            var data =  gui.getDataAtSheetAndCell(sheet, row, col);\r\n            //console.log(data);\r\n            if (data === null) {\r\n                colFragment.push('')\r\n            }\r\n            else if (data.hasOwnProperty('result')) {\r\n                colFragment.push(data.result);\r\n            }\r\n            else {\r\n                colFragment.push(data);\r\n            }\r\n        }\r\n        fragment.push(colFragment);\r\n    }\r\n    done(fragment)\r\n});\r\n\r\n"],"file":"formula-parser.js"}