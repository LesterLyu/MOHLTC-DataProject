{"version":3,"sources":["../../moh.js/handsontable/workbook-gui.js"],"names":["tabCounter","sheets","sheetNames","workbookName","workbookData","SCALE","currSheet","state","tabs","mode","tabsToAdd","tabContentsToAdd","newSimpleTable","container","height","preview","spec","data","width","offsetWidth","colWidths","rowHeights","manualColumnResize","manualRowResize","manualColumnMove","manualRowMove","rowHeaders","colHeaders","contextMenu","createdTable","Handsontable","push","newStyledTable","merges","map","x","Math","round","mergeCells","autoWrapCol","autoWrapRow","autoRowSize","autoColumnSize","applyTabs","$","removeClass","i","length","append","addTab","sheetName","tabColor","gridId","tabContentId","tabId","tabContent","newTab","argb","css","argbToRgb","insertBefore","substring","cellRenderer","instance","td","row","col","prop","value","cellProperties","renderers","TextRenderer","apply","arguments","style","cellMeta","getCellMeta","previousClass","className","undefined","hasOwnProperty","alignment","textAlign","horizontal","vertical","setCellMeta","font","color","bold","fontWeight","italic","fontStyle","fill","fgColor","background","key","border","upper","charAt","toUpperCase","slice","result","error","innerHTML","applyJsonWithoutStyle","workBookJson","html","sheetNo","ws","name","document","getElementById","addedTable","window","loadData","updateSettings","cells","readOnly","console","log","tab","applyJsonWithStyle","timerStart","Date","now","cnt","updateLoadingStatus","Object","keys","position","model","top","left","rowspan","bottom","colspan","right","table","renderer","editor","FormulaEditor","on","event","target","text","getWorkbook","workbook","XLSX","utils","book_new","ws_data","getData","worksheet","aoa_to_sheet","book_append_sheet","exportToExcel","fileExtension","writeFile","evaluateFormula","includes","sheet","indexOf","getDataAtCell","calculated","parser","parse","formula","setDataAtCell"],"mappings":"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","sourcesContent":["// Workbook GUI functions...\r\n\r\nvar tabCounter = 0;\r\nvar sheets = [], sheetNames = [];\r\nvar workbookName;\r\nvar workbookData;\r\nvar SCALE = 8;  // scale up the column width and row height\r\n\r\nvar currSheet;\r\nvar state = {\r\n    tabs: {\r\n        mode: 'edit', // edit or view\r\n        tabsToAdd: [], // array of jquery element, stack\r\n        tabContentsToAdd: [] //...\r\n    }\r\n};\r\n\r\n/**\r\n * Initialize a simple table that has no styles\r\n * @param container\r\n * @param height\r\n * @param preview\r\n */\r\nfunction newSimpleTable(container, height, preview) {\r\n    var spec = {\r\n        data: [],\r\n        width: container.offsetWidth,\r\n        height: height,\r\n        colWidths: 80,\r\n        rowHeights: 23,\r\n        manualColumnResize: true,\r\n        manualRowResize: true,\r\n        manualColumnMove: true,\r\n        manualRowMove: true,\r\n        rowHeaders: true,\r\n        colHeaders: true,\r\n        contextMenu: ['remove_row', 'remove_col', '---------', 'copy'],\r\n    };\r\n\r\n    var createdTable = new Handsontable(container, spec);\r\n\r\n    if (preview) {\r\n        spec.manualColumnMove = false;\r\n        spec.manualRowMove = false;\r\n    }\r\n    else {\r\n        sheets.push(createdTable);\r\n    }\r\n    return createdTable;\r\n}\r\n\r\n\r\n/**\r\n * Initialize a styled table\r\n * @param container\r\n * @param height\r\n * @param data\r\n * @param rowHeights\r\n * @param colWidths\r\n * @param merges\r\n */\r\nfunction newStyledTable(container, height, data, rowHeights, colWidths, merges) {\r\n\r\n    var spec = {\r\n        data: data,\r\n        width: container.offsetWidth,\r\n        height: height,\r\n        colWidths: colWidths.map(function (x) {\r\n            return Math.round(x * SCALE);\r\n        }),\r\n        rowHeights: rowHeights.map(function (x) {\r\n            return Math.round(x * SCALE / 5.5385);\r\n        }),\r\n        mergeCells: merges,\r\n        manualColumnResize: true,\r\n        manualRowResize: true,\r\n        manualColumnMove: false,\r\n        manualRowMove: false,\r\n        rowHeaders: true,\r\n        colHeaders: true,\r\n        autoWrapCol: false,\r\n        autoWrapRow: false,\r\n        autoRowSize: false,\r\n        autoColumnSize: false,\r\n        contextMenu: ['copy'],\r\n    };\r\n    var createdTable = new Handsontable(container, spec);\r\n    sheets.push(createdTable);\r\n    return createdTable;\r\n}\r\n\r\nfunction applyTabs(){\r\n    // deactivate previous tab and content\r\n    $('div.active.show').removeClass('active show');\r\n    $('a.active').removeClass('active show');\r\n    var i;\r\n    for (i = 0; i < state.tabContentsToAdd.length; i++) {\r\n        $('#nav-tabContent').append(state.tabContentsToAdd[i]);\r\n    }\r\n}\r\n\r\n/**\r\n * Edit mode for create/edit workbook, View mode for user view the workbook\r\n *\r\n * @param sheetName\r\n * @param mode can be either 'edit' or 'view'\r\n * @param tabColor can be null\r\n * @return {string}\r\n */\r\nfunction addTab(sheetName, mode, tabColor) {\r\n    var gridId = 'grid-' + tabCounter;\r\n    var tabContentId = 'tab-content-' + tabCounter;\r\n    var tabId = 'tab-' + tabCounter;\r\n\r\n    // deactivate previous tab and content\r\n    $('div.active.show').removeClass('active show');\r\n    $('a.active').removeClass('active show');\r\n\r\n    // add content\r\n    var tabContent = $('<div id=\"' + tabContentId + '\" class=\"tab-pane fade active show\"> <div id=\"' + gridId + '\"></div></div>');\r\n    $('#nav-tabContent').append(tabContent);\r\n\r\n    // add tab\r\n    var newTab;\r\n    // edit mode have edit button in tabs\r\n    if (mode === 'edit') {\r\n        newTab = $('<a id=\"' + tabId + '\" class=\"nav-item nav-link active show\" data-toggle=\"tab\" href=\"#' + tabContentId + '\"> ' + sheetName\r\n            + '<i onclick=\"editSheet(' + tabCounter + ')\" class=\"fas fa-pen ml-2\"></i></a>');\r\n    }\r\n    else {\r\n        newTab = $('<a class=\"nav-item nav-link active show\" data-toggle=\"tab\" href=\"#' + tabContentId + '\">' + sheetName + '</a>');\r\n    }\r\n    if (tabColor && tabColor.argb) {\r\n        newTab.css('border-bottom', '3px solid #' + argbToRgb(tabColor.argb));\r\n    }\r\n    if (mode === 'edit') {\r\n        newTab.insertBefore('#nav-tab a:nth-last-child(1)');\r\n    }\r\n    else {\r\n        $('#nav-tab').append(newTab);\r\n    }\r\n\r\n    tabCounter++;\r\n    return gridId;\r\n}\r\n\r\n\r\nfunction argbToRgb(argb) {\r\n    return argb.substring(2);\r\n}\r\n\r\nfunction cellRenderer(instance, td, row, col, prop, value, cellProperties) {\r\n    Handsontable.renderers.TextRenderer.apply(this, arguments);\r\n    var style = cellProperties.style;\r\n\r\n    // alignment\r\n    var cellMeta = instance.getCellMeta(row, col);\r\n    var previousClass = (cellMeta.className !== undefined) ? cellMeta.className : '';\r\n\r\n    if (style && style.hasOwnProperty('alignment')) {\r\n        if (style.alignment.hasOwnProperty('horizontal')) {\r\n            td.style.textAlign = style.alignment.horizontal;\r\n        }\r\n        if (style.alignment.hasOwnProperty('vertical')) {\r\n\r\n            switch (style.alignment.vertical) {\r\n                case 'top':\r\n                    instance.setCellMeta(row, col, 'className', previousClass + ' htTop');\r\n                    break;\r\n                case 'middle':\r\n                    instance.setCellMeta(row, col, 'className', previousClass + ' htMiddle');\r\n                    break;\r\n            }\r\n        }\r\n    }\r\n    else {\r\n        // default bottom\r\n        instance.setCellMeta(row, col, 'className', previousClass + ' htBottom');\r\n    }\r\n\r\n    // font\r\n    if (style && style.hasOwnProperty('font')) {\r\n        if (style.font.hasOwnProperty('color') && style.font.color.hasOwnProperty('argb')) {\r\n            td.style.color = '#' + argbToRgb(style.font.color.argb);\r\n        }\r\n        if (style.font.hasOwnProperty('bold') && style.font.bold) {\r\n            td.style.fontWeight = 'bold';\r\n        }\r\n        if (style.font.hasOwnProperty('italic') && style.font.italic) {\r\n            td.style.fontStyle = 'italic';\r\n        }\r\n    }\r\n\r\n    // background\r\n    if (style && style.hasOwnProperty('fill')) {\r\n        if (style.fill.hasOwnProperty('fgColor') && style.fill.fgColor.hasOwnProperty('argb')) {\r\n            td.style.background = '#' + argbToRgb(style.fill.fgColor.argb);\r\n        }\r\n    }\r\n\r\n    // borders\r\n    if (style && style.hasOwnProperty('border')) {\r\n        for (var key in style.border) {\r\n            if (style.border.hasOwnProperty(key)) {\r\n                var upper = key.charAt(0).toUpperCase() + key.slice(1);\r\n                var border = style.border[key];\r\n                if (border.hasOwnProperty('color') && border.color.hasOwnProperty('argb')) {\r\n                    td.style['border' + upper] = '1px solid #' + argbToRgb(border.color.argb);\r\n                }\r\n                else {\r\n                    // black color\r\n                    td.style['border' + upper] = '1px solid #000';\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    // render formula\r\n    if (value && typeof value === 'object' && value.hasOwnProperty('formula')) {\r\n        if (value.result && value.result.error) {\r\n            td.innerHTML = value.result.error;\r\n        }\r\n        else {\r\n            td.innerHTML = value.result !== undefined ? value.result : null;\r\n        }\r\n\r\n    }\r\n    // render dropdown\r\n}\r\n\r\n\r\n// apply json to GUI tables\r\nfunction applyJsonWithoutStyle(workBookJson, mode) {\r\n    if (mode !== 'edit')\r\n        $('#nav-tab').html('');\r\n    $('#nav-tabContent').html('');\r\n    // load to front-end\r\n    for (var sheetNo in workBookJson) {\r\n        if (workBookJson.hasOwnProperty(sheetNo)) {\r\n            var ws = workBookJson[sheetNo];\r\n            sheetNames.push(ws.name);\r\n            var data = ws.data;\r\n            var gridId = addTab(ws.name, 'edit');\r\n\r\n            // generate table\r\n            var container = document.getElementById(gridId);\r\n            var addedTable = newSimpleTable(container, $(window).height() - 500, false);\r\n            addedTable.loadData(data);\r\n            // lock cells\r\n            addedTable.updateSettings({\r\n                cells: function (row, col) {\r\n                    var cellProperties = {};\r\n                    if (row === 0 || col === 0) {\r\n                        cellProperties.readOnly = true;\r\n                    }\r\n                    return cellProperties;\r\n                }\r\n            });\r\n        }\r\n    }\r\n    console.log(sheets);\r\n    $('#nav-tab a:first-child').tab('show');\r\n}\r\n\r\n// apply json to GUI tables\r\nfunction applyJsonWithStyle(workBookJson, mode) {\r\n    var timerStart = Date.now();\r\n    // clear tables and tabs\r\n    if (mode !== 'edit')\r\n        $('#nav-tab').html('');\r\n    $('#nav-tabContent').html('');\r\n\r\n    // clear global variables\r\n    sheets = [];\r\n    sheetNames = [];\r\n    var cnt = 0;\r\n\r\n    // load to front-end\r\n    for (var sheetNo in workBookJson) {\r\n        if (workBookJson.hasOwnProperty(sheetNo)) {\r\n            var ws = workBookJson[sheetNo];\r\n            updateLoadingStatus(ws.name + ' ' + Math.round(cnt / Object.keys(workBookJson).length * 100) + '%');\r\n            sheetNames.push(ws.name);\r\n            var data = ws.data;\r\n            var gridId = addTab(ws.name, mode, ws.tabColor);\r\n\r\n            // transform mergeCells\r\n            var merges = [];\r\n            for (var position in ws.merges) {\r\n                if (ws.merges.hasOwnProperty(position)) {\r\n                    var model = ws.merges[position].model;\r\n                    merges.push({\r\n                        row: model.top - 1,\r\n                        col: model.left - 1,\r\n                        rowspan: model.bottom - model.top + 1,\r\n                        colspan: model.right - model.left + 1\r\n                    })\r\n                }\r\n            }\r\n\r\n            // generate table\r\n            var container = document.getElementById(gridId);\r\n            var table = newStyledTable(container, $(window).height() - 360, data, ws.row.height, ws.col.width, merges);\r\n            table.sheetNo = sheetNo;\r\n\r\n            table.updateSettings({\r\n                cells: function (row, col) {\r\n                    var ws = workbookData[this.instance.sheetNo];\r\n                    var cellProperties = {};\r\n                    cellProperties.style = null;\r\n                    if (ws.style.length > 0 && ws.style[row].length > col && ws.style[row][col] && Object.keys(ws.style[row][col]).length !== 0) {\r\n                        cellProperties.style = ws.style[row][col];\r\n                    }\r\n                    cellProperties.renderer = cellRenderer;\r\n                    cellProperties.editor = FormulaEditor;\r\n\r\n\r\n                    return cellProperties;\r\n                }\r\n            });\r\n        }\r\n        cnt++;\r\n    }\r\n    console.log(sheets);\r\n    $('#nav-tab a:first-child').tab('show');\r\n    currSheet = sheetNames[0];\r\n    // add listener to tabs\r\n    $('.nav-tabs a').on('show.bs.tab', function(event){\r\n        currSheet = $(event.target).text();         // active tab\r\n    });\r\n    console.log(\"Time consumed: \", Date.now()-timerStart + 'ms');\r\n}\r\n\r\n\r\nfunction getWorkbook(sheets, sheetNames) {\r\n    // create a workbook\r\n    var workbook = XLSX.utils.book_new();\r\n    for (var i = 0; i < sheets.length; i++) {\r\n        var ws_data = sheets[i].getData();\r\n        var worksheet = XLSX.utils.aoa_to_sheet(ws_data);\r\n        // Add the worksheet to the workbook\r\n        XLSX.utils.book_append_sheet(workbook, worksheet, sheetNames[i]);\r\n    }\r\n    return workbook;\r\n}\r\n\r\nfunction exportToExcel(workbook, name) {\r\n    var fileExtension = '.xlsx';\r\n    // empty params\r\n    if (typeof workbook === 'undefined') {\r\n        return XLSX.writeFile(getWorkbook(sheets, sheetNames), workbookName + fileExtension);\r\n    }\r\n    else {\r\n        XLSX.writeFile(workbook, name + fileExtension);\r\n    }\r\n}\r\n\r\n// re-evaluate formula\r\nfunction evaluateFormula(sheetName, row, col) {\r\n    if (!sheetNames.includes(sheetName)) {\r\n        console.log('Error: sheetName not found.');\r\n        return\r\n    }\r\n    var sheet = sheets[sheetNames.indexOf(sheetName)];\r\n    var data = sheet.getDataAtCell(row, col);\r\n    if (!data.hasOwnProperty('formula')) {\r\n        console.log('Error: evaluateFormula(): cell provided is not a formula');\r\n        return\r\n    }\r\n\r\n    var calculated = parser.parse(data.formula);\r\n    if (calculated.error) {\r\n        data.result = calculated;\r\n    }\r\n    else {\r\n        data.result = calculated.result;\r\n    }\r\n\r\n    sheet.setDataAtCell(row, col, data);\r\n    return data;\r\n}\r\n"],"file":"workbook-gui.js"}