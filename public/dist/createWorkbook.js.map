{"version":3,"sources":["../moh.js/createWorkbook.js"],"names":["mode","state","modalMode","workbookData","showModalAlert","title","msg","$","find","html","end","modal","updateLoadingStatus","text","console","log","document","ready","selectAttributes","selectCategories","ajax","url","type","done","response","success","each","attributes","i","item","append","id","attribute","value","selectpicker","fail","xhr","status","error","responseJSON","message","categories","category","workbookName","val","encodeURIComponent","workbook","data","hasOwnProperty","applyJsonWithStyle","applyJsonWithoutStyle","hide","editSheet","index","modelDisplayIndex","selecte_categories","selecte_attributes","sheetNames","sheets","getData","slice","splice","indexOf","attrs","cates","length","push","backdrop","getSelected","selected_categories","selected_attributes","att_id","att","substring","concat","cat_id","cat","Array","join","split","on","click","change","e","files","target","f","formData","FormData","cache","contentType","processData","exportToExcel","container","getElementById","previewTable","newSimpleTable","loadData","updateSettings","cells","row","col","cellProperties","readOnly","sheetName","gridId","addTab","addedTable","window","height","btn","statusText","prop","name","JSON","stringify","oldName"],"mappings":";;AAAA,IAAIA,IAAJ;AACA,IAAIC,KAAK,GAAG;AACRC,EAAAA,SAAS,EAAE,MADH,CACU;;AADV,CAAZ,C,CAEG;;AACH,IAAIC,YAAJ;;AAEA,SAASC,cAAT,CAAwBC,KAAxB,EAA+BC,GAA/B,EAAoC;AAChCC,EAAAA,CAAC,CAAC,YAAD,CAAD,CAAgBC,IAAhB,CAAqB,IAArB,EAA2BC,IAA3B,CAAgCJ,KAAhC,EAAuCK,GAAvC,GAA6CF,IAA7C,CAAkD,GAAlD,EAAuDC,IAAvD,CAA4DH,GAA5D,EAAiEI,GAAjE,GAAuEC,KAAvE,CAA6E,MAA7E;AACH;;AAED,SAASC,mBAAT,CAA6BC,IAA7B,EAAmC;AAC/BC,EAAAA,OAAO,CAACC,GAAR,CAAY,iBAAiBF,IAAjB,GAAwB,GAApC;AACAN,EAAAA,CAAC,CAAC,cAAD,CAAD,CAAkBE,IAAlB,CAAuB,iBAAiBI,IAAjB,GAAwB,GAA/C;AACH;;AAEDN,CAAC,CAACS,QAAD,CAAD,CAAYC,KAAZ,CAAkB,YAAY;AAE1B;AACA,MAAIC,gBAAgB,GAAGX,CAAC,CAAC,oBAAD,CAAxB;AACA,MAAIY,gBAAgB,GAAGZ,CAAC,CAAC,oBAAD,CAAxB;AACAA,EAAAA,CAAC,CAACa,IAAF,CAAO;AACHC,IAAAA,GAAG,EAAE,iBADF;AAEHC,IAAAA,IAAI,EAAE;AAFH,GAAP,EAGGC,IAHH,CAGQ,UAAUC,QAAV,EAAoB;AACxB,QAAIA,QAAQ,CAACC,OAAb,EAAsB;AAClBlB,MAAAA,CAAC,CAACmB,IAAF,CAAOF,QAAQ,CAACG,UAAhB,EAA4B,UAAUC,CAAV,EAAaC,IAAb,EAAmB;AAC3CX,QAAAA,gBAAgB,CAACY,MAAjB,CAAwBvB,CAAC,CAAC,UAAD,EAAa;AAClCM,UAAAA,IAAI,EAAE,MAAMgB,IAAI,CAACE,EAAX,GAAgB,IAAhB,GAAuBF,IAAI,CAACG,SADA;AAElCC,UAAAA,KAAK,EAAEJ,IAAI,CAACE,EAAL,GAAU,GAAV,GAAgBF,IAAI,CAACG;AAFM,SAAb,CAAzB;AAIH,OALD;AAOAd,MAAAA,gBAAgB,CAACgB,YAAjB,CAA8B,SAA9B;AACH;AACJ,GAdD,EAcGC,IAdH,CAcQ,UAAUC,GAAV,EAAeC,MAAf,EAAuBC,KAAvB,EAA8B;AAClCxB,IAAAA,OAAO,CAACC,GAAR,CAAY,UAAUqB,GAAG,CAACG,YAAJ,CAAiBC,OAAvC;AACH,GAhBD;AAkBAjC,EAAAA,CAAC,CAACa,IAAF,CAAO;AACHC,IAAAA,GAAG,EAAE,iBADF;AAEHC,IAAAA,IAAI,EAAE;AAFH,GAAP,EAGGC,IAHH,CAGQ,UAAUC,QAAV,EAAoB;AACxB,QAAIA,QAAQ,CAACC,OAAb,EAAsB;AAClBlB,MAAAA,CAAC,CAACmB,IAAF,CAAOF,QAAQ,CAACiB,UAAhB,EAA4B,UAAUb,CAAV,EAAaC,IAAb,EAAmB;AAC3CV,QAAAA,gBAAgB,CAACW,MAAjB,CAAwBvB,CAAC,CAAC,UAAD,EAAa;AAClCM,UAAAA,IAAI,EAAE,MAAMgB,IAAI,CAACE,EAAX,GAAgB,IAAhB,GAAuBF,IAAI,CAACa,QADA;AAElCT,UAAAA,KAAK,EAAEJ,IAAI,CAACE,EAAL,GAAU,GAAV,GAAgBF,IAAI,CAACa;AAFM,SAAb,CAAzB;AAIH,OALD;AAOAvB,MAAAA,gBAAgB,CAACe,YAAjB,CAA8B,SAA9B;AACH;AACJ,GAdD,EAcGC,IAdH,CAcQ,UAAUC,GAAV,EAAeC,MAAf,EAAuBC,KAAvB,EAA8B;AAClCxB,IAAAA,OAAO,CAACC,GAAR,CAAY,UAAUqB,GAAG,CAACG,YAAJ,CAAiBC,OAAvC,EADkC,CAElC;AACH,GAjBD,EAvB0B,CA0C1B;;AACAG,EAAAA,YAAY,GAAGpC,CAAC,CAAC,oBAAD,CAAD,CAAwBqC,GAAxB,EAAf;AACA5C,EAAAA,IAAI,GAAGO,CAAC,CAAC,OAAD,CAAD,CAAWqC,GAAX,EAAP;;AACA,MAAI5C,IAAI,KAAK,MAAb,EAAqB;AAEjB;AACA,QAAIqB,GAAG,GAAG,mBAAmBwB,kBAAkB,CAACF,YAAD,CAA/C;AAEApC,IAAAA,CAAC,CAACa,IAAF,CAAO;AACHC,MAAAA,GAAG,EAAEA,GADF;AAEHC,MAAAA,IAAI,EAAE;AAFH,KAAP,EAGGC,IAHH,CAGQ,UAAUC,QAAV,EAAoB;AACxBV,MAAAA,OAAO,CAACC,GAAR,CAAYS,QAAZ;;AACA,UAAIA,QAAQ,CAACC,OAAb,EAAsB;AAClBtB,QAAAA,YAAY,GAAGqB,QAAQ,CAACsB,QAAT,CAAkBC,IAAjC;AACAjC,QAAAA,OAAO,CAACC,GAAR,CAAYZ,YAAZ,EAFkB,CAGlB;;AACA,YAAIA,YAAY,CAAC,CAAD,CAAZ,IAAmBA,YAAY,CAAC,CAAD,CAAZ,CAAgB6C,cAAhB,CAA+B,OAA/B,CAAvB,EAAgE;AAC5DC,UAAAA,kBAAkB,CAAC9C,YAAD,EAAe,MAAf,CAAlB;AACH,SAFD,MAGK;AACD+C,UAAAA,qBAAqB,CAAC/C,YAAD,EAAe,MAAf,CAArB;AACH;;AACDI,QAAAA,CAAC,CAAC,UAAD,CAAD,CAAc4C,IAAd;AACH;AACJ,KAjBD,EAiBGhB,IAjBH,CAiBQ,UAAUC,GAAV,EAAeC,MAAf,EAAuBC,KAAvB,EAA8B;AAClCxB,MAAAA,OAAO,CAACC,GAAR,CAAY,UAAUqB,GAAG,CAACG,YAAJ,CAAiBC,OAAvC,EADkC,CAElC;;AACAjC,MAAAA,CAAC,CAAC,UAAD,CAAD,CAAc4C,IAAd;AACH,KArBD;AAsBH;AAEJ,CA1ED;;AA4EA,SAASC,SAAT,CAAmBC,KAAnB,EAA0B;AACtBpD,EAAAA,KAAK,CAACC,SAAN,GAAkB,MAAlB;AACAD,EAAAA,KAAK,CAACqD,iBAAN,GAA0BD,KAA1B;AACA,MAAIE,kBAAkB,GAAGhD,CAAC,CAAC,oBAAD,CAA1B;AACA,MAAIiD,kBAAkB,GAAGjD,CAAC,CAAC,oBAAD,CAA1B;AACAgD,EAAAA,kBAAkB,CAACrB,YAAnB,CAAgC,aAAhC;AACAsB,EAAAA,kBAAkB,CAACtB,YAAnB,CAAgC,aAAhC;AACA3B,EAAAA,CAAC,CAAC,iBAAD,CAAD,CAAqBqC,GAArB,CAAyBa,UAAU,CAACJ,KAAD,CAAnC;AAGA,MAAIN,IAAI,GAAGW,MAAM,CAACL,KAAD,CAAN,CAAcM,OAAd,GAAwBC,KAAxB,EAAX,CAVsB,CAWtB;;AACAb,EAAAA,IAAI,CAAC,CAAD,CAAJ,CAAQc,MAAR,CAAed,IAAI,CAAC,CAAD,CAAJ,CAAQe,OAAR,CAAgB,EAAhB,CAAf,EAAoC,CAApC;AACA,MAAIC,KAAK,GAAGhB,IAAI,CAAC,CAAD,CAAhB;AACA,MAAIiB,KAAK,GAAG,EAAZ;;AACA,OAAK,IAAIpC,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGmB,IAAI,CAACkB,MAAzB,EAAiCrC,CAAC,EAAlC,EAAsC;AAClC,QAAImB,IAAI,CAACnB,CAAD,CAAJ,CAAQ,CAAR,MAAe,EAAnB,EAAuBoC,KAAK,CAACE,IAAN,CAAWnB,IAAI,CAACnB,CAAD,CAAJ,CAAQ,CAAR,CAAX;AAC1B;;AAEDd,EAAAA,OAAO,CAACC,GAAR,CAAYgD,KAAZ,EAAmBC,KAAnB;AACAT,EAAAA,kBAAkB,CAACrB,YAAnB,CAAgC,KAAhC,EAAuC8B,KAAvC;AACAR,EAAAA,kBAAkB,CAACtB,YAAnB,CAAgC,KAAhC,EAAuC6B,KAAvC;AACAxD,EAAAA,CAAC,CAAC,kBAAD,CAAD,CAAsBE,IAAtB,CAA2B,QAA3B;AACAF,EAAAA,CAAC,CAAC,YAAD,CAAD,CAAgBI,KAAhB,CAAsB;AAACwD,IAAAA,QAAQ,EAAE;AAAX,GAAtB;AACH,C,CAID;;;AACA,SAASC,WAAT,GAAuB;AACnB,MAAIC,mBAAmB,GAAG9D,CAAC,CAAC,oBAAD,CAAD,CAAwBqC,GAAxB,EAA1B;AACA,MAAI0B,mBAAmB,GAAG/D,CAAC,CAAC,oBAAD,CAAD,CAAwBqC,GAAxB,EAA1B;AACA,MAAIG,IAAI,GAAG,EAAX;AACA,MAAIwB,MAAM,GAAG,EAAb;AAAA,MAAiBC,GAAG,GAAG,EAAvB;AAAA,MAA2B5C,CAA3B,CAJmB,CAKnB;;AACA,OAAKA,CAAC,GAAG,CAAT,EAAYA,CAAC,GAAG0C,mBAAmB,CAACL,MAApC,EAA4CrC,CAAC,EAA7C,EAAiD;AAC7C2C,IAAAA,MAAM,CAACL,IAAP,CAAYI,mBAAmB,CAAC1C,CAAD,CAAnB,CAAuB6C,SAAvB,CAAiC,CAAjC,EAAoCH,mBAAmB,CAAC1C,CAAD,CAAnB,CAAuBkC,OAAvB,CAA+B,GAA/B,CAApC,CAAZ;AACAU,IAAAA,GAAG,CAACN,IAAJ,CAASI,mBAAmB,CAAC1C,CAAD,CAAnB,CAAuB6C,SAAvB,CAAiC,IAAIH,mBAAmB,CAAC1C,CAAD,CAAnB,CAAuBkC,OAAvB,CAA+B,GAA/B,CAArC,CAAT;AACH;;AACDf,EAAAA,IAAI,CAACmB,IAAL,CAAU,CAAC,EAAD,EAAK,EAAL,EAASQ,MAAT,CAAgBH,MAAhB,CAAV;AACAxB,EAAAA,IAAI,CAACmB,IAAL,CAAU,CAAC,EAAD,EAAK,EAAL,EAASQ,MAAT,CAAgBF,GAAhB,CAAV,EAXmB,CAanB;;AACA,OAAK5C,CAAC,GAAG,CAAT,EAAYA,CAAC,GAAGyC,mBAAmB,CAACJ,MAApC,EAA4CrC,CAAC,EAA7C,EAAiD;AAC7C,QAAI+C,MAAM,GAAGN,mBAAmB,CAACzC,CAAD,CAAnB,CAAuB6C,SAAvB,CAAiC,CAAjC,EAAoCJ,mBAAmB,CAACzC,CAAD,CAAnB,CAAuBkC,OAAvB,CAA+B,GAA/B,CAApC,CAAb;AACA,QAAIc,GAAG,GAAGP,mBAAmB,CAACzC,CAAD,CAAnB,CAAuB6C,SAAvB,CAAiC,IAAIJ,mBAAmB,CAACzC,CAAD,CAAnB,CAAuBkC,OAAvB,CAA+B,GAA/B,CAArC,CAAV;AACAf,IAAAA,IAAI,CAACmB,IAAL,CAAU,CAACS,MAAD,EAASC,GAAT,EAAcF,MAAd,CACNG,KAAK,CAACP,mBAAmB,CAACL,MAArB,CAAL,CAAkCa,IAAlC,CAAuC,GAAvC,EAA4CC,KAA5C,CAAkD,GAAlD,CADM,CAAV;AAEH;;AACD,SAAOhC,IAAP;AACH;;AAEDxC,CAAC,CAAC,sBAAD,CAAD,CAA0ByE,EAA1B,CAA6B,OAA7B,EAAsC,YAAY;AAC9CzE,EAAAA,CAAC,CAAC,cAAD,CAAD,CAAkB0E,KAAlB;AACH,CAFD;AAIA1E,CAAC,CAAC,cAAD,CAAD,CAAkB2E,MAAlB,CAAyB,UAAUC,CAAV,EAAa;AAElC,MAAIC,KAAK,GAAGD,CAAC,CAACE,MAAF,CAASD,KAArB;AAAA,MAA4BE,CAAC,GAAGF,KAAK,CAAC,CAAD,CAArC;AACA,MAAIG,QAAQ,GAAG,IAAIC,QAAJ,EAAf;AACAD,EAAAA,QAAQ,CAACzD,MAAT,CAAgB,OAAhB,EAAyBwD,CAAzB;AAEA/E,EAAAA,CAAC,CAACa,IAAF,CAAO;AACHC,IAAAA,GAAG,EAAE,uBAAuBwB,kBAAkB,CAACtC,CAAC,CAAC,oBAAD,CAAD,CAAwBqC,GAAxB,EAAD,CAD3C;AAEHtB,IAAAA,IAAI,EAAE,MAFH;AAGHyB,IAAAA,IAAI,EAAEwC,QAHH;AAIHE,IAAAA,KAAK,EAAE,KAJJ;AAKHC,IAAAA,WAAW,EAAE,KALV;AAMHC,IAAAA,WAAW,EAAE;AANV,GAAP,EAOGpE,IAPH,CAOQ,UAAUC,QAAV,EAAoB;AACxB,QAAIA,QAAQ,CAACC,OAAb,EAAsB;AAClBX,MAAAA,OAAO,CAACC,GAAR,CAAYS,QAAZ;AACArB,MAAAA,YAAY,GAAGqB,QAAQ,CAACuB,IAAxB;AACAE,MAAAA,kBAAkB,CAACzB,QAAQ,CAACuB,IAAV,EAAgB,MAAhB,CAAlB;AACH;AACJ,GAbD,EAaGZ,IAbH,CAaQ,UAAUC,GAAV,EAAeC,MAAf,EAAuBC,KAAvB,EAA8B;AAClCxB,IAAAA,OAAO,CAACC,GAAR,CAAY,UAAUqB,GAAG,CAACG,YAAJ,CAAiBC,OAAvC;AAEH,GAhBD;AAkBH,CAxBD;AA0BAjC,CAAC,CAAC,sBAAD,CAAD,CAA0ByE,EAA1B,CAA6B,OAA7B,EAAsC,YAAY;AAC9CrC,EAAAA,YAAY,GAAGpC,CAAC,CAAC,oBAAD,CAAD,CAAwBqC,GAAxB,EAAf;AACA,MAAI,CAACD,YAAL,EACIA,YAAY,GAAG,WAAf;AACJiD,EAAAA,aAAa;AAChB,CALD,E,CAOA;;AACArF,CAAC,CAAC,iBAAD,CAAD,CAAqB0E,KAArB,CAA2B,YAAY;AACnChF,EAAAA,KAAK,CAACC,SAAN,GAAkB,KAAlB;AACAK,EAAAA,CAAC,CAAC,iBAAD,CAAD,CAAqBqC,GAArB,CAAyB,EAAzB;AACArC,EAAAA,CAAC,CAAC,oBAAD,CAAD,CAAwB2B,YAAxB,CAAqC,aAArC;AACA3B,EAAAA,CAAC,CAAC,oBAAD,CAAD,CAAwB2B,YAAxB,CAAqC,aAArC;AACA3B,EAAAA,CAAC,CAAC,kBAAD,CAAD,CAAsBE,IAAtB,CAA2B,KAA3B;AACAF,EAAAA,CAAC,CAAC,YAAD,CAAD,CAAgBI,KAAhB,CAAsB;AAACwD,IAAAA,QAAQ,EAAE;AAAX,GAAtB;AACH,CAPD,E,CASA;;AACA5D,CAAC,CAAC,cAAD,CAAD,CAAkB0E,KAAlB,CAAwB,YAAY;AAChC1E,EAAAA,CAAC,CAAC,eAAD,CAAD,CAAmBE,IAAnB,CAAwB,EAAxB;AACA,MAAIoF,SAAS,GAAG7E,QAAQ,CAAC8E,cAAT,CAAwB,cAAxB,CAAhB;AACA,MAAIC,YAAY,GAAGC,cAAc,CAACH,SAAD,EAAY,GAAZ,EAAiB,IAAjB,CAAjC;AACAE,EAAAA,YAAY,CAACE,QAAb,CAAsB7B,WAAW,EAAjC,EAJgC,CAKhC;;AACA2B,EAAAA,YAAY,CAACG,cAAb,CAA4B;AACxBC,IAAAA,KAAK,EAAE,eAAUC,GAAV,EAAeC,GAAf,EAAoB;AACvB,UAAIC,cAAc,GAAG,EAArB;AACAA,MAAAA,cAAc,CAACC,QAAf,GAA0B,IAA1B;AACA,aAAOD,cAAP;AACH;AALuB,GAA5B;AAOH,CAbD,E,CAeA;AACA;;AACA/F,CAAC,CAAC,kBAAD,CAAD,CAAsB0E,KAAtB,CAA4B,YAAY;AACpC,MAAIuB,SAAS,GAAGjG,CAAC,CAAC,iBAAD,CAAD,CAAqBqC,GAArB,EAAhB;;AACA,MAAI3C,KAAK,CAACC,SAAN,KAAoB,KAAxB,EAA+B;AAC3BuD,IAAAA,UAAU,CAACS,IAAX,CAAgBsC,SAAhB;AACA,QAAIC,MAAM,GAAGC,MAAM,CAACF,SAAD,EAAY,MAAZ,CAAnB,CAF2B,CAI3B;;AACA,QAAIX,SAAS,GAAG7E,QAAQ,CAAC8E,cAAT,CAAwBW,MAAxB,CAAhB;AACA,QAAIE,UAAU,GAAGX,cAAc,CAACH,SAAD,EAAYtF,CAAC,CAACqG,MAAD,CAAD,CAAUC,MAAV,KAAqB,GAAjC,EAAsC,KAAtC,CAA/B;AACAF,IAAAA,UAAU,CAACV,QAAX,CAAoB7B,WAAW,EAA/B,EAP2B,CAQ3B;;AACAuC,IAAAA,UAAU,CAACT,cAAX,CAA0B;AACtBC,MAAAA,KAAK,EAAE,eAAUC,GAAV,EAAeC,GAAf,EAAoB;AACvB,YAAIC,cAAc,GAAG,EAArB;;AACA,YAAIF,GAAG,KAAK,CAAR,IAAaC,GAAG,KAAK,CAAzB,EAA4B;AACxBC,UAAAA,cAAc,CAACC,QAAf,GAA0B,IAA1B;AACH;;AACD,eAAOD,cAAP;AACH;AAPqB,KAA1B;AASH,GAlBD,MAmBK,IAAIrG,KAAK,CAACC,SAAN,KAAoB,MAAxB,EAAgC;AACjCuD,IAAAA,UAAU,CAACxD,KAAK,CAACqD,iBAAP,CAAV,GAAsCkD,SAAtC;AACAjG,IAAAA,CAAC,CAAC,UAAUN,KAAK,CAACqD,iBAAjB,CAAD,CAAqC7C,IAArC,CAA0C+F,SAAS,GAC7C,wBADoC,GACTvG,KAAK,CAACqD,iBADG,GACiB,iCAD3D;AAEAI,IAAAA,MAAM,CAACzD,KAAK,CAACqD,iBAAP,CAAN,CAAgC2C,QAAhC,CAAyC7B,WAAW,EAApD;AACH;;AAGD7D,EAAAA,CAAC,CAAC,YAAD,CAAD,CAAgBI,KAAhB,CAAsB,MAAtB;AACH,CA9BD;AAgCAJ,CAAC,CAAC,oBAAD,CAAD,CAAwByE,EAAxB,CAA2B,OAA3B,EAAoC,YAAY;AAC5C,MAAI8B,GAAG,GAAGvG,CAAC,CAAC,IAAD,CAAX;AACA,MAAIwG,UAAU,GAAGxG,CAAC,CAAC,SAAD,CAAlB;AACAwG,EAAAA,UAAU,CAACtG,IAAX,CAAgB,+CAAhB;AACAqG,EAAAA,GAAG,CAACE,IAAJ,CAAS,UAAT,EAAqB,IAArB;AACA,MAAIlE,QAAQ,GAAG,EAAf;;AACA,OAAK,IAAIlB,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG8B,MAAM,CAACO,MAA3B,EAAmCrC,CAAC,EAApC,EAAwC;AACpCkB,IAAAA,QAAQ,CAAClB,CAAD,CAAR,GAAc;AACVqF,MAAAA,IAAI,EAAExD,UAAU,CAAC7B,CAAD,CADN;AAEVmB,MAAAA,IAAI,EAAEW,MAAM,CAAC9B,CAAD,CAAN,CAAU+B,OAAV;AAFI,KAAd;AAIH;;AAEDpD,EAAAA,CAAC,CAACa,IAAF,CAAO;AACHC,IAAAA,GAAG,EAAE,qBADF;AAEHC,IAAAA,IAAI,EAAGtB,IAAI,KAAK,MAAT,GAAkB,KAAlB,GAA0B,MAF9B;AAGH0F,IAAAA,WAAW,EAAE,kBAHV;AAIH3C,IAAAA,IAAI,EAAEmE,IAAI,CAACC,SAAL,CAAe;AAACpE,MAAAA,IAAI,EAAED,QAAP;AAAiBsE,MAAAA,OAAO,EAAE7G,CAAC,CAAC,kBAAD,CAAD,CAAsBqC,GAAtB,EAA1B;AAAsDqE,MAAAA,IAAI,EAAE1G,CAAC,CAAC,oBAAD,CAAD,CAAwBqC,GAAxB;AAA5D,KAAf;AAJH,GAAP,EAKGrB,IALH,CAKQ,UAAUC,QAAV,EAAoB;AACxB,QAAIA,QAAQ,CAACC,OAAb,EAAsB;AAClBsF,MAAAA,UAAU,CAACtG,IAAX,CAAgB,oCAAhB;AACAqG,MAAAA,GAAG,CAACE,IAAJ,CAAS,UAAT,EAAqB,KAArB;AACH;AACJ,GAVD,EAUG7E,IAVH,CAUQ,UAAUC,GAAV,EAAeC,MAAf,EAAuBC,KAAvB,EAA8B;AAClCxB,IAAAA,OAAO,CAACC,GAAR,CAAY,UAAUqB,GAAG,CAACG,YAAJ,CAAiBC,OAAvC;AACAuE,IAAAA,UAAU,CAACtG,IAAX,CAAgB,6DAA6D2B,GAAG,CAACG,YAAJ,CAAiBC,OAA9F;AACAsE,IAAAA,GAAG,CAACE,IAAJ,CAAS,UAAT,EAAqB,KAArB;AACH,GAdD;AAeH,CA5BD,E,CA8BA","sourcesContent":["var mode;\r\nvar state = {\r\n    modalMode: 'none' // none, add, edit\r\n}; // store state\r\nvar workbookData;\r\n\r\nfunction showModalAlert(title, msg) {\r\n    $('#msg-modal').find('h5').html(title).end().find('p').html(msg).end().modal('show');\r\n}\r\n\r\nfunction updateLoadingStatus(text) {\r\n    console.log('Loading... (' + text + ')');\r\n    $('#loadingText').html('Loading... (' + text + ')')\r\n}\r\n\r\n$(document).ready(function () {\r\n\r\n    // get attributes and categories.\r\n    var selectAttributes = $('#select-attributes');\r\n    var selectCategories = $('#select-categories');\r\n    $.ajax({\r\n        url: '/api/attributes',\r\n        type: 'GET',\r\n    }).done(function (response) {\r\n        if (response.success) {\r\n            $.each(response.attributes, function (i, item) {\r\n                selectAttributes.append($('<option>', {\r\n                    text: '#' + item.id + '  ' + item.attribute,\r\n                    value: item.id + ',' + item.attribute,\r\n                }));\r\n            });\r\n\r\n            selectAttributes.selectpicker('refresh');\r\n        }\r\n    }).fail(function (xhr, status, error) {\r\n        console.log('fail ' + xhr.responseJSON.message);\r\n    });\r\n\r\n    $.ajax({\r\n        url: '/api/categories',\r\n        type: 'GET',\r\n    }).done(function (response) {\r\n        if (response.success) {\r\n            $.each(response.categories, function (i, item) {\r\n                selectCategories.append($('<option>', {\r\n                    text: '#' + item.id + '  ' + item.category,\r\n                    value: item.id + ',' + item.category,\r\n                }));\r\n            });\r\n\r\n            selectCategories.selectpicker('refresh');\r\n        }\r\n    }).fail(function (xhr, status, error) {\r\n        console.log('fail ' + xhr.responseJSON.message);\r\n        //showErrorAlert(xhr.responseJSON.message);\r\n    });\r\n\r\n    // if this page is loaded for edit workbook\r\n    workbookName = $('#workbookNameInput').val();\r\n    mode = $('#mode').val();\r\n    if (mode === 'edit') {\r\n\r\n        // default url is for fill the workbook first time\r\n        var url = '/api/workbook/' + encodeURIComponent(workbookName);\r\n\r\n        $.ajax({\r\n            url: url,\r\n            type: 'GET',\r\n        }).done(function (response) {\r\n            console.log(response);\r\n            if (response.success) {\r\n                workbookData = response.workbook.data;\r\n                console.log(workbookData);\r\n                // check if it has style\r\n                if (workbookData[0] && workbookData[0].hasOwnProperty('style')) {\r\n                    applyJsonWithStyle(workbookData, 'edit');\r\n                }\r\n                else {\r\n                    applyJsonWithoutStyle(workbookData, 'edit');\r\n                }\r\n                $('#loading').hide();\r\n            }\r\n        }).fail(function (xhr, status, error) {\r\n            console.log('fail ' + xhr.responseJSON.message);\r\n            //showErrorAlert(xhr.responseJSON.message);\r\n            $('#loading').hide();\r\n        });\r\n    }\r\n\r\n});\r\n\r\nfunction editSheet(index) {\r\n    state.modalMode = 'edit';\r\n    state.modelDisplayIndex = index;\r\n    var selecte_categories = $('#select-categories');\r\n    var selecte_attributes = $('#select-attributes');\r\n    selecte_categories.selectpicker('deselectAll');\r\n    selecte_attributes.selectpicker('deselectAll');\r\n    $('#sheetNameInput').val(sheetNames[index]);\r\n\r\n\r\n    var data = sheets[index].getData().slice();\r\n    // console.log(data);\r\n    data[0].splice(data[0].indexOf(''), 1);\r\n    var attrs = data[0];\r\n    var cates = [];\r\n    for (var i = 1; i < data.length; i++) {\r\n        if (data[i][0] !== '') cates.push(data[i][0])\r\n    }\r\n\r\n    console.log(attrs, cates);\r\n    selecte_categories.selectpicker('val', cates);\r\n    selecte_attributes.selectpicker('val', attrs);\r\n    $('#add-confirm-btn').html('Modify');\r\n    $('#add-modal').modal({backdrop: 'static'});\r\n}\r\n\r\n\r\n\r\n// get the selected att and cat\r\nfunction getSelected() {\r\n    var selected_categories = $('#select-categories').val();\r\n    var selected_attributes = $('#select-attributes').val();\r\n    var data = [];\r\n    var att_id = [], att = [], i;\r\n    // add first two rows\r\n    for (i = 0; i < selected_attributes.length; i++) {\r\n        att_id.push(selected_attributes[i].substring(0, selected_attributes[i].indexOf(',')))\r\n        att.push(selected_attributes[i].substring(1 + selected_attributes[i].indexOf(',')))\r\n    }\r\n    data.push(['', ''].concat(att_id));\r\n    data.push(['', ''].concat(att));\r\n\r\n    // add columns\r\n    for (i = 0; i < selected_categories.length; i++) {\r\n        var cat_id = selected_categories[i].substring(0, selected_categories[i].indexOf(','));\r\n        var cat = selected_categories[i].substring(1 + selected_categories[i].indexOf(','))\r\n        data.push([cat_id, cat].concat(\r\n            Array(selected_attributes.length).join('.').split('.')));\r\n    }\r\n    return data;\r\n}\r\n\r\n$('#import-workbook-btn').on('click', function () {\r\n    $('#file-import').click();\r\n});\r\n\r\n$('#file-import').change(function (e) {\r\n\r\n    var files = e.target.files, f = files[0];\r\n    var formData = new FormData();\r\n    formData.append('excel', f);\r\n\r\n    $.ajax({\r\n        url: '/api/upload/style/' + encodeURIComponent($('#workbookNameInput').val()),\r\n        type: 'POST',\r\n        data: formData,\r\n        cache: false,\r\n        contentType: false,\r\n        processData: false\r\n    }).done(function (response) {\r\n        if (response.success) {\r\n            console.log(response);\r\n            workbookData = response.data;\r\n            applyJsonWithStyle(response.data, 'edit');\r\n        }\r\n    }).fail(function (xhr, status, error) {\r\n        console.log('fail ' + xhr.responseJSON.message);\r\n\r\n    });\r\n\r\n});\r\n\r\n$('#export-workbook-btn').on('click', function () {\r\n    workbookName = $('#workbookNameInput').val();\r\n    if (!workbookName)\r\n        workbookName = 'workbook1';\r\n    exportToExcel();\r\n});\r\n\r\n// add sheet modal\r\n$('#show-modal-btn').click(function () {\r\n    state.modalMode = 'add';\r\n    $('#sheetNameInput').val('');\r\n    $('#select-categories').selectpicker('deselectAll');\r\n    $('#select-attributes').selectpicker('deselectAll');\r\n    $('#add-confirm-btn').html('Add');\r\n    $('#add-modal').modal({backdrop: 'static'});\r\n});\r\n\r\n// preview the sheet in the modal\r\n$('#preview-btn').click(function () {\r\n    $('#preview-grid').html('');\r\n    var container = document.getElementById('preview-grid');\r\n    var previewTable = newSimpleTable(container, 300, true);\r\n    previewTable.loadData(getSelected());\r\n    // lock all cells\r\n    previewTable.updateSettings({\r\n        cells: function (row, col) {\r\n            var cellProperties = {};\r\n            cellProperties.readOnly = true;\r\n            return cellProperties;\r\n        }\r\n    });\r\n});\r\n\r\n// confirm to add sheet to the workbook\r\n// TO-DO check inputs, i.e. duplicates, empty name/row/column...\r\n$(\"#add-confirm-btn\").click(function () {\r\n    var sheetName = $('#sheetNameInput').val();\r\n    if (state.modalMode === 'add') {\r\n        sheetNames.push(sheetName);\r\n        var gridId = addTab(sheetName, 'edit');\r\n\r\n        // generate table\r\n        var container = document.getElementById(gridId);\r\n        var addedTable = newSimpleTable(container, $(window).height() - 500, false);\r\n        addedTable.loadData(getSelected());\r\n        // lock cells\r\n        addedTable.updateSettings({\r\n            cells: function (row, col) {\r\n                var cellProperties = {};\r\n                if (row === 0 || col === 0) {\r\n                    cellProperties.readOnly = true;\r\n                }\r\n                return cellProperties;\r\n            }\r\n        });\r\n    }\r\n    else if (state.modalMode === 'edit') {\r\n        sheetNames[state.modelDisplayIndex] = sheetName;\r\n        $('#tab-' + state.modelDisplayIndex).html(sheetName\r\n            + '<i onclick=\"editSheet(' + state.modelDisplayIndex + ')\" class=\"fas fa-pen ml-2\"></i>');\r\n        sheets[state.modelDisplayIndex].loadData(getSelected());\r\n    }\r\n\r\n\r\n    $('#add-modal').modal('hide');\r\n});\r\n\r\n$('#save-workbook-btn').on('click', function () {\r\n    var btn = $(this);\r\n    var statusText = $('#status');\r\n    statusText.html('<i class=\"fas fa-spinner fa-spin\"></i> Saving');\r\n    btn.prop('disabled', true);\r\n    var workbook = {};\r\n    for (var i = 0; i < sheets.length; i++) {\r\n        workbook[i] = {\r\n            name: sheetNames[i],\r\n            data: sheets[i].getData()\r\n        };\r\n    }\r\n\r\n    $.ajax({\r\n        url: '/api/admin/workbook',\r\n        type: (mode === 'edit' ? 'PUT' : 'POST'),\r\n        contentType: 'application/json',\r\n        data: JSON.stringify({data: workbook, oldName: $('#workbookOldName').val(),name: $('#workbookNameInput').val()}),\r\n    }).done(function (response) {\r\n        if (response.success) {\r\n            statusText.html('<i class=\"fas fa-check\"></i> Saved');\r\n            btn.prop('disabled', false);\r\n        }\r\n    }).fail(function (xhr, status, error) {\r\n        console.log('fail ' + xhr.responseJSON.message);\r\n        statusText.html('<i class=\"fas fa-times\"></i> Failed to create workbook: ' + xhr.responseJSON.message);\r\n        btn.prop('disabled', false);\r\n    });\r\n});\r\n\r\n// edit\r\n\r\n"],"file":"createWorkbook.js"}